<!DOCTYPE html>
<html  lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="apple-mobile-web-capable" content="yes" />
<title>DonichiDungeonR</title>
<style>
    @charset "Shift_JIS";

    * {
        margin:0; padding:0; /*全要素のマージン・パディングをリセット*/
    } 

    canvas
    {
        top :0px ;
        left:0px ;
        position : absolute;
    }

    @media (max-width : 599px){
        canvas
        {
            width : 320px;
            height :200px;
        }
    }

    @media (min-width : 600px){
        canvas
        {
            width : 640px;
            height :400px;
        }
    }

    @media (min-width : 1025px){
        canvas
        {
            width : 1280px;
            height :800px;
        }
    }
    .resizeimage * { width: 100%; }
</style>
<script type="text/javascript">
function DisplayControl(t,i,e,s,n,h="use"){var o;o="undefined"!=typeof OffscreenCanvas&&"use"==h?new offScreenTypeC(i,e,s,n):new offScreen,this.buffer=o;var r=t;this.cw=i,this.ch=e,r.font="16px 'Arial'",this.lighter_enable=!0,this.view=o.view,this.flip=o.flip;var a=1,u="";this.setInterval=function(t){0==t?o.flip(!1):o.flip(!0),a=t},this.setBackgroundcolor=function(t){u=t,this.backgroundcolor=u},this.getInterval=function(){return a},this.getBackgroundcolor=function(){return u},this.putPattern=function(t,i,e,s,n,h){o.drawImgXYWHXYWH(t,i.x,i.y,i.w,i.h,e,s,n,h)},this.setBgPattern=function(t){bg_ptn=t},this.print=function(t,i,e,s){Boolean(s)||(s="limegreen"),o.fillText(t,i,e,s)},this.putImage=function(t,i,e){o.drawImgXY(t,i,e)},this.putImage2=function(t,i,e,s,n){o.drawImgXYWH(t,i,e,s,n)},this.putImageTransform=function(t,i,e,s,n,h,r){o.putImageTransform(t,i,e,s,n,h,r)},this.transform=function(t,i,e,s){o.Transform(t,i,e,s,0,0)},this.putFunc=function(t){o.putFunc(t)},this.clear=function(t){this.flip()&&(o.allClear(0,0,i,e),void 0===t&&(t=u),Boolean(t)&&o.fillRect(0,0,i,e,t))},this.fill=function(t,i,e,s,n){o.fillRect(t,i,e,s,n)},this.reset=function(){o.reset()},this.reflash=function(){o.reflash()},this.draw=function(){o.draw(r)},this.count=function(){return o.count()},this.max=function(){return o.max()}}function fontPrintControl(t,i,e,s,n,h,o){var r=t.screen[0].buffer;this.useScreen=function(i){r=t.screen[i].buffer};const a=i,u=n;var l=[];const c=[[12288,12289,12290,65292,65294,12539,65306,65307,65311,65281,12443,12444,180,65344,168,65342,65507,65343,12541,12542,12445,12446,12291,20189,12293,12294,12295,12540,8213,8208,65295,92,12316,8214,65372,8230,8229,8216,8217,8220,8221,65288,65289,12308,12309,65339,65341,65371,65373,12296,12297,12298,12299,12300,12301,12302,12303,12304,12305,65291,8722,177,215,247,65309,8800,65308,65310,8806,8807,8734,8756,9794,9792,176,8242,8243,8451,65509,65284,162,163,65285,65283,65286,65290,65312,167,9734,9733,9675,9679,9678,9671],[9670,9633,9632,9651,9650,9661,9660,8251,12306,8594,8592,8593,8595,12307,0,0,0,0,0,0,0,0,0,0,0,8712,8715,8838,8839,8834,8835,0,0,0,0,0,0,0,0,0,0,8743,8744,172,8658,8660,8704,8707,0,0,0,0,0,0,0,0,0,0,0,0,0,8978,8706,8711,0,0,8810,8811,0,8765,8733,0,0,8748,0,0,0,0,0,0,0,8491,8240,9839,9837,9834,8224,8225,182,0,0,0,0,9711],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65296,65297,65298,65299,65300,65301,65302,65303,65304,65305,0,0,0,0,0,0,0,65313,65314,65315,65316,65317,65318,65319,65320,65321,65322,65323,65324,65325,65326,65327,65328,65329,65330,65331,65332,65333,65334,65335,65336,65337,65338,0,0,0,0,0,0,65345,65346,65347,65348,65349,65350,65351,65352,65353,65354,65355,65356,65357,65358,65359,65360,65361,65362,65363,65364,65365,65366,65367,65368,65369,65370,0,0,0,0],[12353,12354,12355,12356,12357,12358,12359,12360,12361,12362,12363,12364,12365,12366,12367,12368,12369,12370,12371,12372,12373,12374,12375,12376,12377,12378,12379,12380,12381,12382,12383,12384,12385,12386,12387,12388,12389,12390,12391,12392,12393,12394,12395,12396,12397,12398,12399,12400,12401,12402,12403,12404,12405,12406,12407,12408,12409,12410,12411,12412,12413,12414,12415,12416,12417,12418,12419,12420,12421,12422,12423,12424,12425,12426,12427,12428,12429,12430,12431,12432,12433,12434,12435,0,0,0,0,0,0,0,0,0,0,0],[12449,12450,12451,12452,12453,12454,12455,12456,12457,12458,12459,12460,12461,12462,12463,12464,12465,12466,12467,12468,12469,12470,12471,12472,12473,12474,12475,12476,12477,12478,12479,12480,12481,12482,12483,12484,12485,12486,12487,12488,12489,12490,12491,12492,12493,12494,12495,12496,12497,12498,12499,12500,12501,12502,12503,12504,12505,12506,12507,12508,12509,12510,12511,12512,12513,12514,12515,12516,12517,12518,12519,12520,12521,12522,12523,12524,12525,12526,12527,12528,12529,12530,12531,12532,12533,12534,0,0,0,0,0,0,0,0],[913,914,915,916,917,918,919,920,921,922,923,924,925,926,927,928,929,931,932,933,934,935,936,937,0,0,0,0,0,0,0,0,945,946,947,948,949,950,951,952,953,954,955,956,957,958,959,960,961,963,964,965,966,967,968,969,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1040,1041,1042,1043,1044,1045,1025,1046,1047,1048,1049,1050,1051,1052,1053,1054,1055,1056,1057,1058,1059,1060,1061,1062,1063,1064,1065,1066,1067,1068,1069,1070,1071,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1072,1073,1074,1075,1076,1077,1105,1078,1079,1080,1081,1082,1083,1084,1085,1086,1087,1088,1089,1090,1091,1092,1093,1094,1095,1096,1097,1098,1099,1100,1101,1102,1103,0,0,0,0,0,0,0,0,0,0,0,0,0],[9472,9474,9484,9488,9496,9492,9500,9516,9508,9524,9532,9473,9475,9487,9491,9499,9495,9507,9523,9515,9531,9547,9504,9519,9512,9527,9535,9501,9520,9509,9528,9538,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[9312,9313,9314,9315,9316,9317,9318,9319,9320,9321,9322,9323,9324,9325,9326,9327,9328,9329,9330,9331,8544,8545,8546,8547,8548,8549,8550,8551,8552,8553,0,13129,13076,13090,13133,13080,13095,13059,13110,13137,13143,13069,13094,13091,13099,13130,13115,13212,13213,13214,13198,13199,13252,13217,0,0,0,0,0,0,0,0,13179,12317,12319,8470,13261,8481,12964,12965,12966,12967,12968,12849,12850,12857,13182,13181,13180,8786,8801,8747,8750,8721,8730,8869,8736,8735,8895,8757,8745,8746,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[20124,21782,23043,38463,21696,24859,25384,23030,36898,33909,33564,31312,24746,25569,28197,26093,33894,33446,39925,26771,22311,26017,25201,23451,22992,34427,39156,32098,32190,39822,25110,31903,34999,23433,24245,25353,26263,26696,38343,38797,26447,20197,20234,20301,20381,20553,22258,22839,22996,23041,23561,24799,24847,24944,26131,26885,28858,30031,30064,31227,32173,32239,32963,33806,34915,35586,36949,36986,21307,20117,20133,22495,32946,37057,30959,19968,22769,28322,36920,31282,33576,33419,39983,20801,21360,21693,21729,22240,23035,24341,39154,28139,32996,34093],[38498,38512,38560,38907,21515,21491,23431,28879,32701,36802,38632,21359,40284,31418,19985,30867,33276,28198,22040,21764,27421,34074,39995,23013,21417,28006,29916,38287,22082,20113,36939,38642,33615,39180,21473,21942,23344,24433,26144,26355,26628,27704,27891,27945,29787,30408,31310,38964,33521,34907,35424,37613,28082,30123,30410,39365,24742,35585,36234,38322,27022,21421,20870,22290,22576,22852,23476,24310,24616,25513,25588,27839,28436,28814,28948,29017,29141,29503,32257,33398,33489,34199,36960,37467,40219,22633,26044,27738,29989,20985,22830,22885,24448,24540],[25276,26106,27178,27431,27572,29579,32705,35158,40236,40206,40644,23713,27798,33659,20740,23627,25014,33222,26742,29281,20057,20474,21368,24681,28201,31311,38899,19979,21270,20206,20309,20285,20385,20339,21152,21487,22025,22799,23233,23478,23521,31185,26247,26524,26550,27468,27827,28779,29634,31117,31166,31292,31623,33457,33499,33540,33655,33775,33747,34662,35506,22057,36008,36838,36942,38686,34442,20420,23784,25105,29273,30011,33253,33469,34558,36032,38597,39187,39381,20171,20250,35299,22238,22602,22730,24315,24555,24618,24724,24674,25040,25106,25296,25913],[39745,26214,26800,28023,28784,30028,30342,32117,33445,34809,38283,38542,35997,20977,21182,22806,21683,23475,23830,24936,27010,28079,30861,33995,34903,35442,37799,39608,28012,39336,34521,22435,26623,34510,37390,21123,22151,21508,24275,25313,25785,26684,26680,27579,29554,30906,31339,35226,35282,36203,36611,37101,38307,38548,38761,23398,23731,27005,38989,38990,25499,31520,27179,27263,26806,39949,28511,21106,21917,24688,25324,27963,28167,28369,33883,35088,36676,19988,39993,21494,26907,27194,38788,26666,20828,31427,33970,37340,37772,22107,40232,26658,33541,33841],[31909,21e3,33477,29926,20094,20355,20896,23506,21002,21208,21223,24059,21914,22570,23014,23436,23448,23515,24178,24185,24739,24863,24931,25022,25563,25954,26577,26707,26874,27454,27475,27735,28450,28567,28485,29872,29976,30435,30475,31487,31649,31777,32233,32566,32752,32925,33382,33694,35251,35532,36011,36996,37969,38291,38289,38306,38501,38867,39208,33304,20024,21547,23736,24012,29609,30284,30524,23721,32747,36107,38593,38929,38996,39e3,20225,20238,21361,21916,22120,22522,22855,23305,23492,23696,24076,24190,24524,25582,26426,26071,26082,26399,26827,26820],[27231,24112,27589,27671,27773,30079,31048,23395,31232,32e3,24509,35215,35352,36020,36215,36556,36637,39138,39438,39740,20096,20605,20736,22931,23452,25135,25216,25836,27450,29344,30097,31047,32681,34811,35516,35696,25516,33738,38816,21513,21507,21931,26708,27224,35440,30759,26485,40653,21364,23458,33050,34384,36870,19992,20037,20167,20241,21450,21560,23470,24339,24613,25937,26429,27714,27762,27875,28792,29699,31350,31406,31496,32026,31998,32102,26087,29275,21435,23621,24040,25298,25312,25369,28192,34394,35377,36317,37624,28417,31142,39770,20136,20139,20140],[20379,20384,20689,20807,31478,20849,20982,21332,21281,21375,21483,21932,22659,23777,24375,24394,24623,24656,24685,25375,25945,27211,27841,29378,29421,30703,33016,33029,33288,34126,37111,37857,38911,39255,39514,20208,20957,23597,26241,26989,23616,26354,26997,29577,26704,31873,20677,21220,22343,24062,37670,26020,27427,27453,29748,31105,31165,31563,32202,33465,33740,34943,35167,35641,36817,37329,21535,37504,20061,20534,21477,21306,29399,29590,30697,33510,36527,39366,39368,39378,20855,24858,34398,21936,31354,20598,23507,36935,38533,20018,27355,37351,23633,23624],[25496,31391,27795,38772,36705,31402,29066,38536,31874,26647,32368,26705,37740,21234,21531,34219,35347,32676,36557,37089,21350,34952,31041,20418,20670,21009,20804,21843,22317,29674,22411,22865,24418,24452,24693,24950,24935,25001,25522,25658,25964,26223,26690,28179,30054,31293,31995,32076,32153,32331,32619,33550,33610,34509,35336,35427,35686,36605,38938,40335,33464,36814,39912,21127,25119,25731,28608,38553,26689,20625,27424,27770,28500,31348,32080,34880,35363,26376,20214,20537,20518,20581,20860,21048,21091,21927,22287,22533,23244,24314,25010,25080,25331,25458],[26908,27177,29309,29356,29486,30740,30831,32121,30476,32937,35211,35609,36066,36562,36963,37749,38522,38997,39443,40568,20803,21407,21427,24187,24358,28187,28304,29572,29694,32067,33335,35328,35578,38480,20046,20491,21476,21628,22266,22993,23396,24049,24235,24359,25144,25925,26543,28246,29392,31946,34996,32929,32993,33776,34382,35463,36328,37431,38599,39015,40723,20116,20114,20237,21320,21577,21566,23087,24460,24481,24735,26791,27278,29786,30849,35486,35492,35703,37264,20062,39881,20132,20348,20399,20505,20502,20809,20844,21151,21177,21246,21402,21475,21521],[21518,21897,22353,22434,22909,23380,23389,23439,24037,24039,24055,24184,24195,24218,24247,24344,24658,24908,25239,25304,25511,25915,26114,26179,26356,26477,26657,26775,27083,27743,27946,28009,28207,28317,30002,30343,30828,31295,31968,32005,32024,32094,32177,32789,32771,32943,32945,33108,33167,33322,33618,34892,34913,35611,36002,36092,37066,37237,37489,30783,37628,38308,38477,38917,39321,39640,40251,21083,21163,21495,21512,22741,25335,28640,35946,36703,40633,20811,21051,21578,22269,31296,37239,40288,40658,29508,28425,33136,29969,24573,24794,39592,29403,36796],[27492,38915,20170,22256,22372,22718,23130,24680,25031,26127,26118,26681,26801,28151,30165,32058,33390,39746,20123,20304,21449,21766,23919,24038,24046,26619,27801,29811,30722,35408,37782,35039,22352,24231,25387,20661,20652,20877,26368,21705,22622,22971,23472,24425,25165,25505,26685,27507,28168,28797,37319,29312,30741,30758,31085,25998,32048,33756,35009,36617,38555,21092,22312,26448,32618,36001,20916,22338,38442,22586,27018,32948,21682,23822,22524,30869,40442,20316,21066,21643,25662,26152,26388,26613,31364,31574,32034,37679,26716,39853,31545,21273,20874,21047],[23519,25334,25774,25830,26413,27578,34217,38609,30352,39894,25420,37638,39851,30399,26194,19977,20632,21442,23665,24808,25746,25955,26719,29158,29642,29987,31639,32386,34453,35715,36059,37240,39184,26028,26283,27531,20181,20180,20282,20351,21050,21496,21490,21987,22235,22763,22987,22985,23039,23376,23629,24066,24107,24535,24605,25351,25903,23388,26031,26045,26088,26525,27490,27515,27663,29509,31049,31169,31992,32025,32043,32930,33026,33267,35222,35422,35433,35430,35468,35566,36039,36060,38604,39164,27503,20107,20284,20365,20816,23383,23546,24904,25345,26178],[27425,28363,27835,29246,29885,30164,30913,31034,32780,32819,33258,33940,36766,27728,40575,24335,35672,40235,31482,36600,23437,38635,19971,21489,22519,22833,23241,23460,24713,28287,28422,30142,36074,23455,34048,31712,20594,26612,33437,23649,34122,32286,33294,20889,23556,25448,36198,26012,29038,31038,32023,32773,35613,36554,36974,34503,37034,20511,21242,23610,26451,28796,29237,37196,37320,37675,33509,23490,24369,24825,20027,21462,23432,25163,26417,27530,29417,29664,31278,33131,36259,37202,39318,20754,21463,21610,23551,25480,27193,32172,38656,22234,21454,21608],[23447,23601,24030,20462,24833,25342,27954,31168,31179,32066,32333,32722,33261,33311,33936,34886,35186,35728,36468,36655,36913,37195,37228,38598,37276,20160,20303,20805,21313,24467,25102,26580,27713,28171,29539,32294,37325,37507,21460,22809,23487,28113,31069,32302,31899,22654,29087,20986,34899,36848,20426,23803,26149,30636,31459,33308,39423,20934,24490,26092,26991,27529,28147,28310,28516,30462,32020,24033,36981,37255,38918,20966,21021,25152,26257,26329,28186,24246,32210,32626,26360,34223,34295,35576,21161,21465,22899,24207,24464,24661,37604,38500,20663,20767],[21213,21280,21319,21484,21736,21830,21809,22039,22888,22974,23100,23477,23558,23567,23569,23578,24196,24202,24288,24432,25215,25220,25307,25484,25463,26119,26124,26157,26230,26494,26786,27167,27189,27836,28040,28169,28248,28988,28966,29031,30151,30465,30813,30977,31077,31216,31456,31505,31911,32057,32918,33750,33931,34121,34909,35059,35359,35388,35412,35443,35937,36062,37284,37478,37758,37912,38556,38808,19978,19976,19998,20055,20887,21104,22478,22580,22732,23330,24120,24773,25854,26465,26454,27972,29366,30067,31331,33976,35698,37304,37664,22065,22516,39166],[25325,26893,27542,29165,32340,32887,33394,35302,39135,34645,36785,23611,20280,20449,20405,21767,23072,23517,23529,24515,24910,25391,26032,26187,26862,27035,28024,28145,30003,30137,30495,31070,31206,32051,33251,33455,34218,35242,35386,36523,36763,36914,37341,38663,20154,20161,20995,22645,22764,23563,29978,23613,33102,35338,36805,38499,38765,31525,35535,38920,37218,22259,21416,36887,21561,22402,24101,25512,27700,28810,30561,31883,32736,34928,36930,37204,37648,37656,38543,29790,39620,23815,23913,25968,26530,36264,38619,25454,26441,26905,33733,38935,38592,35070],[28548,25722,23544,19990,28716,30045,26159,20932,21046,21218,22995,24449,24615,25104,25919,25972,26143,26228,26866,26646,27491,28165,29298,29983,30427,31934,32854,22768,35069,35199,35488,35475,35531,36893,37266,38738,38745,25993,31246,33030,38587,24109,24796,25114,26021,26132,26512,30707,31309,31821,32318,33034,36012,36196,36321,36447,30889,20999,25305,25509,25666,25240,35373,31363,31680,35500,38634,32118,33292,34633,20185,20808,21315,21344,23459,23554,23574,24029,25126,25159,25776,26643,26676,27849,27973,27927,26579,28508,29006,29053,26059,31359,31661,32218],[32330,32680,33146,33307,33337,34214,35438,36046,36341,36984,36983,37549,37521,38275,39854,21069,21892,28472,28982,20840,31109,32341,33203,31950,22092,22609,23720,25514,26366,26365,26970,29401,30095,30094,30990,31062,31199,31895,32032,32068,34311,35380,38459,36961,40736,20711,21109,21452,21474,20489,21930,22766,22863,29245,23435,23652,21277,24803,24819,25436,25475,25407,25531,25805,26089,26361,24035,27085,27133,28437,29157,20105,30185,30456,31379,31967,32207,32156,32865,33609,33624,33900,33980,34299,35013,36208,36865,36973,37783,38684,39442,20687,22679,24974],[33235,34101,36104,36896,20419,20596,21063,21363,24687,25417,26463,28204,36275,36895,20439,23646,36042,26063,32154,21330,34966,20854,25539,23384,23403,23562,25613,26449,36956,20182,22810,22826,27760,35409,21822,22549,22949,24816,25171,26561,33333,26965,38464,39364,39464,20307,22534,23550,32784,23729,24111,24453,24608,24907,25140,26367,27888,28382,32974,33151,33492,34955,36024,36864,36910,38538,40667,39899,20195,21488,22823,31532,37261,38988,40441,28381,28711,21331,21828,23429,25176,25246,25299,27810,28655,29730,35351,37944,28609,35582,33592,20967,34552,21482],[21481,20294,36948,36784,22890,33073,24061,31466,36799,26842,35895,29432,40008,27197,35504,20025,21336,22022,22374,25285,25506,26086,27470,28129,28251,28845,30701,31471,31658,32187,32829,32966,34507,35477,37723,22243,22727,24382,26029,26262,27264,27573,30007,35527,20516,30693,22320,24347,24677,26234,27744,30196,31258,32622,33268,34584,36933,39347,31689,30044,31481,31569,33988,36880,31209,31378,33590,23265,30528,20013,20210,23449,24544,25277,26172,26609,27880,34411,34935,35387,37198,37619,39376,27159,28710,29482,33511,33879,36015,19969,20806,20939,21899,23541],[24086,24115,24193,24340,24373,24427,24500,25074,25361,26274,26397,28526,29266,30010,30522,32884,33081,33144,34678,35519,35548,36229,36339,37530,38263,38914,40165,21189,25431,30452,26389,27784,29645,36035,37806,38515,27941,22684,26894,27084,36861,37786,30171,36890,22618,26626,25524,27131,20291,28460,26584,36795,34086,32180,37716,26943,28528,22378,22775,23340,32044,29226,21514,37347,40372,20141,20302,20572,20597,21059,35998,21576,22564,23450,24093,24213,24237,24311,24351,24716,25269,25402,25552,26799,27712,30855,31118,31243,32224,33351,35330,35558,36420,36883],[37048,37165,37336,40718,27877,25688,25826,25973,28404,30340,31515,36969,37841,28346,21746,24505,25764,36685,36845,37444,20856,22635,22825,23637,24215,28155,32399,29980,36028,36578,39003,28857,20253,27583,28593,3e4,38651,20814,21520,22581,22615,22956,23648,24466,26007,26460,28193,30331,33759,36077,36884,37117,37709,30757,30778,21162,24230,22303,22900,24594,20498,20826,20908,20941,20992,21776,22612,22616,22871,23445,23798,23947,24764,25237,25645,26481,26691,26812,26847,30423,28120,28271,28059,28783,29128,24403,30168,31095,31561,31572,31570,31958,32113,21040],[33891,34153,34276,35342,35588,35910,36367,36867,36879,37913,38518,38957,39472,38360,20685,21205,21516,22530,23566,24999,25758,27934,30643,31461,33012,33796,36947,37509,23776,40199,21311,24471,24499,28060,29305,30563,31167,31716,27602,29420,35501,26627,27233,20984,31361,26932,23626,40182,33515,23493,37193,28702,22136,23663,24775,25958,27788,35930,36929,38931,21585,26311,37389,22856,37027,20869,20045,20970,34201,35598,28760,25466,37707,26978,39348,32260,30071,21335,26976,36575,38627,27741,20108,23612,24336,36841,21250,36049,32905,34425,24319,26085,20083,20837],[22914,23615,38894,20219,22922,24525,35469,28641,31152,31074,23527,33905,29483,29105,24180,24565,25467,25754,29123,31896,20035,24316,20043,22492,22178,24745,28611,32013,33021,33075,33215,36786,35223,34468,24052,25226,25773,35207,26487,27874,27966,29750,30772,23110,32629,33453,39340,20467,24259,25309,25490,25943,26479,30403,29260,32972,32954,36649,37197,20493,22521,23186,26757,26995,29028,29437,36023,22770,36064,38506,36889,34687,31204,30695,33833,20271,21093,21338,25293,26575,27850,30333,31636,31893,33334,34180,36843,26333,28448,29190,32283,33707,39361,40614],[20989,31665,30834,31672,32903,31560,27368,24161,32908,30033,30048,20843,37474,28300,30330,37271,39658,20240,32624,25244,31567,38309,40169,22138,22617,34532,38588,20276,21028,21322,21453,21467,24070,25644,26001,26495,27710,27726,29256,29359,29677,30036,32321,33324,34281,36009,31684,37318,29033,38930,39151,25405,26217,30058,30436,30928,34115,34542,21290,21329,21542,22915,24199,24444,24754,25161,25209,25259,26e3,27604,27852,30130,30382,30865,31192,32203,32631,32933,34987,35513,36027,36991,38750,39131,27147,31800,20633,23614,24494,26503,27608,29749,30473,32654],[40763,26570,31255,21305,30091,39661,24422,33181,33777,32920,24380,24517,30050,31558,36924,26727,23019,23195,32016,30334,35628,20469,24426,27161,27703,28418,29922,31080,34920,35413,35961,24287,25551,30149,31186,33495,37672,37618,33948,34541,39981,21697,24428,25996,27996,28693,36007,36051,38971,25935,29942,19981,20184,22496,22827,23142,23500,20904,24067,24220,24598,25206,25975,26023,26222,28014,29238,31526,33104,33178,33433,35676,36e3,36070,36212,38428,38468,20398,25771,27494,33310,33889,34154,37096,23553,26963,39080,33914,34135,20239,21103,24489,24133,26381],[31119,33145,35079,35206,28149,24343,25173,27832,20175,29289,39826,20998,21563,22132,22707,24996,25198,28954,22894,31881,31966,32027,38640,25991,32862,19993,20341,20853,22592,24163,24179,24330,26564,20006,34109,38281,38491,31859,38913,20731,22721,30294,30887,21029,30629,34065,31622,20559,22793,29255,31687,32232,36794,36820,36941,20415,21193,23081,24321,38829,20445,33303,37610,22275,25429,27497,29995,35036,36628,31298,21215,22675,24917,25098,26286,27597,31807,33769,20515,20472,21253,21574,22577,22857,23453,23792,23791,23849,24214,25265,25447,25918,26041,26379],[27861,27873,28921,30770,32299,32990,33459,33804,34028,34562,35090,35370,35914,37030,37586,39165,40179,40300,20047,20129,20621,21078,22346,22952,24125,24536,24537,25151,26292,26395,26576,26834,20882,32033,32938,33192,35584,35980,36031,37502,38450,21536,38956,21271,20693,21340,22696,25778,26420,29287,30566,31302,37350,21187,27809,27526,22528,24140,22868,26412,32763,20961,30406,25705,30952,39764,40635,22475,22969,26151,26522,27598,21737,27097,24149,33180,26517,39850,26622,40018,26717,20134,20451,21448,25273,26411,27819,36804,20397,32365,40639,19975,24930,28288],[28459,34067,21619,26410,39749,24051,31637,23724,23494,34588,28234,34001,31252,33032,22937,31885,27665,30496,21209,22818,28961,29279,30683,38695,40289,26891,23167,23064,20901,21517,21629,26126,30431,36855,37528,40180,23018,29277,28357,20813,26825,32191,32236,38754,40634,25720,27169,33538,22916,23391,27611,29467,30450,32178,32791,33945,20786,26408,40665,30446,26466,21247,39173,23588,25147,31870,36016,21839,24758,32011,38272,21249,20063,20918,22812,29242,32822,37326,24357,30690,21380,24441,32004,34220,35379,36493,38742,26611,34222,37971,24841,24840,27833,30290],[35565,36664,21807,20305,20778,21191,21451,23461,24189,24736,24962,25558,26377,26586,28263,28044,29494,29495,30001,31056,35029,35480,36938,37009,37109,38596,34701,22805,20104,20313,19982,35465,36671,38928,20653,24188,22934,23481,24248,25562,25594,25793,26332,26954,27096,27915,28342,29076,29992,31407,32650,32768,33865,33993,35201,35617,36362,36965,38525,39178,24958,25233,27442,27779,28020,32716,32764,28096,32645,34746,35064,26469,33713,38972,38647,27931,32097,33853,37226,20081,21365,23888,27396,28651,34253,34349,35239,21033,21519,23653,26446,26792,29702,29827],[30178,35023,35041,37324,38626,38520,24459,29575,31435,33870,25504,30053,21129,27969,28316,29705,30041,30827,31890,38534,31452,40845,20406,24942,26053,34396,20102,20142,20698,20001,20940,23534,26009,26753,28092,29471,30274,30637,31260,31975,33391,35538,36988,37327,38517,38936,21147,32209,20523,21400,26519,28107,29136,29747,33256,36650,38563,40023,40607,29792,22593,28057,32047,39006,20196,20278,20363,20919,21169,23994,24604,29618,31036,33491,37428,38583,38646,38666,40599,40802,26278,27508,21015,21155,28872,35010,24265,24651,24976,28451,29001,31806,32244,32879],[34030,36899,37676,21570,39791,27347,28809,36034,36335,38706,21172,23105,24266,24324,26391,27004,27028,28010,28431,29282,29436,31725,32769,32894,34635,37070,20845,40595,31108,32907,37682,35542,20525,21644,35441,27498,36036,33031,24785,26528,40434,20121,20120,39952,35435,34241,34152,26880,28286,30871,33109,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[24332,19984,19989,20010,20017,20022,20028,20031,20034,20054,20056,20098,20101,35947,20106,33298,24333,20110,20126,20127,20128,20130,20144,20147,20150,20174,20173,20164,20166,20162,20183,20190,20205,20191,20215,20233,20314,20272,20315,20317,20311,20295,20342,20360,20367,20376,20347,20329,20336,20369,20335,20358,20374,20760,20436,20447,20430,20440,20443,20433,20442,20432,20452,20453,20506,20520,20500,20522,20517,20485,20252,20470,20513,20521,20524,20478,20463,20497,20486,20547,20551,26371,20565,20560,20552,20570,20566,20588,20600,20608,20634,20613,20660,20658],[20681,20682,20659,20674,20694,20702,20709,20717,20707,20718,20729,20725,20745,20737,20738,20758,20757,20756,20762,20769,20794,20791,20796,20795,20799,20800,20818,20812,20820,20834,31480,20841,20842,20846,20864,20866,22232,20876,20873,20879,20881,20883,20885,20886,20900,20902,20898,20905,20906,20907,20915,20913,20914,20912,20917,20925,20933,20937,20955,20960,34389,20969,20973,20976,20981,20990,20996,21003,21012,21006,21031,21034,21038,21043,21049,21071,21060,21067,21068,21086,21076,21098,21108,21097,21107,21119,21117,21133,21140,21138,21105,21128,21137,36776],[36775,21164,21165,21180,21173,21185,21197,21207,21214,21219,21222,39149,21216,21235,21237,21240,21241,21254,21256,30008,21261,21264,21263,21269,21274,21283,21295,21297,21299,21304,21312,21318,21317,19991,21321,21325,20950,21342,21353,21358,22808,21371,21367,21378,21398,21408,21414,21413,21422,21424,21430,21443,31762,38617,21471,26364,29166,21486,21480,21485,21498,21505,21565,21568,21548,21549,21564,21550,21558,21545,21533,21582,21647,21621,21646,21599,21617,21623,21616,21650,21627,21632,21622,21636,21648,21638,21703,21666,21688,21669,21676,21700,21704,21672],[21675,21698,21668,21694,21692,21720,21733,21734,21775,21780,21757,21742,21741,21754,21730,21817,21824,21859,21836,21806,21852,21829,21846,21847,21816,21811,21853,21913,21888,21679,21898,21919,21883,21886,21912,21918,21934,21884,21891,21929,21895,21928,21978,21957,21983,21956,21980,21988,21972,22036,22007,22038,22014,22013,22043,22009,22094,22096,29151,22068,22070,22066,22072,22123,22116,22063,22124,22122,22150,22144,22154,22176,22164,22159,22181,22190,22198,22196,22210,22204,22209,22211,22208,22216,22222,22225,22227,22231,22254,22265,22272,22271,22276,22281],[22280,22283,22285,22291,22296,22294,21959,22300,22310,22327,22328,22350,22331,22336,22351,22377,22464,22408,22369,22399,22409,22419,22432,22451,22436,22442,22448,22467,22470,22484,22482,22483,22538,22486,22499,22539,22553,22557,22642,22561,22626,22603,22640,27584,22610,22589,22649,22661,22713,22687,22699,22714,22750,22715,22712,22702,22725,22739,22737,22743,22745,22744,22757,22748,22756,22751,22767,22778,22777,22779,22780,22781,22786,22794,22800,22811,26790,22821,22828,22829,22834,22840,22846,31442,22869,22864,22862,22874,22872,22882,22880,22887,22892,22889],[22904,22913,22941,20318,20395,22947,22962,22982,23016,23004,22925,23001,23002,23077,23071,23057,23068,23049,23066,23104,23148,23113,23093,23094,23138,23146,23194,23228,23230,23243,23234,23229,23267,23255,23270,23273,23254,23290,23291,23308,23307,23318,23346,23248,23338,23350,23358,23363,23365,23360,23377,23381,23386,23387,23397,23401,23408,23411,23413,23416,25992,23418,23424,23427,23462,23480,23491,23495,23497,23508,23504,23524,23526,23522,23518,23525,23531,23536,23542,23539,23557,23559,23560,23565,23571,23584,23586,23592,23608,23609,23617,23622,23630,23635],[23632,23631,23409,23660,23662,20066,23670,23673,23692,23697,23700,22939,23723,23739,23734,23740,23735,23749,23742,23751,23769,23785,23805,23802,23789,23948,23786,23819,23829,23831,23900,23839,23835,23825,23828,23842,23834,23833,23832,23884,23890,23886,23883,23916,23923,23926,23943,23940,23938,23970,23965,23980,23982,23997,23952,23991,23996,24009,24013,24019,24018,24022,24027,24043,24050,24053,24075,24090,24089,24081,24091,24118,24119,24132,24131,24128,24142,24151,24148,24159,24162,24164,24135,24181,24182,24186,40636,24191,24224,24257,24258,24264,24272,24271],[24278,24291,24285,24282,24283,24290,24289,24296,24297,24300,24305,24307,24304,24308,24312,24318,24323,24329,24413,24412,24331,24337,24342,24361,24365,24376,24385,24392,24396,24398,24367,24401,24406,24407,24409,24417,24429,24435,24439,24451,24450,24447,24458,24456,24465,24455,24478,24473,24472,24480,24488,24493,24508,24534,24571,24548,24568,24561,24541,24755,24575,24609,24672,24601,24592,24617,24590,24625,24603,24597,24619,24614,24591,24634,24666,24641,24682,24695,24671,24650,24646,24653,24675,24643,24676,24642,24684,24683,24665,24705,24717,24807,24707,24730],[24708,24731,24726,24727,24722,24743,24715,24801,24760,24800,24787,24756,24560,24765,24774,24757,24792,24909,24853,24838,24822,24823,24832,24820,24826,24835,24865,24827,24817,24845,24846,24903,24894,24872,24871,24906,24895,24892,24876,24884,24893,24898,24900,24947,24951,24920,24921,24922,24939,24948,24943,24933,24945,24927,24925,24915,24949,24985,24982,24967,25004,24980,24986,24970,24977,25003,25006,25036,25034,25033,25079,25032,25027,25030,25018,25035,32633,25037,25062,25059,25078,25082,25076,25087,25085,25084,25086,25088,25096,25097,25101,25100,25108,25115],[25118,25121,25130,25134,25136,25138,25139,25153,25166,25182,25187,25179,25184,25192,25212,25218,25225,25214,25234,25235,25238,25300,25219,25236,25303,25297,25275,25295,25343,25286,25812,25288,25308,25292,25290,25282,25287,25243,25289,25356,25326,25329,25383,25346,25352,25327,25333,25424,25406,25421,25628,25423,25494,25486,25472,25515,25462,25507,25487,25481,25503,25525,25451,25449,25534,25577,25536,25542,25571,25545,25554,25590,25540,25622,25652,25606,25619,25638,25654,25885,25623,25640,25615,25703,25711,25718,25678,25898,25749,25747,25765,25769,25736,25788],[25818,25810,25797,25799,25787,25816,25794,25841,25831,33289,25824,25825,25260,25827,25839,25900,25846,25844,25842,25850,25856,25853,25880,25884,25861,25892,25891,25899,25908,25909,25911,25910,25912,30027,25928,25942,25941,25933,25944,25950,25949,25970,25976,25986,25987,35722,26011,26015,26027,26039,26051,26054,26049,26052,26060,26066,26075,26073,26080,26081,26097,26482,26122,26115,26107,26483,26165,26166,26164,26140,26191,26180,26185,26177,26206,26205,26212,26215,26216,26207,26210,26224,26243,26248,26254,26249,26244,26264,26269,26305,26297,26313,26302,26300],[26308,26296,26326,26330,26336,26175,26342,26345,26352,26357,26359,26383,26390,26398,26406,26407,38712,26414,26431,26422,26433,26424,26423,26438,26462,26464,26457,26467,26468,26505,26480,26537,26492,26474,26508,26507,26534,26529,26501,26551,26607,26548,26604,26547,26601,26552,26596,26590,26589,26594,26606,26553,26574,26566,26599,27292,26654,26694,26665,26688,26701,26674,26702,26803,26667,26713,26723,26743,26751,26783,26767,26797,26772,26781,26779,26755,27310,26809,26740,26805,26784,26810,26895,26765,26750,26881,26826,26888,26840,26914,26918,26849,26892,26829],[26836,26855,26837,26934,26898,26884,26839,26851,26917,26873,26848,26863,26920,26922,26906,26915,26913,26822,27001,26999,26972,27e3,26987,26964,27006,26990,26937,26996,26941,26969,26928,26977,26974,26973,27009,26986,27058,27054,27088,27071,27073,27091,27070,27086,23528,27082,27101,27067,27075,27047,27182,27025,27040,27036,27029,27060,27102,27112,27138,27163,27135,27402,27129,27122,27111,27141,27057,27166,27117,27156,27115,27146,27154,27329,27171,27155,27204,27148,27250,27190,27256,27207,27234,27225,27238,27208,27192,27170,27280,27277,27296,27268,27298,27299],[27287,34327,27323,27331,27330,27320,27315,27308,27358,27345,27359,27306,27354,27370,27387,27397,34326,27386,27410,27414,39729,27423,27448,27447,30428,27449,39150,27463,27459,27465,27472,27481,27476,27483,27487,27489,27512,27513,27519,27520,27524,27523,27533,27544,27541,27550,27556,27562,27563,27567,27570,27569,27571,27575,27580,27590,27595,27603,27615,27628,27627,27635,27631,40638,27656,27667,27668,27675,27684,27683,27742,27733,27746,27754,27778,27789,27802,27777,27803,27774,27752,27763,27794,27792,27844,27889,27859,27837,27863,27845,27869,27822,27825,27838],[27834,27867,27887,27865,27882,27935,34893,27958,27947,27965,27960,27929,27957,27955,27922,27916,28003,28051,28004,27994,28025,27993,28046,28053,28644,28037,28153,28181,28170,28085,28103,28134,28088,28102,28140,28126,28108,28136,28114,28101,28154,28121,28132,28117,28138,28142,28205,28270,28206,28185,28274,28255,28222,28195,28267,28203,28278,28237,28191,28227,28218,28238,28196,28415,28189,28216,28290,28330,28312,28361,28343,28371,28349,28335,28356,28338,28372,28373,28303,28325,28354,28319,28481,28433,28748,28396,28408,28414,28479,28402,28465,28399,28466,28364],[28478,28435,28407,28550,28538,28536,28545,28544,28527,28507,28659,28525,28546,28540,28504,28558,28561,28610,28518,28595,28579,28577,28580,28601,28614,28586,28639,28629,28652,28628,28632,28657,28654,28635,28681,28683,28666,28689,28673,28687,28670,28699,28698,28532,28701,28696,28703,28720,28734,28722,28753,28771,28825,28818,28847,28913,28844,28856,28851,28846,28895,28875,28893,28889,28937,28925,28956,28953,29029,29013,29064,29030,29026,29004,29014,29036,29071,29179,29060,29077,29096,29100,29143,29113,29118,29138,29129,29140,29134,29152,29164,29159,29173,29180],[29177,29183,29197,29200,29211,29224,29229,29228,29232,29234,29243,29244,29247,29248,29254,29259,29272,29300,29310,29314,29313,29319,29330,29334,29346,29351,29369,29362,29379,29382,29380,29390,29394,29410,29408,29409,29433,29431,20495,29463,29450,29468,29462,29469,29492,29487,29481,29477,29502,29518,29519,40664,29527,29546,29544,29552,29560,29557,29563,29562,29640,29619,29646,29627,29632,29669,29678,29662,29858,29701,29807,29733,29688,29746,29754,29781,29759,29791,29785,29761,29788,29801,29808,29795,29802,29814,29822,29835,29854,29863,29898,29903,29908,29681],[29920,29923,29927,29929,29934,29938,29936,29937,29944,29943,29956,29955,29957,29964,29966,29965,29973,29971,29982,29990,29996,30012,30020,30029,30026,30025,30043,30022,30042,30057,30052,30055,30059,30061,30072,30070,30086,30087,30068,30090,30089,30082,30100,30106,30109,30117,30115,30146,30131,30147,30133,30141,30136,30140,30129,30157,30154,30162,30169,30179,30174,30206,30207,30204,30209,30192,30202,30194,30195,30219,30221,30217,30239,30247,30240,30241,30242,30244,30260,30256,30267,30279,30280,30278,30300,30296,30305,30306,30312,30313,30314,30311,30316,30320],[30322,30326,30328,30332,30336,30339,30344,30347,30350,30358,30355,30361,30362,30384,30388,30392,30393,30394,30402,30413,30422,30418,30430,30433,30437,30439,30442,34351,30459,30472,30471,30468,30505,30500,30494,30501,30502,30491,30519,30520,30535,30554,30568,30571,30555,30565,30591,30590,30585,30606,30603,30609,30624,30622,30640,30646,30649,30655,30652,30653,30651,30663,30669,30679,30682,30684,30691,30702,30716,30732,30738,31014,30752,31018,30789,30862,30836,30854,30844,30874,30860,30883,30901,30890,30895,30929,30918,30923,30932,30910,30908,30917,30922,30956],[30951,30938,30973,30964,30983,30994,30993,31001,31020,31019,31040,31072,31063,31071,31066,31061,31059,31098,31103,31114,31133,31143,40779,31146,31150,31155,31161,31162,31177,31189,31207,31212,31201,31203,31240,31245,31256,31257,31264,31263,31104,31281,31291,31294,31287,31299,31319,31305,31329,31330,31337,40861,31344,31353,31357,31368,31383,31381,31384,31382,31401,31432,31408,31414,31429,31428,31423,36995,31431,31434,31437,31439,31445,31443,31449,31450,31453,31457,31458,31462,31469,31472,31490,31503,31498,31494,31539,31512,31513,31518,31541,31528,31542,31568],[31610,31492,31565,31499,31564,31557,31605,31589,31604,31591,31600,31601,31596,31598,31645,31640,31647,31629,31644,31642,31627,31634,31631,31581,31641,31691,31681,31692,31695,31668,31686,31709,31721,31761,31764,31718,31717,31840,31744,31751,31763,31731,31735,31767,31757,31734,31779,31783,31786,31775,31799,31787,31805,31820,31811,31828,31823,31808,31824,31832,31839,31844,31830,31845,31852,31861,31875,31888,31908,31917,31906,31915,31905,31912,31923,31922,31921,31918,31929,31933,31936,31941,31938,31960,31954,31964,31970,39739,31983,31986,31988,31990,31994,32006],[32002,32028,32021,32010,32069,32075,32046,32050,32063,32053,32070,32115,32086,32078,32114,32104,32110,32079,32099,32147,32137,32091,32143,32125,32155,32186,32174,32163,32181,32199,32189,32171,32317,32162,32175,32220,32184,32159,32176,32216,32221,32228,32222,32251,32242,32225,32261,32266,32291,32289,32274,32305,32287,32265,32267,32290,32326,32358,32315,32309,32313,32323,32311,32306,32314,32359,32349,32342,32350,32345,32346,32377,32362,32361,32380,32379,32387,32213,32381,36782,32383,32392,32393,32396,32402,32400,32403,32404,32406,32398,32411,32412,32568,32570],[32581,32588,32589,32590,32592,32593,32597,32596,32600,32607,32608,32616,32617,32615,32632,32642,32646,32643,32648,32647,32652,32660,32670,32669,32666,32675,32687,32690,32697,32686,32694,32696,35697,32709,32710,32714,32725,32724,32737,32742,32745,32755,32761,39132,32774,32772,32779,32786,32792,32793,32796,32801,32808,32831,32827,32842,32838,32850,32856,32858,32863,32866,32872,32883,32882,32880,32886,32889,32893,32895,32900,32902,32901,32923,32915,32922,32941,20880,32940,32987,32997,32985,32989,32964,32986,32982,33033,33007,33009,33051,33065,33059,33071,33099],[38539,33094,33086,33107,33105,33020,33137,33134,33125,33126,33140,33155,33160,33162,33152,33154,33184,33173,33188,33187,33119,33171,33193,33200,33205,33214,33208,33213,33216,33218,33210,33225,33229,33233,33241,33240,33224,33242,33247,33248,33255,33274,33275,33278,33281,33282,33285,33287,33290,33293,33296,33302,33321,33323,33336,33331,33344,33369,33368,33373,33370,33375,33380,33378,33384,33386,33387,33326,33393,33399,33400,33406,33421,33426,33451,33439,33467,33452,33505,33507,33503,33490,33524,33523,33530,33683,33539,33531,33529,33502,33542,33500,33545,33497],[33589,33588,33558,33586,33585,33600,33593,33616,33605,33583,33579,33559,33560,33669,33690,33706,33695,33698,33686,33571,33678,33671,33674,33660,33717,33651,33653,33696,33673,33704,33780,33811,33771,33742,33789,33795,33752,33803,33729,33783,33799,33760,33778,33805,33826,33824,33725,33848,34054,33787,33901,33834,33852,34138,33924,33911,33899,33965,33902,33922,33897,33862,33836,33903,33913,33845,33994,33890,33977,33983,33951,34009,33997,33979,34010,34e3,33985,33990,34006,33953,34081,34047,34036,34071,34072,34092,34079,34069,34068,34044,34112,34147,34136,34120],[34113,34306,34123,34133,34176,34212,34184,34193,34186,34216,34157,34196,34203,34282,34183,34204,34167,34174,34192,34249,34234,34255,34233,34256,34261,34269,34277,34268,34297,34314,34323,34315,34302,34298,34310,34338,34330,34352,34367,34381,20053,34388,34399,34407,34417,34451,34467,34473,34474,34443,34444,34486,34479,34500,34502,34480,34505,34851,34475,34516,34526,34537,34540,34527,34523,34543,34578,34566,34568,34560,34563,34555,34577,34569,34573,34553,34570,34612,34623,34615,34619,34597,34601,34586,34656,34655,34680,34636,34638,34676,34647,34664,34670,34649],[34643,34659,34666,34821,34722,34719,34690,34735,34763,34749,34752,34768,38614,34731,34756,34739,34759,34758,34747,34799,34802,34784,34831,34829,34814,34806,34807,34830,34770,34833,34838,34837,34850,34849,34865,34870,34873,34855,34875,34884,34882,34898,34905,34910,34914,34923,34945,34942,34974,34933,34941,34997,34930,34946,34967,34962,34990,34969,34978,34957,34980,34992,35007,34993,35011,35012,35028,35032,35033,35037,35065,35074,35068,35060,35048,35058,35076,35084,35082,35091,35139,35102,35109,35114,35115,35137,35140,35131,35126,35128,35148,35101,35168,35166],[35174,35172,35181,35178,35183,35188,35191,35198,35203,35208,35210,35219,35224,35233,35241,35238,35244,35247,35250,35258,35261,35263,35264,35290,35292,35293,35303,35316,35320,35331,35350,35344,35340,35355,35357,35365,35382,35393,35419,35410,35398,35400,35452,35437,35436,35426,35461,35458,35460,35496,35489,35473,35493,35494,35482,35491,35524,35533,35522,35546,35563,35571,35559,35556,35569,35604,35552,35554,35575,35550,35547,35596,35591,35610,35553,35606,35600,35607,35616,35635,38827,35622,35627,35646,35624,35649,35660,35663,35662,35657,35670,35675,35674,35691],[35679,35692,35695,35700,35709,35712,35724,35726,35730,35731,35734,35737,35738,35898,35905,35903,35912,35916,35918,35920,35925,35938,35948,35960,35962,35970,35977,35973,35978,35981,35982,35988,35964,35992,25117,36013,36010,36029,36018,36019,36014,36022,36040,36033,36068,36067,36058,36093,36090,36091,36100,36101,36106,36103,36111,36109,36112,40782,36115,36045,36116,36118,36199,36205,36209,36211,36225,36249,36290,36286,36282,36303,36314,36310,36300,36315,36299,36330,36331,36319,36323,36348,36360,36361,36351,36381,36382,36368,36383,36418,36405,36400,36404,36426],[36423,36425,36428,36432,36424,36441,36452,36448,36394,36451,36437,36470,36466,36476,36481,36487,36485,36484,36491,36490,36499,36497,36500,36505,36522,36513,36524,36528,36550,36529,36542,36549,36552,36555,36571,36579,36604,36603,36587,36606,36618,36613,36629,36626,36633,36627,36636,36639,36635,36620,36646,36659,36667,36665,36677,36674,36670,36684,36681,36678,36686,36695,36700,36706,36707,36708,36764,36767,36771,36781,36783,36791,36826,36837,36834,36842,36847,36999,36852,36869,36857,36858,36881,36885,36897,36877,36894,36886,36875,36903,36918,36917,36921,36856],[36943,36944,36945,36946,36878,36937,36926,36950,36952,36958,36968,36975,36982,38568,36978,36994,36989,36993,36992,37002,37001,37007,37032,37039,37041,37045,37090,37092,25160,37083,37122,37138,37145,37170,37168,37194,37206,37208,37219,37221,37225,37235,37234,37259,37257,37250,37282,37291,37295,37290,37301,37300,37306,37312,37313,37321,37323,37328,37334,37343,37345,37339,37372,37365,37366,37406,37375,37396,37420,37397,37393,37470,37463,37445,37449,37476,37448,37525,37439,37451,37456,37532,37526,37523,37531,37466,37583,37561,37559,37609,37647,37626,37700,37678],[37657,37666,37658,37667,37690,37685,37691,37724,37728,37756,37742,37718,37808,37804,37805,37780,37817,37846,37847,37864,37861,37848,37827,37853,37840,37832,37860,37914,37908,37907,37891,37895,37904,37942,37931,37941,37921,37946,37953,37970,37956,37979,37984,37986,37982,37994,37417,38e3,38005,38007,38013,37978,38012,38014,38017,38015,38274,38279,38282,38292,38294,38296,38297,38304,38312,38311,38317,38332,38331,38329,38334,38346,28662,38339,38349,38348,38357,38356,38358,38364,38369,38373,38370,38433,38440,38446,38447,38466,38476,38479,38475,38519,38492,38494],[38493,38495,38502,38514,38508,38541,38552,38549,38551,38570,38567,38577,38578,38576,38580,38582,38584,38585,38606,38603,38601,38605,35149,38620,38669,38613,38649,38660,38662,38664,38675,38670,38673,38671,38678,38681,38692,38698,38704,38713,38717,38718,38724,38726,38728,38722,38729,38748,38752,38756,38758,38760,21202,38763,38769,38777,38789,38780,38785,38778,38790,38795,38799,38800,38812,38824,38822,38819,38835,38836,38851,38854,38856,38859,38876,38893,40783,38898,31455,38902,38901,38927,38924,38968,38948,38945,38967,38973,38982,38991,38987,39019,39023,39024],[39025,39028,39027,39082,39087,39089,39094,39108,39107,39110,39145,39147,39171,39177,39186,39188,39192,39201,39197,39198,39204,39200,39212,39214,39229,39230,39234,39241,39237,39248,39243,39249,39250,39244,39253,39319,39320,39333,39341,39342,39356,39391,39387,39389,39384,39377,39405,39406,39409,39410,39419,39416,39425,39439,39429,39394,39449,39467,39479,39493,39490,39488,39491,39486,39509,39501,39515,39511,39519,39522,39525,39524,39529,39531,39530,39597,39600,39612,39616,39631,39633,39635,39636,39646,39647,39650,39651,39654,39663,39659,39662,39668,39665,39671],[39675,39686,39704,39706,39711,39714,39715,39717,39719,39720,39721,39722,39726,39727,39730,39748,39747,39759,39757,39758,39761,39768,39796,39827,39811,39825,39830,39831,39839,39840,39848,39860,39872,39882,39865,39878,39887,39889,39890,39907,39906,39908,39892,39905,39994,39922,39921,39920,39957,39956,39945,39955,39948,39942,39944,39954,39946,39940,39982,39963,39973,39972,39969,39984,40007,39986,40006,39998,40026,40032,40039,40054,40056,40167,40172,40176,40201,40200,40171,40195,40198,40234,40230,40367,40227,40223,40260,40213,40210,40257,40255,40254,40262,40264],[40285,40286,40292,40273,40272,40281,40306,40329,40327,40363,40303,40314,40346,40356,40361,40370,40388,40385,40379,40376,40378,40390,40399,40386,40409,40403,40440,40422,40429,40431,40445,40474,40475,40478,40565,40569,40573,40577,40584,40587,40588,40594,40597,40593,40605,40613,40617,40632,40618,40621,38753,40652,40654,40655,40656,40660,40668,40670,40669,40672,40677,40680,40687,40692,40694,40695,40697,40699,40700,40701,40711,40712,30391,40725,40737,40748,40766,40778,40786,40788,40803,40799,40800,40801,40806,40807,40812,40810,40823,40818,40822,40853,40860,40864],[22575,27079,36953,29796,20956,29081,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];for(let t in c)for(let i in c[t])0!=c[t][i]&&(l[c[t][i]]={x:i,y:t});function f(t){let i,n,r,c,f,d=!1;if(r=4,c=12,f=0,t<128&&(i=Math.floor(t%16)*e,n=Math.floor(t/16)*s,r=e,c=s,f=0),t>=parseInt("FF60",16)&&t<=parseInt("FF9F",16)){let h=t-parseInt("FF60",16);i=Math.floor(h%16)*e,n=Math.floor(h/16)*s+10*s,r=e,c=s,f=1}void 0!==l[t]&&(i=l[t].x*h,n=l[t].y*o,r=h,c=o,d=!0,f=2);let p={};return p.img=d?u:a,p.x=i,p.y=n,p.w=r,p.h=c,p.type=f,p}this.print=function(t,i,e){for(let s=0,n=t.length;s<n;s++){let n=f(t.charCodeAt(s));r.drawImgXYWHXYWH(n.img,n.x,n.y,n.w,n.h,i,e,n.w,n.h),i+=n.w}},this.putchr=function(t,i,e,s){Boolean(s)||(s=1);for(var n=0,h=t.length;n<h;n++){let h=f(t.charCodeAt(n)),o=i,a=e;r.drawImgXYWHXYWH(h.img,h.x,h.y,h.w-1,h.h-1,o,a,Math.floor(h.w*s),Math.floor(h.h*s)),i+=h.w*s}}}function GameAssetManager(){var t=[];this.imageLoad=function(i,e){return t[i]=new ImageAsset(e),t[i].img},this.image=t,ImageAsset=function(t){this.uri=t,this.ready=!1,this.img=new Image,this.img.src=t,this.loadcheck=function(){return this.ready=this.img.complete,this.img.complete}};var i=[];this.soundLoad=function(t,e){return i[t]=new AudioAsset(e),i[t].sound},this.sound=i,AudioAsset=function(t){var i=".mp3";"probably"==(new Audio).canPlayType("audio/ogg")&&(i=".ogg"),this.ready=!1,this.sound=new Audio(t+i),this.sound.addEventListener("loadeddata",(function(t){this.ready=!0})),this.uri=t+i,this.pos=0,this.loadcheck=function(){return this.ready=0!=this.sound.readyState,this.sound.readyState}},this.check=function(){var e=[];for(var s in t){var n=t[s].uri.split("/",20);e.push("["+s+"] "+n[n.length-1]+" "+(t[s].loadcheck()?"o":"x"))}var h=["Noting","Mata","Current","Future","Ok"];for(var s in i){n=i[s].uri.split("/",20);var o=i[s].loadcheck();e.push("["+s+"] "+n[n.length-1]+" "+o+"/"+h[o])}return e},this.namelist=function(){var e=[];for(var s in t){t[s].uri.split("/",20);e.push(s)}for(var s in i){i[s].uri.split("/",20);e.push(s)}return e}}function GameCore(t){var i=0,e=Date.now();window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,s){++i>60&&(i=1,e=Date.now());var n=e+Math.round(i*(1e3/60))-Date.now();n<=0&&(n=1),setTimeout(t,n)};var s=!1,n=new GameTaskControl(this),h=new inputKeyboard,o=new inputMouse,r=new inputGamepad,a=new inputTouchPad(t.canvasId),u=new inputVirtualPad(o,a),l=[],c=document.getElementById(t.canvasId);c.width=t.screen[0].resolution.w,c.height=t.screen[0].resolution.h,this.systemCanvas=c;var f=c.getContext("2d");for(var d in t.screen){var p=t.screen[d];l[d]=new DisplayControl(f,p.resolution.w,p.resolution.h,p.resolution.x,p.resolution.y,t.offscreen)}if(t.length>0)var m=l[0];var v=new GameSpriteControl(this),y=[];this.setSpFont=function(t){var i=new GameSpriteFontControl(this,{Image:g.image[t.id].img,pattern:t.pattern});y[t.name]=i};var g=new GameAssetManager,w=new soundControl(g),b=t.screen.length,x=new function(){var t,i,e,s,n=[],h=[],o=0,r=0,a=0,u=0,l=0,c=0;this.start=function(){t=i,i=performance.now()},this.end=function(){e=performance.now()-i,s=i-t,o>r&&(r=o),n[o]=s,h[o]=e,++o>59&&(o=0);for(var u=0,l=0;l<=r;l++)u+=n[l];a=1e3/(u/(r+1))},this.result=function(){for(var t,i,e=0,s=999,o=0,u=999,l=0,c=0,f=0;f<=r;f++)e<n[f]&&(e=n[f]),s>n[f]&&(s=n[f]),o<h[f]&&(o=h[f]),u>h[f]&&(u=h[f]),l+=h[f],c+=n[f];t=c/(r+1),i=l/(r+1);var d={};d.fps=a;var p={};p.log=n,p.max=o,p.min=u,p.ave=i;var m={};return m.log=n,m.max=e,m.min=s,m.ave=t,d.interval=m,d.workload=p,d},this.setTime=function(t){l=u,(c+=(u=t)-l)>1500&&(c=0)},this.readTime=function(){return u-l},this.nowTime=function(){return u},this.blink=function(){return c<500}},k=[];for(d=0;d<b;d++)k[d]=0;function _(t){if(s){x.setTime(t),x.start(),n.step();for(var i=0;i<b;i++)l[i].getInterval()-k[i]==1&&(l[i].reflash(),l[i].clear());n.draw(),v.allDrawSprite();for(i=0;i<b;i++)l[i].draw();x.end();for(i=0;i<b;i++)k[i]++,k[i]>=l[i].getInterval()&&(k[i]=0);requestAnimationFrame(arguments.callee)}}this.task=n,this.asset=g,this.keyboard=h,this.mouse=o,this.gamepad=r,this.joystick=r,this.touchpad=a,this.vgamepad=u,this.dsp=m,this.screen=l,this.sound=w,this.sprite=v,this.font=y,this.state={},this.fpsload=x,this.deltaTime=x.readTime,this.time=x.nowTime,this.blink=x.blink,v.useScreen(0),this.run=function(){s=!0,requestAnimationFrame(_)},this.pause=function(){s=!1}}class GameTask{id;enable;visible;preFlag;constructor(t){this.id=t,this.enable=!0,this.visible=!0,this.preFlag=!1}init(t){}pre(t){}step(t){}draw(t){}post(t){}}function GameTaskControl(t){var i=[],e=0,s="";function n(){for(var t in e=0,s="",i)s+=t+" ",e++}this.read=function(t){return i[t]},this.add=function(e){i[e.id]=e,e.init(t),n()},this.del=function(t){i[t].post(),delete i[t],n()},this.init=function(e){i[e].init(t)},this.step=function(){for(var e in i){var s=i[e];s.preFlag||(s.pre(t),s.preFlag=!0),s.enable&&s.step(t)}},this.draw=function(){for(var e in i){var s=i[e];s.visible&&s.draw(t)}},this.count=function(){return e},this.namelist=function(){return s}}function inputGamepad(){let t,i=window.Gamepad,e=navigator.getGamepads;this.upkey,this.downkey,this.leftkey=!1,this.rightkey=!1,this.btn_start=!1,this.btn_back=!1,this.btn_lb=!1,this.btn_rb=!1,this.btn_lt=!1,this.btn_rt=!1,this.btn_l3=!1,this.btn_r3=!1,this.btn_a=!1,this.btn_b=!1,this.btn_x=!1,this.btn_y=!1,this.r,this.ls_x,this.ls_y,this.rs_x,this.rs_y;let s=!1;this.button,this.axes,this.check=function(){if(s=!1,!i||!e)return!1;t=navigator.getGamepads();let n=[];for(let i in t)Boolean(t[i])&&n.push(i);let h=Math.min(...n),o=t[h];return!!o&&(s=!0,this.update(o),s)},this.update=function(t){var i=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],e=t.buttons,s=t.axes;this.button=e,this.axes=s,this.upkey=!!Boolean(e[i[12]])&&e[i[12]].pressed,this.downkey=!!Boolean(e[i[13]])&&e[i[13]].pressed,this.leftkey=!!Boolean(e[i[14]])&&e[i[14]].pressed,this.rightkey=!!Boolean(e[i[15]])&&e[i[15]].pressed,this.btn_start=!!Boolean(e[i[9]])&&e[i[9]].pressed,this.btn_back=!!Boolean(e[i[8]])&&e[i[8]].pressed,this.btn_lb=!!Boolean(e[i[4]])&&e[i[4]].pressed,this.btn_rb=!!Boolean(e[i[5]])&&e[i[5]].pressed,this.btn_lt=!!Boolean(e[i[6]])&&e[i[6]].pressed,this.btn_rt=!!Boolean(e[i[7]])&&e[i[7]].pressed,this.btn_l3=!!Boolean(e[i[10]])&&e[i[10]].pressed,this.btn_r3=!!Boolean(e[i[11]])&&e[i[11]].pressed,this.btn_a=!!Boolean(e[i[0]])&&e[i[0]].pressed,this.btn_b=!!Boolean(e[i[1]])&&e[i[1]].pressed,this.btn_x=!!Boolean(e[i[2]])&&e[i[2]].pressed,this.btn_y=!!Boolean(e[i[3]])&&e[i[3]].pressed,this.ls_x=Boolean(s[0])?s[0]:0,this.ls_y=Boolean(s[1])?s[1]:0,this.rs_x=Boolean(s[2])?s[2]:0,this.rs_y=Boolean(s[3])?s[3]:0;var n,h,o=Math.floor(100*s[0]),r=Math.floor(100*s[1]);this.r=Math.abs(o)<10&&Math.abs(r)<10?-1:(h=100*r,0==(n=100*o)?h>=0?180:0:Math.atan(h/n)*(180/Math.PI)+(n>=0?90:270))},this.infodraw=function(){let i=[];i.push("[Gamepad] max:"+t.length);let e=[];for(let s in t)Boolean(t[s])?(i.push("no:"+s+", type:"+t[s].mapping),i.push("id:"+t[s].id),e.push(s)):i.push("no."+s+" not Connect");i.push("--------------------------------");let s=Math.min(...e);if(t[s]){let e=t[s];i.push("Use No:"+s+", type:"+e.mapping),i.push("id:"+e.id),i.push(""),i.push("Up   ["+(this.upkey?"o":"-")+"] Down ["+(this.downkey?"o":"-")+"] Left ["+(this.leftkey?"o":"-")+"] Right["+(this.rightkey?"o":"-")+"]"),i.push(""),i.push("(A)  ["+(this.btn_a?"o":"-")+"] (B)  ["+(this.btn_b?"o":"-")+"] (X)  ["+(this.btn_x?"o":"-")+"] (Y)  ["+(this.btn_y?"o":"-")+"]"),i.push(""),i.push("BACK ["+(this.btn_back?"o":"-")+"] START["+(this.btn_start?"o":"-")+"]"),i.push("LB   ["+(this.btn_lb?"o":"-")+"] RB   ["+(this.btn_rb?"o":"-")+"]"),i.push("LT   ["+(this.btn_lt?"o":"-")+"] RT   ["+(this.btn_rt?"o":"-")+"]"),i.push("L3   ["+(this.btn_l3?"o":"-")+"] R3   ["+(this.btn_r3?"o":"-")+"]"),i.push(""),i.push("r = "+this.r),i.push(""),i.push("Ls_x: "+this.ls_x),i.push("Ls_y: "+this.ls_y),i.push("Rs_x: "+this.rs_x),i.push("Rs_y: "+this.rs_y)}else i.push("Not Ready.");return i}}function inputKeyboard(){var t=[];this.upkey=!1,this.downkey=!1,this.leftkey=!1,this.rightkey=!1,this.shift=!1,this.ctrl=!1,this.alt=!1,this.space=!1,this.qkey=!1,this.wkey=!1,this.ekey=!1,this.akey=!1,this.skey=!1,this.dkey=!1,this.zkey=!1,this.xkey=!1,this.ckey=!1,window.addEventListener("blur",(function(i){t=[]}),!1),window.addEventListener("keydown",(function(i){t[i.keyCode]=!0}),!1),window.addEventListener("keyup",(function(i){t[i.keyCode]=!1}),!1),this.check=function(){for(var i in function(){this.upkey=!1,this.downkey=!1,this.leftkey=!1,this.rightkey=!1,this.shift=!1,this.ctrl=!1,this.space=!1,this.qkey=!1,this.wkey=!1,this.ekey=!1,this.akey=!1,this.skey=!1,this.dkey=!1,this.zkey=!1,this.xkey=!1,this.ckey=!1}(),t)switch(i){case"16":this.shift=t[16];break;case"17":this.ctrl=t[17];break;case"18":this.alt=t[18];break;case"32":this.space=t[32];break;case"38":this.upkey=t[38];break;case"40":this.downkey=t[40];break;case"37":this.leftkey=t[37];break;case"39":this.rightkey=t[39];break;case"65":this.akey=t[65];break;case"67":this.ckey=t[67];break;case"68":this.dkey=t[68];break;case"69":this.ekey=t[69];break;case"81":this.qkey=t[81];break;case"83":this.skey=t[83];break;case"87":this.wkey=t[87];break;case"88":this.xkey=t[88];break;case"90":this.zkey=t[90];break;default:break}return t},this.state=function(){return t}}function inputMouse(){var t={x:0,y:0,button:0,wheel:0},i=0,e=0,s=-1,n=0,h=document;h.addEventListener("mousemove",(function(t){i=t.clientX,e=t.clientY}),!1),h.addEventListener("mousedown",(function(t){s=t.button}),!1),h.addEventListener("mouseup",(function(t){s=-1}),!1),h.addEventListener("mousewheel",(function(t){n=t.wheelDelta}),!1),h.addEventListener("DOMMouseScroll",(function(t){n=t.detail}),!1),this.check=function(){return t.x=i,t.y=e,t.button=s,t.wheel=n,0!=s&&(s=-1),n=0,t},this.check_last=function(){return t.x=i,t.y=e,t.button=s,t.wheel=n,t},this.draw=function(t){var i=this.check_last(),e={};e.x=i.x,e.y=i.y,e.draw=function(t){var i=t;i.beginPath(),i.moveTo(this.x,this.y),i.lineTo(this.x+10,this.y+10),i.globalAlpha=1,i.strokeStyle="white",i.lineWidth=3,i.stroke()},t.putFunc(e)}}function inputTouchPad(t){var i=[],e=document.getElementById(t);this.o_Left=e.offsetLeft,this.o_Top=e.offsetTop;var s=!1;function n(t){t.preventDefault(),o(t),s=!0}function h(t){t.preventDefault(),o(t),s=!1}function o(t){if(i=[],t.touches.length>0)for(var e=0;e<t.touches.length;e++){var s=t.touches[e];i[e]={},i[e].x=s.pageX,i[e].y=s.pageY,i[e].id=s.identifier}}document.addEventListener("touchstart",n,{passive:!1}),document.addEventListener("touchmove",n,{passive:!1}),document.addEventListener("touchend",h,{passive:!1}),document.addEventListener("touchcancel",h,{passive:!1}),this.check=function(){var t={};return t.pos=i,t},this.check_last=function(){var t={};return t.pos=i,t},this.draw=function(t){if(s){this.check_last();for(var e="p "+i.length+"/",n=0;n<=i.length-1;n++){e=e+"b"+n+" ";var h={};h.x=i[n].x,h.y=i[n].y,h.r=16,h.draw=function(t){var i=t;i.beginPath(),i.arc(this.x,this.y,this.r,0,2*Math.PI,!0),i.strokeStyle="white",i.lineWidth=2,i.stroke()},t.putFunc(h)}}}}function inputVirtualPad(t,i){for(var e={X:80,Y:320,R:75},s=[],n=0;n<=1;n++)s[n]={},s[n].X=440+80*(n+1),s[n].Y=320,s[n].R=28,s[n].ON=!1;for(n=0;n<=1;n++)s[n+2]={},s[n+2].X=560,s[n+2].Y=280+80*n,s[n+2].R=28,s[n+2].ON=!1;var h=[],o=0,r=[],a=-1,u=!1;function l(t,i,e,s){var n,h=e-t,o=s-i;return 0==h?n=o>=0?180:0:(n=function(t){return t*(180/Math.PI)}(Math.atan(o/h)),h>=0&&o>=0&&(n=90+n),h>=0&&o<0&&(n=90+n),h<0&&o<0&&(n=270+n),h<0&&o>=0&&(n=270+n)),n}function c(t,i,e,s){return Math.floor(Math.sqrt(Math.pow(Math.abs(t-e),2)+Math.pow(Math.abs(i-s),2)))}this.check=function(){var n=i.check_last(),f=t.check_last();h=[],n.pos.length<=0?-1!=f.button?(h.push({x:f.x,y:f.y}),u=!0):u=!1:(h=n.pos,u=!0),o=0,r=[];for(var d=0;d<=p;d++)r[d]=!1;a=-1;var p=s.length-1,m=0,v=-1;if(h.length>0)for(var y=0;y<h.length;y++){var g=c(h[y].x,h[y].y,e.X,e.Y);e.R>g&&(m=Math.floor(l(e.X,e.Y,h[y].x,h[y].y)),v=g);for(d=0;d<=p;d++)s[d].R>c(s[d].X,s[d].Y,h[y].x,h[y].y)&&(r[d]=!0)}o=m,a=v;var w={};return w.button=r,w.deg=m,w.distance=v,w},this.check_last=function(){var t={};return t.button=r,t.deg=o,t.distance=a,t},this.draw=function(t){if(u){var i=this.check_last(),n=s.length-1;(a={}).x=e.X,a.y=e.Y,a.r=e.R,a.bt=s,a.draw=function(t){var i=t;i.beginPath(),i.arc(this.x,this.y,this.r,0,2*Math.PI,!0),i.fillStyle="gray",i.globalAlpha=.5,i.fill();for(var e=0;e<=this.bt.length-1;e++)i.beginPath(),i.arc(this.bt[e].X,this.bt[e].Y,this.bt[e].R,0,2*Math.PI,!0),i.fillStyle="gray",i.fill()},t.putFunc(a);var o="p "+h.length+"/";if(i.distance>0)o=o+"d "+i.deg+":"+i.distance,(a={}).x=e.X,a.y=e.Y,a.vx=Math.cos(ToRadian(i.deg-90))*e.R,a.vy=Math.sin(ToRadian(i.deg-90))*e.R,a.sr=(i.deg+225)%360/180*Math.PI,a.draw=function(t){var i=t;i.beginPath(),i.strokeStyle="orange",i.lineWidth=60,i.arc(this.x,this.y,40,this.sr,this.sr+.5*Math.PI,!1),i.stroke()},t.putFunc(a);for(var r=0;r<=n;r++){var a;if(i.button[r])o=o+"b"+r+" ",(a={}).x=e.X,a.y=e.Y,a.r=e.R,a.bt=s[r],a.draw=function(t){var i=t;i.beginPath(),i.arc(this.bt.X,this.bt.Y,this.bt.R-5,0,2*Math.PI,!0),i.fillStyle="orange",i.fill()},t.putFunc(a)}}},ToRadian=t=>t*(Math.PI/180)}function offScreen(){for(var t=4e3,i=0,e=[],s=0;s<t;s++)e[s]=new g;var n=[],h=0;function o(){return++i>=t&&(i=0),e[i]}var r=!0,a=!0;this.view=function(t){return"boolean"==typeof t&&(r=t),r},this.flip=function(t){return"boolean"==typeof t&&(a=t),r},this.spPut=function(t,i,e,s,h,r,a,l,c,f,d,p,m,v,y,g,w){var b=o();b.img=t,b.sx=i,b.sy=e,b.sw=s,b.sh=h,b.dx=r,b.dy=a,b.dw=l,b.dh=c,b.m11=f,b.m12=d,b.m21=p,b.m22=m,b.tx=v,b.ty=y,b.alpha=g,b.r=w,b.mode=u,n[n.length]=b},this.drawImgXYWHXYWH=function(t,i,e,s,h,r,a,u,c){var f=o();f.img=t,f.sx=i,f.sy=e,f.sw=s,f.sh=h,f.dx=r,f.dy=a,f.dw=u,f.dh=c,f.mode=l,n[n.length]=f},this.fillText=function(t,i,e,s){Boolean(s)||(s="limegreen");var h=o();h.text=t,h.sx=i,h.sy=e,h.color=s,h.mode=d,n[n.length]=h},this.drawImgXY=function(t,i,e){var s=o();s.img=t,s.sx=i,s.sy=e,s.mode=f,n[n.length]=s},this.drawImgXYWH=function(t,i,e,s,h){var r=o();r.img=t,r.sx=i,r.sy=e,r.sw=s,r.sh=h,r.mode=c,n[n.length]=r},this.putImageTransform=function(t,i,e,s,h,r,a){var u=o();u.img=t,u.tx=i,u.ty=e,u.m11=s,u.m12=h,u.m21=r,u.m22=a,u.mode=p,n[n.length]=u},this.transform=function(t,i,e,s){var h=o();h.m11=t,h.m12=i,h.m21=e,h.m22=s,h.mode=m,n[n.length]=h},this.putFunc=function(t){n[n.length]=t},this.allClear=function(t,i,e,s){var h=o();h.sx=t,h.sy=i,h.sw=e,h.sh=s,h.mode=v,n[n.length]=h},this.fillRect=function(t,i,e,s,h){var r=o();r.sx=t,r.sy=i,r.sw=e,r.sh=s,r.color=h,r.mode=y,n[n.length]=r},this.reset=function(){n.length>t&&(n.length=0),n=[],i=0},this.reflash=function(){a&&this.reset()},this.draw=function(t){if(r){for(var i=0,e=n.length;i<e;i++)n[i].draw(t);h<n.length&&(h=n.length)}},this.count=function(){return n.length},this.max=function(){return h};var u=1,l=2,c=3,f=4,d=5,p=6,m=7,v=8,y=9;function g(){this.img,this.text,this.sx,this.sy,this.sw,this.sh,this.dx,this.dy,this.dw,this.dh,this.color,this.m11,this.m12,this.m21,this.m22,this.tx,this.ty,this.alpha,this.r,this.mode}g.prototype.func=[],g.prototype.func[0]=function(t){},g.prototype.func[u]=function(t){t.save(),t.setTransform(this.m11,this.m12,this.m21,this.m22,this.tx,this.ty),0!=this.r&&t.rotate(Math.PI/180*this.r),255==this.alpha?t.globalCompositeOperation="source-over":t.globalAlpha=this.alpha*(1/255),t.drawImage(this.img,this.sx,this.sy,this.sw,this.sh,this.dx,this.dy,this.dw,this.dh),t.restore()},g.prototype.func[l]=function(t){t.drawImage(this.img,this.sx,this.sy,this.sw,this.sh,this.dx,this.dy,this.dw,this.dh)},g.prototype.func[c]=function(t){t.drawImage(this.img,this.sx,this.sy,this.sw,this.sh)},g.prototype.func[f]=function(t){t.drawImage(this.img,this.sx,this.sy)},g.prototype.func[d]=function(t){t.fillStyle=this.color,t.fillText(this.text,this.sx,this.sy)},g.prototype.func[p]=function(t){t.save(),t.setTransform(this.m11,this.m12,this.m21,this.m22,this.tx,this.ty),t.drawImage(this.img,0,0),t.restore()},g.prototype.func[m]=function(t){},g.prototype.func[v]=function(t){},g.prototype.func[y]=function(t){Boolean(this.color)?(t.fillStyle=this.color,t.fillRect(this.sx,this.sy,this.sw,this.sh)):t.clearRect(this.sx,this.sy,this.sw,this.sh)},g.prototype.draw=function(t){this.func[this.mode].call(this,t)}}function offScreenTypeC(t,i,e,s){const n=new OffscreenCanvas(t,i),h=e,o=s;n.width=t,n.height=i;const r=n.getContext("2d");var a=!0,u=!0;this.view=function(t){return"boolean"==typeof t&&(a=t),a},this.flip=function(t){return"boolean"==typeof t&&(u=t),a},this.spPut=function(t,i,e,s,n,h,o,a,u,l,c,f,d,p,m,v,y){r.save(),r.setTransform(l,c,f,d,p,m),0!=y&&r.rotate(Math.PI/180*y),255==v?r.globalCompositeOperation="source-over":r.globalAlpha=v*(1/255),r.drawImage(t,i,e,s,n,h,o,a,u),r.restore()},this.drawImgXYWHXYWH=function(t,i,e,s,n,h,o,a,u){r.drawImage(t,i,e,s,n,h,o,a,u)},this.fillText=function(t,i,e,s){Boolean(s)||(s="limegreen"),r.fillStyle=s,r.fillText(t,i,e)},this.drawImgXY=function(t,i,e){r.drawImage(t,i,e)},this.drawImgXYWH=function(t,i,e,s,n){r.drawImage(t,i,e,s,n)},this.putImageTransform=function(t,i,e,s,n,h,o){r.save(),r.setTransform(s,n,h,o,i,e),r.drawImage(t,0,0),r.restore()},this.transform=function(t,i,e,s){},this.putFunc=function(t){t.draw(r)},this.allClear=function(t,i,e,s){r.save(),r.setTransform(1,0,0,1,0,0),r.clearRect(t,i,e,s),r.restore()},this.fillRect=function(t,i,e,s,n){Boolean(n)?(r.fillStyle=n,r.fillRect(t,i,e,s)):r.clearRect(t,i,e,s)},this.reset=function(){u&&this.allClear(0,0,t,i)},this.reflash=function(){u&&this.reset()},this.draw=function(t){a&&t.drawImage(n,h,o)},this.count=function(){return"mode"},this.max=function(){return"C"}}function soundControl(t){var i=t.sound;this.play=function(t){var e=i[t].sound;e.ended&&(e.currentTime=0),e.play()},this.effect=function(t){Boolean(i[t])&&(i[t].sound.currentTime=0,i[t].sound.play())},this.running=function(t){return!i[t].ended},this.info=function(t){var e=i[t];return e.currentTime/e.duration*100},this.restart=function(t){i[t].currentTime=0},this.volume=function(t,e){i[t].volume=e}}function GameSpriteControl(t){let i,e=[],s=[],n=!0;function h(){this.x=0,this.y=0,this.r=0,this.z=0,this.vx=0,this.vy=0,this.priority=0,this.collisionEnable=!0,this.collision={w:0,h:0},this.id="",this.count=0,this.pcnt=0,this.visible=!1,this.hit=[],this.alive=0,this.index=0,this.living=!0,this.view=function(){this.visible=!0},this.hide=function(){this.visible=!1},this.pos=function(t,i,e=0,s=0){this.x=t,this.y=i,this.r=e,this.z=s},this.move=function(t,i,e){this.visible=!0;let s=(t-90)*(Math.PI/180);this.vx=Math.cos(s)*i,this.vy=Math.sin(s)*i,this.r=t,this.alive=e},this.stop=function(){this.alive=0,this.vx=0,this.vy=0},this.dispose=function(){this.alive=0,this.visible=!1,this.living=!1},this.put=function(t,e,n=0,h=1){Boolean(s[this.id])?(o(s[this.id].image,s[this.id].pattern[this.pcnt],t,e,n,h),this.count++,this.count>s[this.id].wait&&(this.count=0,this.pcnt++),this.pcnt>s[this.id].pattern.length-1&&(this.pcnt=0)):i.fillText(this.index+" "+this.count,t,e)},this.reset=function(){this.x=0,this.y=0,this.r=0,this.z=0,this.vx=0,this.vy=0,this.priority=0,this.collisionEnable=!0,this.collision={w:0,h:0},this.id="",this.count=0,this.pcnt=0,this.visible=!1,this.hit=[],this.alive=0,this.index=0,this.living=!0},this.debug=function(){let t=[];return t.push("this.x"+this.x),t.push("this.y"+this.y),t.push("this.r"+this.r),t.push("this.z"+this.z),t.push("this.vx"+this.vx),t.push("this.vy"+this.vy),t.push("this.priority"+this.priority),t.push("this.collisionEnable"+this.collisionEnable),t.push("this.collision"+this.collision),t.push("this.id,"+this.id),t.push("this.count,"+this.count),t.push("this.pcnt,"+this.pcnt),t.push("this.visible,"+this.visible),t.push("this.hit,"+this.hit),t.push("this.alive,"+this.alive),t.push("this.index,"+this.index),t.push("this.living,"+this.living),t}}function o(t,e,s,n,h,o,r){if(Boolean(h)||(h=e.r),Boolean(r)||(r=255),Boolean(o)||(o=1),!e.fv&&!e.fh&&0==h&&255==r)i.drawImgXYWHXYWH(t,e.x,e.y,e.w,e.h,s+-e.w/2*o,n+-e.h/2*o,e.w*o,e.h*o);else{let a=e.fv?-1:1,u=e.fh?-1:1;i.spPut(t,e.x,e.y,e.w,e.h,-e.w/2*o,-e.h/2*o,e.w*o,e.h*o,u,0,0,a,s,n,r,h)}}this.itemCreate=function(t,i=!1,s=0,n=0){const o=new h;let r=e.length;return e.push(o),o.reset(),o.index=r,o.id=t,o.count=0,o.pcnt=0,o.collisionEnable=i,o.collision={w:s,h:n},o},this.itemList=function(){return e},this.itemFlash=function(){e=[]},this.itemIndexRefresh=function(){let t=[];for(let i in e)e[i].living&&t.push(e[i]);for(let i in t)t[i].index=i;return e=t,e},this.manualDraw=function(t=!0){n=!t},this.useScreen=function(e){i=t.screen[e].buffer},this.setPattern=function(i,e){s[i]={image:t.asset.image[e.image].img,wait:e.wait,pattern:e.pattern}},this.CollisionCheck=function(){let t=[];for(let i in e){let s=e[i];s.living&&s.collisionEnable&&t.push(s)}for(let i in t){let e=t[i];e.hit=[];for(let s in t)if(i!=s){let i=t[s];Math.abs(e.x-i.x)<e.collision.w/2+i.collision.w/2&&Math.abs(e.y-i.y)<e.collision.h/2+i.collision.h/2&&e.hit.push(i)}}};const r=new function(){let t=[];this.add=i=>{t.push(i)},this.sort=()=>{t.sort(((t,i)=>t.priority-i.priority))},this.buffer=()=>t,this.reset=()=>{t=[]}};this.allDrawSprite=function(){if(n){r.reset();for(let t in e){let i=e[t];i.living&&r.add(i)}r.sort();let t=r.buffer();for(let e in t){let n=t[e];n.alive>0&&(n.alive--,n.x+=n.vx,n.y+=n.vy,n.alive<=0?n.visible=!1:n.visible=!0),n.visible&&(Boolean(s[n.id])?(o(s[n.id].image,s[n.id].pattern[n.pcnt],n.x,n.y,n.r,n.z),n.count++,n.count>s[n.id].wait&&(n.count=0,n.pcnt++),n.pcnt>s[n.id].pattern.length-1&&(n.pcnt=0)):i.fillText(e+" "+n.count,n.x,n.y))}}}}function GameSpriteFontControl(t,i){var e=t.screen[0].buffer;this.useScreen=function(i){e=t.screen[i].buffer};var s=i.Image,n=i.pattern;this.putchr=function(t,i,h,o){var r=!1;Boolean(o)?1!=o&&(r=!0):o=1;for(var a=0,u=t.length;a<u;a++){var l=t.charCodeAt(a);if(l>=32&&l<128){var c=n[l-32],f=i+a*(c.w*o),d=h;r&&(f+=-c.w/2*o,d+=-c.h/2*o),e.drawImgXYWHXYWH(s,c.x,c.y,c.w,c.h,f,d,c.w*o,c.h*o)}}}}
</script>
<script type="text/javascript">
function sce_boss_0(){this.init=function(t,e){e.vset(8),e.get_target(98),e.w_cnt=0,e.custom_draw_enable=!0},this.draw=sce_boss_damage_gr,this.move=function(t,e){switch(e.frame){case 15:e.get_target(98),e.vset(0);break;case 22:e.vector=e.target_v();break;case 27:break;case 32:e.set_object(103);break;case 60:e.frame=12,e.w_cnt++;break;default:break}return e.frame++,e.w_cnt>10&&(e.w_cnt=5,e.vector+=Math.floor(180*Math.random()),e.vset(1),e.frame=0),e.sc_move()}}function sce_boss_1(){this.init=function(t,e){e.name="boss",e.vset(4),e.chr=1,e.display_size=.001,e.weight=2,e.hit_x*=2,e.hit_y*=2,e.custom_draw_enable=!1,e.cnt=0},this.draw=sce_boss_damage_gr,this.move=function(t,e){return e.alive<1e3?e.display_size=e.alive/1e3*2:(e.display_size=2,e.custom_draw_enable=!0,e.cnt+=e.vecfrm,e.cnt>7&&(e.cnt=0,e.set_object(30)),e.vset(2),e.vector=(e.vector+8*e.vecfrm+360)%360),2==e.status&&(e.set_object_ex(14,e.x,e.y,180,50),e.status=2),e.sc_move()}}function sce_boss_2(){const t=2e3;this.init=function(t,e){e.name="boss",e.vset(1),e.get_target(98),e.w_cnt=0,e.display_size=2,e.weight=4,e.hit_x*=2,e.hit_y*=2,e.custom_draw_enable=!0,e.smode=0,e.maxhp=300},this.draw=sce_boss_damage_gr,this.move=function(e,i){if(i.alive<t)i.alpha=i.alive/t*255,i.hp=i.maxhp;else{i.display_size=2,i.type=2,i.get_target(98),i.vector=i.target_v(),i.vset(1);let e=Math.trunc((i.alive-t)/100)%100;if(e<=1&&(i.smode=1,i.get_target(98),i.vector=i.target_v(),i.vset(1)),i.vset(1),e>10&&e<45&&i.vset(0),e>15&&1==i.smode&&(i.set_object_ex(32,i.x,i.y,(i.vector+90)%360,49),i.set_object_ex(32,i.x,i.y,(i.vector+270)%360,49),i.set_object(3),i.smode=2),e>50&&e<90&&i.vset(0),e>55&&2==i.smode){let t=(i.vector+90)%360,e=(i.vector+270)%360;i.set_object_ex(32,i.x+32*i.Cos(t),i.y+32*i.Sin(t),i.vector,51),i.set_object_ex(32,i.x,i.y,i.vector,51),i.set_object_ex(32,i.x+32*i.Cos(e),i.y+32*i.Sin(e),i.vector,51),i.smode=0}}return 2==i.status&&i.bomb(),i.sc_move()}}function sce_boss_damage_gr(t,e){Boolean(e.hpbbw)||(e.hpbbw=Math.trunc(e.hp/e.maxhp*100)),cl={};let i=e.gt.worldtoView(e.x,e.y);cl.x=i.x,cl.y=i.y+3*e.display_size,cl.sr=e.hp/e.maxhp*.5*Math.PI,cl.bbw=e.hpbbw/100*.5*Math.PI;let o=Math.trunc(e.hp/e.maxhp*100);e.hpbbw>o&&(e.hpbbw=e.hpbbw-1),e.hpbbw<=o&&(e.hpbbw=o),cl.cbar=e.hp/e.maxhp>.5?"limegreen":"yellowgreen",cl.cborder=e.hp/e.maxhp>.5?"white":e.hp/e.maxhp>.3?"yellow":"orange",cl.colf=e.hp/e.maxhp>.3,cl.draw=function(t){let e=.75*Math.PI,i=.25*Math.PI,o=e-this.sr,n=e-this.bbw;t.beginPath(),t.strokeStyle="red",t.lineWidth="5",t.beginPath(),t.arc(this.x,this.y,42,e,n,!0),t.stroke(),t.beginPath(),t.strokeStyle=this.cbar,t.lineWidth="5",t.beginPath(),t.arc(this.x,this.y,42,e,o,!0),t.stroke(),t.beginPath(),t.strokeStyle=this.cborder,t.lineWidth="1",t.arc(this.x,this.y,40,e,i,!0),t.stroke(),t.beginPath(),t.arc(this.x,this.y,44,e,i,!0),t.stroke()},t.putFunc(cl)}function character(){let t=[[0,1,10,98,16,16,24,16,0,0],[6,26,8,1,16,16,16,16,"common_vset6",0],[7,26,8,1,16,16,16,16,"pl_bullet_rotate_circle",0],[11,7,8,1,16,16,32,32,18,0],[10,42,2,1,8,24,32,32,"friend_rotate",0],[36,35,2,1,8,24,48,48,"friend_straight",0],[37,36,1,1,8,8,16,16,20,0],[38,40,3,1,16,8,24,24,"friend_rotate_full",0],[39,41,1,1,8,16,24,24,"friend_rotate",0],[1,4,8,2,16,16,24,16,0,10],[14,4,90,2,16,16,24,24,0,50],[30,7,1,3,8,8,6,6,33,0],[33,31,240,2,16,16,24,24,0,10],[34,4,120,2,16,16,32,32,0,30],[2,7,1,3,4,4,6,6,4,0],[3,7,2,3,4,4,6,6,4,0],[4,7,4,2,4,4,6,6,14,10],[5,7,1,3,4,4,6,6,4,0],[8,46,1,3,4,4,6,6,"en_bullet_homing",0],[12,7,1,3,4,4,6,6,18,0],[32,7,5,3,8,8,16,16,49,0],[41,42,2,3,8,24,16,16,"friend_rotate",0],[42,40,2,3,16,8,16,16,"friend_rotate_full",0],[43,36,1,3,8,8,16,16,"friend_boom",0],[44,35,3,3,8,24,16,16,"friend_straight",0],[45,41,1,3,8,16,16,16,"friend_rotate",0],[15,38,1,4,12,12,24,24,30,0],[16,15,1,4,12,12,24,24,30,0],[17,37,1,4,12,12,24,24,30,0],[18,16,1,4,12,12,24,24,30,0],[19,17,1,4,12,12,24,24,30,0],[20,26,1,4,8,8,16,16,30,4],[21,1,1,4,16,16,32,32,30,100],[22,27,1,4,8,8,16,16,30,10],[23,28,1,4,8,8,16,16,30,8],[24,29,1,4,8,8,16,16,30,8],[25,30,1,4,8,8,16,16,30,8],[26,33,1,4,12,12,24,24,30,10],[27,34,1,4,12,12,24,24,30,10],[35,32,1,4,8,8,16,16,30,10],[40,39,1,2,12,12,24,24,30,100],[46,44,1,1,8,8,16,16,"common_vset8",0],[47,43,1,1,8,8,16,16,"friend_front",0],[48,44,1,3,8,8,16,16,"common_vset8",0],[49,43,1,3,8,8,16,16,"friend_front",0],[50,18,1,4,12,12,24,24,30,0],[51,50,1,4,12,12,24,24,30,100],[52,51,1,4,12,12,24,24,30,100],[53,52,1,4,12,12,24,24,30,100],[54,53,1,4,12,12,24,24,30,100],[55,54,1,4,12,12,24,24,30,100],[56,55,1,4,12,12,24,24,30,100],[57,56,1,4,12,12,24,24,30,100],[58,57,1,4,12,12,24,24,30,100],[100,45,1,5,8,8,16,16,"effect_informationCursor",0],[103,8,1,3,8,8,6,6,103,0],[9,11,1,4,16,8,32,16,4,100]],e=[];for(let i in t){let o=t[i],n={};n.mp=o[1],n.hp=o[2],n.type=o[3],n.center_x=o[4],n.center_y=o[5],n.size_x=o[6],n.size_y=o[7],n.senario=[o[8]],n.id=0,n.score=o[9],e[o[0]]=n}return e}try{!Object.prototype.__defineGetter__&&Object.defineProperty({},"x",{get:function(){return!0}}).x&&(Object.defineProperty(Object.prototype,"__defineGetter__",{enumerable:!1,configurable:!0,value:function(t,e){Object.defineProperty(this,t,{get:e,enumerable:!0,configurable:!0})}}),Object.defineProperty(Object.prototype,"__defineSetter__",{enumerable:!1,configurable:!0,value:function(t,e){Object.defineProperty(this,t,{set:e,enumerable:!0,configurable:!0})}}))}catch(t){}function CLinear4TreeManager(){let t=0;this.level=0,this.w=0,this.h=0,this.l=0,this.t=0,this.unitW=0,this.unitH=0,this.cellNum=0,this.cellAry=null,this.dim=0,this.colList=new o,this.pow=new Array(10),this.pow[0]=1;for(let t=1;t<10;t++)this.pow[t]=4*this.pow[t-1];function e(t){this.id=t||0,this.cell=this.obj=this.pre=this.next=null}function i(){this.latest=null}function o(){let t=new Array;return t.wright=function(t,e){this.push(t),this.push(e)},t}function n(t,e){let i=this.cellAry[t].getFirstObj();for(;i;){let t=i.next;for(;t;)this.colList.wright(i.obj,t.obj),t=t.next;for(let t=0,o=e.length;t<o;t++)this.colList.wright(i.obj,e[t]);i=i.next}let o=!1,n=0;for(let s=0;s<4;s++){let a=4*t+1+s;if(a<this.cellNum&&this.cellAry[a]){if(!o)for(i=this.cellAry[t].getFirstObj();i;)e.push(i.obj),n++,i=i.next;o=!0,arguments.callee.call(this,a,e)}}if(o)for(let t=0;t<n;t++)e.pop();return!0}function s(t){for(;!(this.cellAry[t]||(this.cellAry[t]=new i,(t=t-1>>2)<0||t>=this.cellNum)););return!0}function a(t,e,i,o){let n=this.l+this.w-1,s=this.t+this.h-1;if(t>n||i<this.l||e>s||o<this.t)return 2147483647;t<this.l&&(t=this.l),i>n&&(i=n),e<this.t&&(e=this.t),o>s&&(o=s);let a=l.call(this,t,e),r=l.call(this,i,o),c=r^a,h=0;for(let t=0;t<this.level;t++){0!=(c>>2*t&3)&&(h=t+1)}let m=r>>2*h;return m+=(this.pow[this.level-h]-1)/3,m>this.cellNum?2147483647:m}function r(t){return 1431655765&((t=858993459&((t=252645135&((t=16711935&(t|t<<8))|t<<4))|t<<2))|t<<1)}function l(t,e){return i=parseInt((t-this.l)/this.unitW),o=parseInt((e-this.t)/this.unitH),r(i)|r(o)<<1;var i,o}e.prototype.remove=function(){return!(!this.cell||!this.cell.onRemove(this))&&(this.pre&&(this.pre.next=this.next),this.next&&(this.next.pre=this.pre),this.pre=this.next=this.cell=null,!0)},i.prototype.push=function(e){return!!e&&(e.cell!=this&&(this.latest?(e.next=this.latest,this.latest.pre=e,this.latest=e):this.latest=e,e.cell=this,t++,!0))},i.prototype.getFirstObj=function(){return this.latest},i.prototype.onRemove=function(e){return this.latest==e&&this.latest&&(this.latest=this.latest.next),t--,!0},this.init=function(t,e,i,o,n){return!(t>=9)&&(this.cellNum=(this.pow[t+1]-1)/3,this.cellAry=new Array(this.cellNum),this.l=e,this.t=i,this.w=o-e,this.h=n-i,this.unitW=this.w/(1<<t),this.unitH=this.h/(1<<t),this.level=t,!0)},this.register=function(t,e,i,o,n){let r=a.call(this,t,e,i,o);return r<this.cellNum&&(!this.cellAry[r]&&s.call(this,r),this.cellAry[r].push(n))},this.getAllCollisionList=function(){let t=!1;if(this.cellAry[0]){let e=[];n.call(this,0,e),t=this.colList,this.colList=new o}return t},this.createObjectForTree=function(t){return new e(t)},this.getMortonNumber=function(t,e,i,o){return a.call(this,t,e,i,o)},this.getPointElem=function(t,e){return l.call(this,t,e)},this.__defineGetter__("objectNum",(function(){return t}))}function sce_common_vset(t){this.init=function(e,i){i.vset(t)},this.move=function(t,e){return e.sc_move()}}function sce_common_signal(t){this.init=function(t,e){e.vset(0),e.normal_draw_enable=!1,e.custom_draw_enable=!1,e.x=e.gt.world_x+1,e.y=e.gt.world_y+1},this.move=function(e,i){return i.x=i.gt.world_x+1,i.y=i.gt.world_y+1,0==i.frame?i.SIGNAL(t):(i.SIGNAL(0),i.status=0),i.frame++,i.sc_move()}}function Dangeon(t){MAP_W=30,MAP_H=30,MINIMUM_ROOM_SIZE=3,MARGIN_BETWEEN_RECT_ROOM=2,MINIMUM_RECT_SIZE=MINIMUM_ROOM_SIZE+2*MARGIN_BETWEEN_RECT_ROOM,COUPLE_VERTICAL=0,COUPLE_HORIZONAL=1;let e=new function(t){let e=t;this.next=function(){let t=(1103515245*e+12345)%32768;return e=t,t/32767.1}}(Math.floor(1e6*Math.random()));function i(){this.lx=0,this.ly=0,this.hx=MINIMUM_ROOM_SIZE,this.hy=MINIMUM_ROOM_SIZE}function o(){this.done_split_v=!1,this.done_split_h=!1,this.lx=0,this.ly=0,this.hx=MINIMUM_RECT_SIZE,this.hy=MINIMUM_RECT_SIZE,this.room=new i}function n(){this.v_or_h=COUPLE_HORIZONAL,this.rect0=new o,this.rect1=new o}let s=[],a=[],r=[],l=[[]],h=[[]],m=[[]],u=[[]],f=[],_=[],p=[];function y(){for(let t=0;t<MAP_W;t++)for(let e=0;e<MAP_H;e++)l[t][e]?l[t][e]=!1:l[t][e]=!0;let t=[-1,0,1,-1,1,-1,0,1],e=[-1,-1,-1,0,0,1,1,1],i=[[]];for(let o=0;o<MAP_W;o++){h[o]=[],i[o]=[];for(let n=0;n<MAP_H;n++){let s=!0,a=0;if(0!=o&&o!=MAP_H-1&&0!=n&&n!=MAP_W-1){for(let i in t)l[o+t[i]][n+e[i]]||a++;if(h[o][n]=a,l[o][n])for(let i in t)l[o+t[i]][n+e[i]]||(s=!1);i[o][n]=s}else i[o][n]=s,h[o][n]=a}}for(let i=0;i<MAP_W;i++){u[i]=[];for(let o=0;o<MAP_H;o++){if(!l[i][o]){let t={};t.x=i,t.y=o,f.push(t)}let n=0;if(0==i||i==MAP_H-1||0==o||o==MAP_W-1);else{let s=0;for(let a in t)l[i+t[a]][o+e[a]]&&(n+=Math.pow(2,s)),s++}3==n&&(n=2),6==n&&(n=2),7==n&&(n=2),9==n&&(n=8),40==n&&(n=8),41==n&&(n=8),20==n&&(n=16),144==n&&(n=16),148==n&&(n=16),96==n&&(n=64),192==n&&(n=64),224==n&&(n=64),15==n&&(n=11),43==n&&(n=11),59==n&&(n=27),139==n&&(n=15),23==n&&(n=22),150==n&&(n=22),87==n&&(n=86),158==n&&(n=30),105==n&&(n=104),232==n&&(n=104),121==n&&(n=120),234==n&&(n=106),212==n&&(n=208),240==n&&(n=208),220==n&&(n=216),242==n&&(n=210),63==n&&(n=31),159==n&&(n=31),111==n&&(n=107),235==n&&(n=107),215==n&&(n=214),246==n&&(n=214),249==n&&(n=248),252==n&&(n=248),25==n&&(n=24),28==n&&(n=24),56==n&&(n=24),152==n&&(n=24),29==n&&(n=24),57==n&&(n=24),153==n&&(n=24),60==n&&(n=24),156==n&&(n=24),184==n&&(n=24),67==n&&(n=66),70==n&&(n=66),98==n&&(n=66),194==n&&(n=66),71==n&&(n=66),99==n&&(n=66),195==n&&(n=66),102==n&&(n=66),198==n&&(n=66),226==n&&(n=66),u[i][o]=n}}for(let t=0;t<MAP_W;t++){m[t]=[];for(let e=0;e<MAP_H;e++)!l[t][e]&&h[t][e]>=8?m[t][e]=!0:m[t][e]=!1,!l[t][e]&&h[t][e]>=5?h[t][e]=!0:h[t][e]=!1,i[t][e]&&(l[t][e]=!1)}for(let t=0;t<MAP_W;t++)for(let e=0;e<MAP_H;e++)if(h[t][e]){let i={};i.x=t,i.y=e,_.push(i)}for(let t=0;t<MAP_W;t++)for(let e=0;e<MAP_H;e++)if(m[t][e]){let i={};i.x=t,i.y=e,p.push(i)}}function w(t,e,i,o){let n,s,a,r,c,h;if(n=Math.min(t,i),s=Math.max(t,i),a=Math.min(e,o),r=Math.max(e,o),t<=i&&e>=o){for(c=n;c<=s;c++)l[c][r]=!0;for(h=a;h<=r;h++)l[s][h]=!0}else if(t>i&&e>o){for(c=n;c<=s;c++)l[c][a]=!0;for(h=a;h<=r;h++)l[s][h]=!0}else if(t>i&&e<=o){for(c=n;c<=s;c++)l[c][a]=!0;for(h=a;h<=r;h++)l[n][h]=!0}else if(t<=i&&e<o){for(c=n;c<=s;c++)l[c][r]=!0;for(h=a;h<=r;h++)l[n][h]=!0}else;}function g(t){let e=new o;if(t.hy-t.ly<=2*MINIMUM_RECT_SIZE&&(t.done_split_v=!0),t.hx-t.lx<=2*MINIMUM_RECT_SIZE&&(t.done_split_h=!0),!t.done_split_v||!t.done_split_h){if(e=v(t.lx,t.ly,t.hx,t.hy),0==t.done_split_v){let i;return i=x(t.ly+MINIMUM_RECT_SIZE,t.hy-MINIMUM_RECT_SIZE),t.hy=i,e.ly=i,t.done_split_v=!0,e.done_split_v=!0,b(COUPLE_VERTICAL,t,e),g(t),void g(e)}if(0==t.done_split_h){let i;return i=x(t.lx+MINIMUM_RECT_SIZE,t.hx-MINIMUM_RECT_SIZE),t.hx=i,e.lx=i,t.done_split_h=!0,e.done_split_h=!0,b(COUPLE_HORIZONAL,t,e),g(t),void g(e)}}}function v(t,e,i,n){let a=new o;return a.lx=t,a.ly=e,a.hx=i,a.hy=n,s.push(a),a}function d(t,e,o,n){let s=new i;return s.lx=t,s.ly=e,s.hx=o,s.hy=n,a.push(s),s}function b(t,e,i){let o=new n;return o.v_or_h=t,o.rect0=e,o.rect1=i,r.push(o),o}function x(t,i){return Math.floor(e.next()*(i-t))+t}this.create=function(){for(let t=0;t<MAP_W;t++){l[t]=[];for(let e=0;e<MAP_H;e++)l[t][e]=!1}s=[],a=[],r=[],g(v(0,0,MAP_W-1,MAP_H-1)),function(){let t,e,i,o;for(let n in s){let a=s[n];i=x(MINIMUM_ROOM_SIZE,a.hx-a.lx-2*MARGIN_BETWEEN_RECT_ROOM+1),o=x(MINIMUM_ROOM_SIZE,a.hy-a.ly-2*MARGIN_BETWEEN_RECT_ROOM+1),t=x(a.lx+MARGIN_BETWEEN_RECT_ROOM,a.hx-MARGIN_BETWEEN_RECT_ROOM-i+1),e=x(a.ly+MARGIN_BETWEEN_RECT_ROOM,a.hy-MARGIN_BETWEEN_RECT_ROOM-o+1),a.room=d(t,e,t+i,e+o)}}(),function(){let t,e;rectmap=[[]];for(let t=0;t<MAP_W;t++){rectmap[t]=[];for(let e=0;e<MAP_H;e++)rectmap[t][e]=null}for(let i in s){let o=s[i];for(t=o.lx;t<o.hx;t++)for(e=o.ly;e<o.hy;e++)rectmap[t][e]=o}for(t=0;t<MAP_W-2;t++)for(e=0;e<MAP_H-2;e++)Boolean(rectmap[t][e])||alert("rectnull"+t+":"+e),rectmap[t][e]!=rectmap[t][e+1]&&0==x(0,64)&&b(COUPLE_VERTICAL,rectmap[t][e],rectmap[t][e+1]),rectmap[t][e]!=rectmap[t+1][e]&&0==x(0,64)&&b(COUPLE_HORIZONAL,rectmap[t][e],rectmap[t+1][e])}(),function(){let t,e,i,o;for(let t in a){let e=a[t];for(let t=e.lx;t<=e.hx;t++)for(let i=e.ly;i<=e.hy;i++)l[t][i]=!0}for(c in r){let n=r[c];switch(n.v_or_h){case COUPLE_HORIZONAL:t=n.rect0.hx,e=x(n.rect0.room.ly+1,n.rect0.room.hy),i=n.rect1.lx,o=x(n.rect1.room.ly+1,n.rect1.room.hy),w(t,e,i,o),w(n.rect0.room.hx,e,t,e),w(n.rect1.room.lx,o,i,o);break;case COUPLE_VERTICAL:t=x(n.rect0.room.lx+1,n.rect0.room.hx),e=n.rect0.hy,i=x(n.rect1.room.lx+1,n.rect1.room.hx),o=n.rect1.ly,w(t,e,i,o),w(t,n.rect0.room.hy,t,e),w(i,n.rect1.room.ly,i,o);break}}}(),y()},this.mapdata=l,this.room=h,this.inroom=m,this.type=u,this.ml=f,this.rl=_,this.il=p,this.mw=MAP_W,this.mh=MAP_H}function Dangeon_tod(t){MAP_W=10,MAP_H=10,DMAP_W=2*MAP_W+2,DMAP_H=2*MAP_H+2;let e=new function(t){let e=t;this.next=function(){let t=(1103515245*e+12345)%32768;return e=t,t/32767.1}}(t),i=[[]],o=[[]];function n(t,o,s){let a=[0,1,0,-1],r=[-1,0,1,0];return i[t][o]=s,t+a[s]<0||t+a[s]>=MAP_W||o+r[s]<0||o+r[s]>=MAP_H||-1!=i[t+a[s]][o+r[s]]?1:(t+=a[s],o+=r[s],(s+=Math.floor(3*e.next())-1)<0&&(s=3),s>=3&&(s=0),n(t,o,s))}this.map=o,this.mw=DMAP_W,this.mh=DMAP_H,this.create=function(){for(let t=0;t<MAP_W;t++){i[t]=[];for(let e=0;e<MAP_H;e++)i[t][e]=-1}for(let t=0;t<DMAP_W;t++){o[t]=[];for(let e=0;e<DMAP_H;e++)o[t][e]="  "}let t=[0,1,0,-1],s=[-1,0,1,0];for(let t=0;t<MAP_W;t++)for(let o=0;o<MAP_H;o++){let s=Math.floor(4*e.next());-1==i[t][o]&&n(t,o,s)}for(let e=0;e<MAP_W;e++)for(let n=0;n<MAP_H;n++){let a=2*e+1,r=2*n+1,l=i[e][n];o[a][r]="□",o[a+t[l]][r+s[l]]=l%2?"━":"┃"}},this.draw=function(){}}function deviceControl(t){let e=t.screen.length,i=[];for(let o=0;o<e;o++)i[o]=new Screen(t,o);i[0].setBackgroundcolor("black"),this.graphics=i,this.kanji=new fontPrintControl(t,t.asset.image.KanjiHw.img,6,8,t.asset.image.KanjiFw.img,12,8),this.gs=new geometoryTrance,this.layout=new gameLayout,this.mouse_state=t.mouse;t.keyboard;this.gpad_state=t.gamepad,this.sound=new soundCntl(t.asset.sound),this.game=t;let o=new function(t){let e=t.keyboard,i=t.gamepad,o=(t.touchpad,t.vgamepad);this.r=-1,this.a=!1,this.b=!1,this.c=!1,this.d=!1,this.e=!1,this.check=function(){t.state.Config.keyAn;let n=[];i.check()&&(this.r=i.r,this.a=i.btn_a,this.b=i.btn_b,this.c=i.btn_x,this.d=i.btn_y,this.e=i.btn_start,n[38]=i.upkey,n[40]=i.downkey,n[37]=i.leftkey,n[39]=i.rightkey,n[90]=i.btn_x,n[67]=i.btn_a,n[88]=i.btn_b,n[81]=i.btn_y,n[27]=i.btn_start,n[17]=i.btn_rb);let s=o.check();if(s.distance>0){let t=s.deg;(t>=300||t<60)&&(n[38]=!0),t>=30&&t<150&&(n[39]=!0),t>=120&&t<240&&(n[40]=!0),t>=210&&t<330&&(n[37]=!0)}s.button[0]&&(n[90]=s.button[0]),s.button[1]&&(n[88]=s.button[1]),s.button[3]&&(n[67]=s.button[3]);let a=e.check();for(let t in a)n[t]=n[t]||a[t];return n}}(t);this.key_state=o,this.directionM=function(t){const e=[38,40,37,39,87,83,65,68,104,98,100,102];let i=[];for(let o in e)Boolean(t[e[o]])?i[o]=!!t[e[o]]:i[o]=!1;return{up:i[0]||i[4]||i[8],down:i[1]||i[5]||i[9],left:i[2]||i[6]||i[10],right:i[3]||i[7]||i[11]}}}function sce_effect_vanish(){this.init=function(t,e){e.type=5,e.status=5},this.move=function(t,e){return-1}}function sce_effect_bomb(){this.init=function(t,e){e.vset(0),e.mp=12,e.type=5,e.status=5,e.frame=0},this.move=function(t,e){switch(e.frame){case 5:break;case 90:e.status=0;break;default:break}return e.frame++,e.frame>=30&&(e.status=0),e.sc_move()}}function sce_effect_bomb_x(){this.init=function(t,e){e.vset(0),e.type=5,e.status=5,e.frame=0},this.move=function(t,e){switch(e.frame){case 5:break;case 75:e.status=0;break;default:break}return e.frame++,e.frame%5<2?e.visible=!0:e.visible=!1,e.frame>10&&(e.alpha-=3),e.sc_move()}}function sce_effect_hit(){this.init=function(t,e){e.vset(0),e.mp=11,e.type=5,e.status=5,e.frame=0,e.alpha=254},this.move=function(t,e){switch(e.frame){case 5:break;case 60:e.status=0;break;default:break}return e.frame++,e.frame>30&&(e.alpha-=3),e.sc_move()}}function sce_effect_hit_shield(){this.init=function(t,e){e.vset(0),e.mp=11,e.type=5,e.status=5,e.frame=0,e.normal_draw_enable=!1,e.custom_draw_enable=!0},this.move=function(t,e){switch(e.frame){case 5:break;case 30:e.status=0;break;default:break}return e.frame++,e.sc_move()},this.draw=function(t,e){let i=e.gt.worldtoView(e.x,e.y),o={};o.x=i.x,o.y=i.y,o.r=e.frame%15,o.c=e.frame>15?"red":"white",o.draw=function(t){t.beginPath(),t.strokeStyle=this.c,t.lineWidth="2",t.arc(this.x,this.y,this.r,0,2*Math.PI,!1),t.stroke()},t.putFunc(o)}}function sce_effect_billboard(t){this.init=function(e,i){i.vector=t,i.vset(2)},this.move=function(t,e){return e.alpha>10?(e.alpha-=5,e.sc_move()):-1}}function sce_effect_bombcircle(t){this.init=function(t,e){e.vset(0),e.circle_r=20,e.type=5,e.normal_draw_enable=!1,e.custom_draw_enable=!0},this.move=function(t,e){return e.alive>250&&(e.status=0),e.circle_r+=4*(e.alive/10+1),e.sc_move()},this.draw=function(e,i){let o={},n=i.gt.worldtoView(i.x,i.y);o.x=n.x,o.y=n.y,o.r=i.circle_r,o.draw=function(e){e.beginPath(),e.globalCompositeOperation="lighter",e.arc(this.x,this.y,this.r,0,2*Math.PI,!1),e.fillStyle=t,e.fill(),e.globalCompositeOperation="source-over"},e.putFunc(o)}}function sce_effect_warnning_mark(t){this.init=function(t,e){e.vset(0),e.type=5,e.mp=28},this.move=function(t,e){return e.frame>30&&(e.status=0),e.frame++,e.sc_move()}}function sce_effect_bombExp(){this.init=function(t,e){e.vset(0),e.mp=12,e.type=5,e.status=5,e.frame=0,e.custom_draw_enable=!0},this.move=function(t,e){switch(e.frame){case 5:break;case 10:e.set_object_ex(11,e.x,e.y,e.vector,"pl_bullet_subshot_zero");break;case 15:e.set_object_ex(11,e.x,e.y,e.vector,"pl_bullet_subshot_zero");break;case 90:e.status=0;break;default:break}return e.frame++,e.frame>=30&&(e.status=0),e.sc_move()},this.draw=function(t,e){let i=e.gt.worldtoView(e.x,e.y),o={};o.x=i.x,o.y=i.y,o.r=3*(e.frame<16?e.frame:30-e.frame),o.draw=function(t){t.beginPath(),t.fillStyle="red",t.arc(this.x,this.y,this.r,0,2*Math.PI,!1),t.fill()},t.putFunc(o)}}function sce_effect_informationCursor(){this.init=function(t,e){e.vset(0),e.type=5,e.frame=0,e.display_size=1,e.normal_draw_enable=!1,e.custom_draw_enable=!1,e.prioritySurface=!0,e.search_target_item(22)},this.move=function(t,e){return Boolean(e.parent)?0==e.parent.status?1:(e.x=e.parent.x+80*e.Cos(e.vector),e.y=e.parent.y+80*e.Sin(e.vector),e.gt.in_view(e.gameState.key_x,e.gameState.key_y)?(e.normal_draw_enable=!1,e.custom_draw_enable=!1,e.frame%30==0&&e.search_target_item(22)):(e.gameState.keyon&&(e.normal_draw_enable=e.gameState.lamp,e.custom_draw_enable=e.gameState.lamp),e.normal_draw_enable&&(e.search_target_item(22),e.vector=e.target_r(e.gameState.key_x,e.gameState.key_y))),e.frame++,e.sc_move()):1},this.draw=function(t,e){let i=e.gt.worldtoView(e.x,e.y);e.alive%1e3>500&&t.put("sKey",i.x-16*e.Cos(e.vector),i.y-16*e.Sin(e.vector))}}function sce_enemy_move_n(t,e){this.init=function(t,e){e.vset(1),e.pickgetf=!1,e.pickviewitem=0,e.custom_draw_enable=!0},this.draw=sce_enemy_inv_gr,this.move=function(e,i){switch(i.frame){case 80:i.get_target(98);break;case 90:break;case 100:i.vector=i.target_v(),i.set_object(103);break;case 110:i.set_object(3);break;case 120:i.vector+=t,i.vector=i.vector%360,i.vset(1);break;case 140:let e=sce_enemy_inv_check(i.pick);0!=e&&(i.pickgetf=!0,i.pickviewitem=e);break;case 160:i.vector=+t,i.vector=i.vector%360,i.vset(1);break;case 200:i.vector=+t,i.vector=i.vector%360,i.vset(1),i.frame=50;break;default:break}return i.frame++,1==i.jump?(i.shifty=i.shifty+i.jpvec,i.jpvec=i.jpvec+.4*i.vecfrm,i.prioritySurface=!0,i.shifty>0&&(i.jump=0,i.shifty=0,i.prioritySurface=!1,i.colcheck=!0,i.vector=Math.floor(360*Math.random()),i.vset(1),i.wmapc=!1),i.sc_move()):(i.mapCollision&&(i.colcnt>1?(i.wmapc=!0,i.jump=1,i.jpvec=-5.6-.4*i.vecfrm,i.colcheck=!1,i.vector=Math.floor(360*Math.random()),i.vset(1)):i.colcheck=!0),i.sc_move())}}function sce_enemy_turn(t){this.init=function(t,e){e.vset(4),e.pickgetf=!1,e.pickviewitem=0,e.custom_draw_enable=!0},this.draw=sce_enemy_inv_gr,this.move=function(e,i){switch(i.frame){case 5:i.set_object_ex(3,i.x,i.y,i.vector+Math.floor(40*Math.random())-20,"exev_5expansion");break;case 15:i.vector+=t,i.vset(4);break;case 25:i.vector+=t,i.vset(4);break;case 35:i.vector+=t,i.vset(4);break;case 45:i.frame=1;let e=sce_enemy_inv_check(i.pick);0!=e&&(i.pickgetf=!0,i.pickviewitem=e);break;default:break}return i.frame++,1==i.jump?(i.shifty=i.shifty+i.jpvec,i.jpvec=i.jpvec+.4*i.vecfrm,i.prioritySurface=!0,i.shifty>0&&(i.jump=0,i.shifty=0,i.prioritySurface=!1,i.colcheck=!0,i.vector=Math.floor(360*Math.random()),i.vset(4),i.wmapc=!1),i.sc_move()):(i.mapCollision&&(i.colcnt>1?(i.wmapc=!0,i.jump=1,i.jpvec=-5.6-.4*i.vecfrm,i.colcheck=!1,i.vector=Math.floor(360*Math.random()),i.vset(4)):i.colcheck=!0),i.sc_move())}}function sce_enemy_change_s(){this.init=function(t,e){e.vset(4),e.vector=180},this.move=function(t,e){return 15==e.frame&&(e.set_object(102),e.change_sce(9)),e.frame++,e.sc_move()}}function sce_enemy_moveshot(){this.init=function(t,e){e.vset(4),e.pickgetf=!1,e.pickviewitem=0,e.custom_draw_enable=!0},this.draw=sce_enemy_inv_gr,this.move=function(t,e){if(e.vset(4),e.vector>180?e.mp=5:e.mp=4,e.frame%50==5){let t=sce_enemy_inv_check(e.pick);0!=t&&(e.pickgetf=!0,e.pickviewitem=t),e.frame>3600?e.set_object_ex(8,e.x,e.y,e.vector,"en_bullet_homing"):e.set_object_ex(5,e.x,e.y,e.vector,"en_bullet_turn")}return e.frame++,1==e.jump?(e.shifty=e.shifty+e.jpvec,e.jpvec=e.jpvec+.4*e.vecfrm,e.prioritySurface=!0,e.shifty>0&&(e.jump=0,e.shifty=0,e.prioritySurface=!1,e.colcheck=!0,e.vector=Math.floor(360*Math.random()),e.vset(4),e.wmapc=!1),e.sc_move()):(e.mapCollision&&(e.colcnt>1?(e.wmapc=!0,e.jump=1,e.jpvec=-5.6-.4*e.vecfrm,e.colcheck=!1,e.vector=Math.floor(360*Math.random()),e.vset(4)):e.colcheck=!0),e.sc_move())}}function sce_enemy_randomshot(){this.init=function(t,e){e.vset(4),e.w_cnt=0,e.display_size=1.5,e.weight=2,e.hit_x*=1.5,e.hit_y*=1.5,e.hp=20,e.maxhp=e.hp,e.pickgetf=!1,e.pickviewitem=0,e.custom_draw_enable=!0},this.draw=sce_enemy_inv_gr,this.move=function(t,e){switch(e.vector>180?e.mp=5:e.mp=4,e.frame){case 10:e.vset(0);break;case 13:e.set_object(12);break;case 30:e.frame=12,e.w_cnt++;break;default:break}if(e.frame++,e.w_cnt>5){e.w_cnt=0,e.vset(2),e.frame=0;let t=sce_enemy_inv_check(e.pick);0!=t&&(e.pickgetf=!0,e.pickviewitem=t)}return 1==e.jump?(e.shifty=e.shifty+e.jpvec,e.jpvec=e.jpvec+.4*e.vecfrm,e.prioritySurface=!0,e.mapCollision=!1,e.shifty>0&&(e.jump=0,e.shifty=0,e.prioritySurface=!1,e.colcheck=!0,e.vector=Math.floor(360*Math.random()),e.vset(2),e.wmapc=!1),e.sc_move()):(e.vector>180?e.mp=5:e.mp=4,e.mapCollision&&(e.colcnt>1?(e.wmapc=!0,speed=2,e.jump=1,e.jpvec=-5.6-.4*e.vecfrm,e.colcheck=!1,e.vector=Math.floor(360*Math.random()),e.vset(speed)):e.colcheck=!0),e.sc_move())}}function sce_enemy_move_std(){this.init=function(t,e){e.vset(2),e.wmapc=!1,e.colcnt=0},this.move=function(t,e){if(e.frame++,1==e.jump)return e.shifty=e.shifty+e.jpvec,e.jpvec=e.jpvec+.4*e.vecfrm,e.prioritySurface=!0,e.mapCollision=!1,e.shifty>0&&(e.jump=0,e.shifty=0,e.prioritySurface=!1,e.colcheck=!0,e.vector=Math.floor(360*Math.random()),e.vset(2),e.wmapc=!1),e.sc_move();if(e.wmapc){let t=0==Math.floor(2*Math.random())?1:3;e.wmapc=!1,e.vector+=90*t,e.vector=e.vector%360,e.vset(2)}return e.vector>180?e.mp=5:e.mp=4,e.mapCollision&&(e.colcnt>1?(e.wmapc=!0,speed=2,e.jump=1,e.jpvec=-5.6-.4*e.vecfrm,e.colcheck=!1,e.vector=Math.floor(360*Math.random()),e.vset(speed)):e.colcheck=!0),e.sc_move()}}function sce_enemy_move_std2(t,e){const i=t,o=e;this.init=function(t,e){e.vset(2),e.wmapc=!1,e.colcnt=0,e.lockon_flag=!1,e.colcheck=!0,e.get_target(98),e.autotrig=10,e.autoshot=0,e.weapongetf=!1,e.weapontype=0,e.jump=0,e.jpvec=-5,e.shiftx=0,e.shifty=0,e.mvkeytrig=0,e.maxspeed=2,e.pickgetf=!1,e.pickviewitem=0,e.display_size=1,e.custom_draw_enable=!0},this.draw=sce_enemy_inv_gr,this.move=function(t,e){if(e.frame++,1==e.jump)return e.shifty=e.shifty+e.jpvec,e.jpvec=e.jpvec+.4*e.vecfrm,e.prioritySurface=!0,e.shifty>0&&(e.jump=0,e.shifty=0,e.prioritySurface=!1,e.colcheck=!0,e.wmapc=!1),e.sc_move();let n=0;if(Boolean(e.target)&&(e.lockon_flag=e.target_d(e.target.x,e.target.y)<o),e.wmapc?e.mvkeytrig=0:(e.mvkeytrig=e.mvkeytrig++>30?30:e.mvkeytrig,n=e.mvkeytrig/15>e.maxspeed?e.maxspeed:e.mvkeytrig/15),e.wmapc&&e.lockon_flag){let t=e.target_v(),i=0;for(let e=45;e<320;e+=45)t>e-22.5&&t<=e+22.5&&(i=e);e.vector=i,e.vset(n),e.wmapc=!1}if(e.vector>180?e.mp=5:e.mp=4,e.mapCollision&&(e.colcnt>1?(e.wmapc=!0,n=e.maxspeed,e.jump=1,e.jpvec=-5.6-.4*e.vecfrm,e.colcheck=!1,e.vector=Math.floor(360*Math.random()),e.vset(n)):e.colcheck=!0),e.autotrig-=e.vecfrm,e.autotrig<=0&&(e.autoshot=0,e.autotrig=5),e.lockon_flag&&0==e.autoshot&&e.weapongetf)switch(e.autoshot=1,e.autotrig=30,e.weapontype){case 1:e.set_object(41);break;case 2:e.set_object(42);break;case 3:e.set_object(43),e.autotrig=240;break;case 4:e.set_object(44);break;case 6:e.set_object(49),e.set_object(48);break;default:e.set_object(45),e.set_object(2),e.autotrig=240;break}let s=i*(e.mvkeytrig/37.5);if(e.frame>i-s){e.lockon_flag&&e.target_rotate_r(12),e.vset(n),e.frame=0,e.get_target(98);let t=sce_enemy_inv_check(e.pick);if(0!=t){e.pickgetf=!0,e.pickviewitem=t;let i=sce_enemy_weapon_check(t);0!=i&&(e.weapongetf=!0,e.weapontype=i)}}return e.sc_move()}}function sce_enemy_weapon_check(t){let e=[];e[1]=16,e[2]=17,e[3]=19,e[4]=18,e[5]=15,e[6]=50;let i=0;for(let o of e)if(o==t)return i=e.indexOf(o),i;return i}function sce_enemy_move_gen_grow(){this.init=function(t,e){e.vset(2),e.get_target(98),e.display_size=.3,e.colcheck=!1},this.move=function(t,e){return e.frame++,e.vector>180?e.mp=5:e.mp=4,e.display_size=.3+e.frame/20*.7,e.frame>20&&(e.colcheck=!0,e.change_sce("enemy_move_std2")),e.sc_move()}}function sce_enemy_generator(t,e,i,o){const n=t,s=e,a=i,r=o;this.init=function(t,e){e.vset(0),e.gencnt=0,e.lockon_flag=!1,e.mp=31,e.get_target(98),e.hp=18,e.maxhp=e.hp,e.custom_draw_enable=!0},this.draw=sce_enemy_inv_gr,this.move=function(t,e){if(e.frame+=e.vecfrm,Boolean(e.target)&&e.target_d(e.target.x,e.target.y)<r&&(e.lockon_flag=!0),e.frame>n&&Math.trunc(e.frame)%3==0&&(e.display_size=1+(e.frame-n)/200,e.frame>n+40&&(e.display_size=1.05+.05*(1-e.frame%6))),e.frame>n+60){if(e.display_size=1,e.gencnt>=s&&e.change_sce(a),e.lockon_flag&&e.gencnt<s){let t=e.target_v();e.set_object_ex(1,e.x,e.y,t,a),e.gencnt++}e.frame=0,e.get_target(98),e.vset(0)}return e.sc_move()}}function sce_enemy_trbox(){this.init=function(t,e){e.vset(0),e.colcheck=!0,e.attack=0,e.pickgetf=!1,e.pickviewitem=0,Boolean(e.parent)&&(e.pick=e.parent.pick)},this.move=function(t,e){let i=0;if(e.frame++,2==this.status){this.change_sce("effect_bomb_x");for(let t=0;t<this.pick.length;t++)this.set_object_ex(this.pick[t],this.x,this.y,Math.floor(360*Math.random()),"item_movingstop");this.add_score(this.score)}return 0==this.status&&(i=1),this.damageflag=!1,i}}function sce_enemy_trbox_mimic(){this.init=function(t,e){e.vset(0),e.colcheck=!0,e.pickgetf=!1,e.pickviewitem=0,e.pick_enable=!1},this.move=function(t,e){let i=0;if(e.frame++,e.display_size=1+(10-e.frame%20)/200,2==this.status){this.change_sce("effect_bomb_x");let t=Math.floor(4*Math.random())+3;for(let i=0;i<t;i++){let o=360/t*i;e.set_object_ex(1,e.x+16*e.Cos(o),e.y+16*e.Sin(o),o,"enemy_move_std2")}}return 0==this.status&&(i=1),this.damageflag=!1,i}}function sce_enemy_timeover(){this.init=function(t,e){e.name="timeover",e.vset(6),e.get_target(98),e.lifecount=0,e.cancelcol=!0,e.display_size=2,e.hit_x*=2,e.hit_y*=2,e.attack=10,e.pick_enable=!1,e.custom_draw_enable=!0},this.draw=sce_enemy_inv_gr,this.move=function(t,e){switch(e.frame){case 10:e.target_rotate_r(30),e.vset(6);break;case 15:e.get_target(98),e.frame=9;break;default:break}return e.frame++,e.lifecount++,e.lifecount%300==250&&e.set_object_ex(8,e.x,e.y,e.vector,"en_bullet_homing"),e.cancelcol&&(this.mapCollision=!1),e.sc_move()}}function sce_enemy_inv_check(t){let e=[22,27,26,21,15,16,17,18,19,50,51,52,53,54,55,56,57,58,23,24,25,20,,0],i=0;for(let o of e)for(let e of t)if(o==e)return i=e,i;return i}function sce_enemy_inv_gr(t,e){if(e.hp<e.maxhp&&function(){Boolean(e.hpbbw)||(e.hpbbw=Math.trunc(e.hp/e.maxhp*32));let i=e.gt.worldtoView(e.x,e.y);lbar={},lbar.hp=e.hp,lbar.mhp=e.maxhp,lbar.x=i.x+e.shiftx,lbar.y=i.y+e.shifty+e.hit_y+3*e.display_size,lbar.bbw=e.hpbbw;let o=Math.trunc(e.hp/e.maxhp*32);e.hpbbw>o&&(e.hpbbw=e.hpbbw-.32);e.hpbbw<=o&&(e.hpbbw=o);lbar.cbar=lbar.hp/lbar.mhp>.5?"limegreen":"yellowgreen",lbar.cborder=lbar.hp/lbar.mhp>.5?"white":lbar.hp/lbar.mhp>.3?"yellow":"orange",lbar.draw=function(t){t.beginPath(),t.fillStyle="red",t.lineWidth=1,t.fillRect(this.x-16,this.y+3,this.bbw,2),t.stroke(),t.beginPath(),t.fillStyle=this.cbar,t.lineWidth=1,t.fillRect(this.x-16,this.y+3,this.hp/this.mhp*32,2),t.stroke(),t.beginPath(),t.strokeStyle=this.cborder,t.lineWidth=1,t.rect(this.x-17,this.y+2,34,4),t.stroke()},t.putFunc(lbar)}(),!e.pickgetf)return;let i=e.gt.worldtoView(e.x,e.y);if(i.x>=0&&i.x<=t.cw&&i.y>=0&&i.y<=t.ch){let o=i.x+e.shiftx,n=i.y+e.shifty;if(i.x=i.x+16*e.Cos(e.vector),i.y=i.y+16*e.Sin(e.vector),!e.weapongetf||!e.lockon_flag){let o=e.pickviewitem;t.put(e.dict_ch_sp(o),i.x,i.y)}if(e.pick.length>1){let s=0;for(let t of e.pick)35!=t&&s++;s>0&&(i.x=o-e.Cos(e.vector)*e.center_x,i.y=n-e.Sin(e.vector)*e.center_y,t.put("TrBox",i.x,i.y,0,0,255,.75))}}}function sce_en_bullet_homing(t){this.init=function(t,e){e.vset(2),e.get_target(98),e.lifecount=0,e.cancelcol=!1,e.display_size=1.5},this.move=function(t,e){switch(e.frame){case 10:e.target_rotate_r(15),e.vset(4);break;case 15:e.frame=9;break;default:break}return e.frame++,e.lifecount++,e.cancelcol&&(this.mapCollision=!1),e.sc_move()}}function sce_en_bullet_random(){this.init=function(t,e){let i=Math.floor(50*Math.random())-25;e.vector=(e.vector+i+360)%360,e.vset(4)},this.move=function(t,e){return e.sc_move()}}function sce_en_bullet_accel(){this.init=function(t,e){e.vset(4)},this.move=function(t,e){switch(e.frame){case 15:e.vx/=2,e.vy/=2;break;case 23:e.vx/=2,e.vy/=2;break;case 30:e.vx/=2,e.vy/=2;break;case 90:e.vset(6);break;default:break}return e.frame++,e.sc_move()}}function sce_en_bullet_hominglaser(){this.init=function(t,e){e.vset(3),e.get_target(98),e.display_size=2,e.w_cnt=15},this.move=function(t,e){switch(e.w_cnt){case 25:break;case 26:e.frame<180&&e.target_rotate_r(15+(e.frame<20?15:0)),e.vset(3+(e.frame>40?1:0)+(e.frame>50?1:0));break;case 30:e.w_cnt=22;break;default:break}return 0==e.frame&&e.set_object_ex(32,e.x,e.y,e.vector,56),e.w_cnt++,e.frame++,e.sc_move()}}function sce_en_bullet_infolaser(){this.init=function(t,e){e.vset(0),e.msf=!1,e.display_size=2,e.alpha=0},this.move=function(t,e){switch(e.frame){case 0:e.normal_draw_enable=!1,e.custom_draw_enable=!0;case 44:e.set_object_ex(32,e.x+e.vx,e.y+e.vy,e.vector,56);break;case 45:e.normal_draw_enable=!0,e.custom_draw_enable=!1,e.vset(10);break;default:break}return e.msf,e.frame++,e.sc_move()},this.draw=function(t,e){let i={},o=e.gt.worldtoView(e.x,e.y);i.x=o.x,i.y=o.y,e.vset(800),i.tx=o.x+e.vx,i.ty=o.y+e.vy,e.vset(0),i.alpha=e.frame/30,i.alpha=i.alpha>1?1:i.alpha,i.draw=function(t){t.beginPath(),t.moveTo(this.x,this.y),t.lineTo(this.tx,this.ty),t.lineWidth="2",t.strokeStyle="rgba( 255, 192, 128,"+i.alpha+")",t.stroke()},t.putFunc(i)}}function sce_en_bullet_turn(){this.init=function(t,e){e.vset(0),e.get_target(98)},this.move=function(t,e){return 60==e.frame&&(e.vector=e.target_v(),e.vset(8)),e.frame++,e.sc_move()}}function sce_en_bullet_laser_tail(){this.init=function(t,e){e.vset(0),e.display_size=1.5,e.old_x=e.x,e.old_y=e.y,e.op={ptr:0,x:Array(5),y:Array(5),r:Array(5)};let i=e.op;i.ptr=0,i.x.fill(e.x),i.y.fill(e.y),i.r.fill(0),e.cf=!1},this.move=function(t,e){Boolean(e.parent)||(e.status=0),0==e.parent.status&&(e.status=0),e.frame>150&&(e.status=0),e.alive>2500&&(e.status=0),e.frame+=e.vecfrm;let i=e.parent,o=e.op;return o.x[o.ptr]=i.x,o.y[o.ptr]=i.y,e.vector=i.vector,o.ptr++,o.ptr=o.ptr%o.x.length,e.old_x=e.x,e.old_y=e.y,e.x=o.x[o.ptr],e.y=o.y[o.ptr],e.frame>1&&!e.cf&&(e.set_object_ex(32,e.x+e.vx,e.y+e.vy,e.vector,56),e.cf=!0),0==e.status&&e.alive>1800&&e.set_object(3),f=0,0==e.status&&(f=1),e.sc_move()}}function sce_exev_3way(){this.init=function(t,e){e.vset(0),this.normal_draw_enable=!1,e.set_object_ex(5,e.x,e.y,e.vector-5,12),e.set_object_ex(5,e.x,e.y,e.vector,12),e.set_object_ex(5,e.x,e.y,e.vector+5,12)},this.move=function(t,e){return e.status=0,e.sc_move()}}function sce_exev_5way_nallow(){this.init=function(t,e){e.vset(0),this.normal_draw_enable=!1,e.set_object_ex(5,e.x,e.y,e.vector-10,12),e.set_object_ex(5,e.x,e.y,e.vector-5,12),e.set_object_ex(5,e.x,e.y,e.vector,12),e.set_object_ex(5,e.x,e.y,e.vector+5,12),e.set_object_ex(5,e.x,e.y,e.vector+10,12)},this.move=function(t,e){return e.status=0,e.sc_move()}}function sce_exev_5way_normal(){this.init=function(t,e){e.vset(0),this.normal_draw_enable=!1,e.set_object_ex(5,e.x,e.y,e.vector-30,12),e.set_object_ex(5,e.x,e.y,e.vector-15,12),e.set_object_ex(5,e.x,e.y,e.vector,12),e.set_object_ex(5,e.x,e.y,e.vector+15,12),e.set_object_ex(5,e.x,e.y,e.vector+30,12)},this.move=function(t,e){return e.status=0,e.sc_move()}}function sce_exev_5expansion(){this.init=function(t,e){e.vset(0),this.normal_draw_enable=!1,e.set_object_ex(3,e.x,e.y,e.vector,"common_vset2"),e.set_object_ex(3,e.x,e.y,e.vector,"common_vset4"),e.set_object_ex(3,e.x,e.y,e.vector,"common_vset6"),e.set_object_ex(3,e.x,e.y,e.vector,"common_vset8"),e.set_object_ex(3,e.x,e.y,e.vector,"common_vset10")},this.move=function(t,e){return e.status=0,e.sc_move()}}function sce_exev_3way_exp(){this.init=function(t,e){e.vset(0),this.normal_draw_enable=!1,e.set_object_ex(5,e.x,e.y,e.vector-5,"exev_5expansion"),e.set_object_ex(5,e.x,e.y,e.vector,"exev_5expansion"),e.set_object_ex(5,e.x,e.y,e.vector+5,"exev_5expansion")},this.move=function(t,e){return e.status=0,e.sc_move()}}function sce_friend_start(){this.init=function(t,e){e.vset(0)},this.move=function(t,e){switch(e.config.option||(e.status=0),e.hp=10,e.frame){case 30:e.vector=180,e.get_target(98);break;case 58:case 59:e.vector=e.target_v();case 60:e.vset(0),e.change_sce(21);break;default:break}return e.frame++,e.sc_move()}}function sce_friend_sidearm(){this.init=function(t,e){e.vset(0),e.triger=15,e.m_trig=0,e.frame=60},this.move=function(scrn,o){o.config.option||(o.status=0);let wr=o.vector;o.triger--,o.triger<=0&&(o.shot=0,o.triger=0);let powup=0;for(let t in o.item)7==t&&(powup=o.item[t]);o.mp=powup<10?15:24,0==eval(o.mouse_state.button)&&(0==o.shot&&(o.shot=1,(powup>=3&&powup<=4||powup>=8)&&o.set_object_ex(6,o.x,o.y,o.vector>180?o.vector+87:o.vector-87,13),o.m_trig=1-o.m_trig,powup>=5&&0==o.m_trig&&o.set_object(13),o.frame>45&&powup>=10&&(o.set_object(23),o.frame=0),o.triger=15,powup>=7&&(o.triger=5)),wr=o.vector);let f=0;return 98!=o.target.type&&o.change_sce(7),0==this.status&&(f=1),o.x=o.target.x+32*Math.cos((wr-90)*(Math.PI/180)),o.y=o.target.y+32*Math.sin((wr-90)*(Math.PI/180)),o.frame++,f}}function sce_friend_straight(){this.init=function(t,e){let i;e.vset(0),e.startflag=!0,i=98==e.parent.type?e.parent.turlet.vector():e.parent.vector,e.vector=i,e.x+=50*e.Cos(e.vector),e.y+=50*e.Sin(e.vector),e.shotcount=0},this.move=function(t,e){let i,o=0;if(!Boolean(e.parent))return e.change_sce(7),1;e.damageflag&&(e.damageflag=!1),e.shotcount+=e.vecfrm,i=98==e.parent.type?e.parent.turlet.vector():e.parent.vector,e.shotcount>10?(e.vector=(i+315)%360,e.shotcount=0,e.status=0):e.vector=i;let n=Math.abs(e.shotcount-5);return e.x=e.parent.x+e.Cos(e.vector)*(50-n)-e.Cos(e.vector)*n*10*e.parent.spec.LV,e.y=e.parent.y+e.parent.shifty+e.Sin(e.vector)*(50-n)-e.Sin(e.vector)*n*10*e.parent.spec.LV,0==e.status&&(o=1),o}}function sce_friend_boom(){this.init=function(t,e){e.vset(6),e.get_target(e.parent.type),e.startflag=!0,e.x+=35*e.Cos(e.vector),e.y+=26*e.Sin(e.vector),e.shotcount=0,e.bup_vector=e.vector},this.move=function(t,e){e.vector=e.bup_vector;let i=0;return Boolean(e.parent)?(e.damageflag&&(e.damageflag=!1),e.shotcount+=e.vecfrm,e.shotcount>20&&e.shotcount<120&&e.target_rotate_r(8),e.vset(6),e.bup_vector=e.vector,(e.target_d(e.parent.x,e.parent.y)<18||e.shotcount>300)&&(e.parent.triger=5,e.parent.autotrig=5,e.status=0),e.vector=5*e.shotcount%360,e.x+=e.vx*e.vecfrm,e.y+=e.vy*e.vecfrm,0==e.status&&(i=1),e.shotcount>180?e.sc_move():i):(e.change_sce(7),1)}}function sce_friend_rotate_full(){this.init=function(t,e){e.vset(0),e.x+=40*e.Cos(e.vector)*(1+.3*e.parent.spec.LV),e.y+=20*e.Sin(e.vector)*(1+.3*e.parent.spec.LV),e.rotatecount=0,e.startv=e.vector,e.leftrotate=e.vector>179},this.move=function(t,e){let i=0;return Boolean(e.parent)?(e.damageflag&&(e.damageflag=!1),e.rotatecount+=e.vecfrm,e.rotatecount>20&&(e.rotatecount=0,e.status=0),e.leftrotate?e.vector=(e.startv+(360-18*e.rotatecount))%360:e.vector=(e.startv+18*e.rotatecount)%360,e.x=e.parent.x+40*e.Cos(e.vector)*(1+.3*e.parent.spec.LV),e.y=e.parent.y+e.parent.shifty+20*e.Sin(e.vector)*(1+.3*e.parent.spec.LV),0==e.status&&(i=1),i):(e.change_sce(7),1)}}function sce_friend_rotate(){this.init=function(t,e){e.vset(0),e.leftrotate=e.vector>179,e.leftrotate?e.startv=(e.vector+60)%360:e.startv=(e.vector-60+360)%360,e.x+=35*e.Cos(e.vector)*(1+.3*e.parent.spec.LV),e.y+=26*e.Sin(e.vector)*(1+.3*e.parent.spec.LV),e.rotatecount=0},this.move=function(t,e){let i=0;return Boolean(e.parent)?(e.damageflag&&(e.damageflag=!1),e.rotatecount+=e.vecfrm,e.rotatecount>10&&(e.rotatecount=0,e.status=0),e.leftrotate?e.vector=e.startv-12*e.rotatecount:e.vector=(e.startv+12*e.rotatecount)%360,e.x=e.parent.x+35*e.Cos(e.vector)*(1+.3*e.parent.spec.LV),e.y=e.parent.y+e.parent.shifty+26*e.Sin(e.vector)*(1+.3*e.parent.spec.LV),0==e.status&&(i=1),i):(e.change_sce(7),1)}}function sce_friend_front(){this.init=function(t,e){e.vset(0),e.startflag=!0,98==e.parent.type?e.vector=e.parent.turlet.vector():e.vector=e.parent.vector,e.x+=35*e.Cos(e.vector),e.y+=35*e.Sin(e.vector),e.shotcount=0},this.move=function(t,e){let i=0;return Boolean(e.parent)?(e.damageflag&&(e.damageflag=!1),e.shotcount+=e.vecfrm,e.shotcount>20&&(e.shotcount=0,e.status=0),98==e.parent.type?e.vector=e.parent.turlet.vector():e.vector=e.parent.vector,e.x=e.parent.x+e.Cos(e.vector)*(35-e.shotcount/2),e.y=e.parent.y+e.parent.shifty+e.Sin(e.vector)*(35-e.shotcount/2),0==e.status&&(i=1),i):(e.change_sce(6),1)}}function sce_friend_option(t){let e={ptr:0,x:Array(10),y:Array(10),r:Array(10)};const i={0:{ch:6,sce:"common_vset8"},1:{ch:10,sce:"friend_rotate"},2:{ch:38,sce:"friend_rotate_full"},3:{ch:37,sce:"friend_boom"},4:{ch:36,sce:"friend_straight"},5:{ch:46,sce:"common_vset10"}};this.init=function(t,i){i.type=5,i.frame=0,i.autotrig=10,i.autoshot=0,i.normal_draw_enable=!1,i.custom_draw_enable=!0,i.old_x=i.x,i.old_y=i.y,i.repro=!1,i.spec={LV:0},e.ptr=0,e.x.fill(i.x),e.y.fill(i.y),e.r.fill(0)},this.draw=function(t,i){for(let o=0;o<e.x.length;o++){let e=i.gt.worldtoView(i.x,i.y);t.putFunc({x:e.x,y:e.y,r:6-i.frame%6/2,draw:function(t){t.beginPath(),t.arc(this.x,this.y,this.r,0,2*Math.PI,!1),t.fillStyle="white",t.fill()}})}},this.move=function(o,n){Boolean(n.parent)||(n.status=0),0==n.parent.status&&(n.status=0),n.frame+=n.vecfrm;let s=n.parent;if(n.autotrig-=n.vecfrm,n.autotrig<=0&&(n.autoshot=0,n.autotrig=5),0==n.autoshot&&0!=n.gameState.player.weapon){n.autoshot=1;let t=4*(n.gameState.player.level>3?3:n.gameState.player.level);n.autotrig=20-t,3==n.gameState.player.weapon&&(n.autotrig=240/(n.gameState.player.level+1)),n.set_object_ex(i[n.gameState.player.weapon].ch,n.x,n.y,n.vector,i[n.gameState.player.weapon].sce)}return n.item[20]>=10*(t+2)&&!n.repro&&t<3&&(n.set_object_ex(0,n.x,n.y,n.vector,"sce_friend_option_"+(t+1)),n.repro=!0),n.item[20]<10*(t+1)?(n.parent.repro=!1,1):(s.x==s.old_x&&s.y==s.old_y||(e.x[e.ptr]=s.x,e.y[e.ptr]=s.y+s.shifty,98==n.parent.type?v=n.parent.turlet.vector():v=n.parent.vector,e.r[e.ptr]=v,e.ptr++,e.ptr=e.ptr%e.x.length),n.old_x=n.x,n.old_y=n.y,n.x=e.x[e.ptr],n.y=e.y[e.ptr],n.vector=e.r[e.ptr],f=0,0==n.status&&(f=1),f)}}function GameAssetSetup(t){ImageAssetSetup(t),SoundAssetSetup(t),SpfontSetup(t)}function SpfontSetup(t){return t.setSpFont({name:"stfont",id:"FontGraph",pattern:e(0,0,12,16)}),t.setSpFont({name:"8x8white",id:"FontGraph",pattern:e(0,128,8,8)}),t.setSpFont({name:"8x8red",id:"FontGraph",pattern:e(128,128,8,8)}),t.setSpFont({name:"8x8green",id:"FontGraph",pattern:e(0,192,8,8)}),t.setSpFont({name:"8x8blue",id:"FontGraph",pattern:e(128,192,8,8)}),void t.setSpFont({name:"6x8",id:"KanjiHw",pattern:e(0,16,6,8)});function e(t,e,o,n){let s=[];for(i=0;i<7;i++)for(j=0;j<16;j++)ptn={x:o*j+t,y:n*i+e,w:o,h:n},s.push(ptn);return s}}function gameScene(t){let e=t.System.dev,o=e.graphics[1],s=e.graphics[0],a=e.graphics[3],r=e.graphics[2];s.backgroundcolor="black",this.init=function(){u.init(),t.Result.load(),t.Result.score=0,t.Game.item=m.item,t.Result.combo=m.combo},this.reset=function(i){e.graphics[0].setInterval(1),e.graphics[1].setInterval(1),e.graphics[2].setInterval(1),e.graphics[3].setInterval(0),a.clear(),x=!1,k=!0,Boolean(i)||(i=!1);t.Game.cold&&(m.reset(!1),u.init(),i?(f=2-t.Game.player.zanki,m.item=t.Game.item,m.itemstack=t.Game.itemstack):(f=0,t.Game.nowstage=t.Config.startstage,t.Game.reset()),t.Game.player.barrier=!1,u.change(t.Game.nowstage),u.reset(t.System.time()),e.sound.change(0),e.sound.play());if(ec_draw_count=0,i&&!t.Game.cold){let i=u.stage;i++,i>30&&(i=1),u.change(i),u.stage=i,t.Game.nowstage=i;let o=m.score;m.reset(!1),m.score=o,u.reset(t.System.time()),e.sound.change(1),e.sound.play()}_=e.game.asset.image[u.bgImage()].img,p=u.mapChip(),y=u.bgPtn(),I.mcp=p,l=new A(m.score),ehighscore=new A(t.Result.highscore),g=!0,d=!!t.Config.lamp_use,v=!t.Config.map_use,mapv=!1,m.messageconsole.write("==STAGE START=="),t.Game.cold&&i&&m.tutTable(9);t.Game.nowstage%5==0&&m.tutTable(6);t.Game.nowstage%15==6&&m.tutTable(13);t.Game.nowstage%15==11&&m.tutTable(14)},this.step=function(i,o){e.gs.commit(),this.reset_enable||(this.reset_enable=!0,u.pauseOff(t.System.time()),M=!0);if(t.Game.lamp=d,t.Game.map=!v,!e.sound.running()){let t=1;m.rollcall("boss")&&(t=16),m.rollcall("timeover")&&(t=3),e.sound.change(t),m.rollcall("mayura")&&e.sound.play()}g&&m.rollcall("warning")&&(m.tutTable(3),e.sound.change(2),m.rollcall("mayura")&&e.sound.play(),g=!1);if(m.interrapt){if(1==m.SIGNAL)return u.enable=!1,u.counter_runnning=!1,e.sound.volume(0),t.Game.item=m.item,t.Game.itemstack=m.itemstack,t.Game.player.zanki=2-f,m.interrapt=!1,m.SIGNAL=0,this.reset_enable=!1,u.pauseOn(t.System.time()),6;if(835==m.SIGNAL)return m.score+=Math.floor((12e4-u.flame)/100),t.Result.score=m.score,t.Game.item=m.item,t.Game.itemstack=m.itemstack,t.Game.player.zanki=2-f,t.Result.combo=m.combo,t.Result.combomax=m.combomax,t.Result.obCount=m.obCount,t.Result.total=m.total,t.Result.hidan=m.hidan,t.Game.cold=!1,m.interrapt=!1,m.SIGNAL=0,m.draw(s),e.sound.change(4),e.sound.play(),5;if(1709==m.SIGNAL)return u.enable=!0,u.counter_runnning=!1,t.Game.item=m.item,t.Game.itemstack=m.itemstack,t.Game.player.zanki=2-f,m.interrapt=!1,m.SIGNAL=0,this.reset_enable=!1,u.pauseOn(t.System.time()),9;if(4649==m.SIGNAL){if(f++,!(f<3))return t.Result.score=m.score,t.Game.item=m.item,t.Game.itemstack=m.itemstack,t.Game.player.zanki=2-f,t.Result.combo=m.combo,t.Result.combomax=m.combomax,t.Result.obCount=m.obCount,t.Result.total=m.total,t.Result.hidan=m.hidan,m.draw(s),Boolean(localStorage)&&localStorage.setItem("highscore",new String(t.Result.highscore)),e.sound.change(6),e.sound.play(),3;t.Config.itemreset&&(m.item=[],m.itemstack=[]),m.combo=[],t.Game.player.hp=t.Game.player.maxhp,m.restart(),u.counterReset(t.System.time()),e.sound.change(0),e.sound.play(),g=!0}}else{u.enable=!0,u.counter_runnning=!0;for(let t in m.item)if(21==t&&m.item[21]>0&&(m.item[21]=0,f--,e.sound.effect(11)),26==t&&m.item[26]>0&&(m.item[26]=0,d=!0),27==t&&m.item[27]>0){m.item[27]=0,v=!1;for(let t in p);}}m.move(u,o),u.step(m,t.System.time()),t.Result.highscore<m.score&&(t.Result.highscore=m.score);return 0},this.draw=function(){(function(){for(let i in p){let o=p[i];if(e.gs.in_stage_range(o.x,o.y,o.w,o.h)){o.view=!0;let n=e.gs.worldtoView(o.x,o.y);if(o.visible){o.lookf!=x&&(k=!0),o.lookf=x;let t=!1;o.type%2==1&&(t=!0);let a=!0;if(m.ceilflag&&13==o.type&&m.ceilindex==i&&(a=!1),Boolean(y[o.no])){if(a)if(t){let t=0,i=-24;t=Math.trunc((n.x-n.sx-e.gs.viewwidth/2)/24),i=Math.trunc((n.y-n.sy-e.gs.viewheight/2)/24),1==o.no?r.fill(n.x+t,n.y+i,o.w,o.h,m.ceilshadow):r.putPattern(_,y[o.no],n.x+t,n.y+i,o.w,o.h)}else s.putPattern(_,y[o.no],n.x,n.y,o.w,o.h)}else{let t={};t.x=n.x,t.y=n.y,t.w=o.w,t.h=o.h,t.draw=function(t){t.beginPath(),t.strokeStyle="green",t.lineWidth=1,t.rect(this.x,this.y,this.w,this.h),t.stroke()},s.putFunc(t)}}if(t.Config.debug&&o.c){let t={};t.x=n.x,t.y=n.y,t.w=o.w,t.h=o.h,t.draw=function(t){t.beginPath(),t.strokeStyle="green",t.lineWidth=3,t.rect(this.x,this.y,this.w,this.h),t.stroke()},s.putFunc(t),r.putFunc(t)}}else o.view=!1}})(),function(){for(let t in p){let i=p[t];if(e.gs.in_stage_range(i.x,i.y,i.w,i.h)){i.view=!0;let o=e.gs.worldtoView(i.x,i.y);if(i.visible){let n=.6;if(m.ceilflag&&13==i.type&&m.ceilindex==t&&(n=.15),i.type%2==1){let t=0,a=-24;t=Math.trunc((o.x-o.sx-e.gs.viewwidth/2)/24)+4,a=Math.trunc((o.y-o.sy-e.gs.viewheight/2)/24)+4;let r={};r.x=o.x-t,r.y=o.y-a,r.w=i.w-1,r.h=i.h-1,r.fs="rgba(0,0,0,"+n+")",r.draw=function(t){t.beginPath(),t.fillStyle=this.fs,t.fillRect(this.x,this.y,this.w,this.h)},s.putFunc(r)}}}}}(),m.drawShadow(s),m.draw(o),m.draw(r,!0);let c=!1;b++,b%6==0&&(b=0,c=!0);if(c=!0,c){let o;if(v&&!d||m.drawPoint(e.graphics[4],d),P.draw(),function(i){let o=[ehighscore.read(t.Result.highscore),l.read(m.score)],s=[f,v,d,m.item[20],m.item[22],m.item[35],m.itemstack.length,t.Game.player.weapon,t.Game.player.level,u.stage,t.Game.player.hp,t.Game.player.maxhp,t.Game.player.barrier,k],r=Math.floor((12e4-u.flame)/1e3),c=!0;for(let t in G.state)G.state[t]!==s[t]&&(c=!1);let h=!0;for(let t in G.score)G.score[t]!==o[t]&&(h=!1);let _=!0;G.time!==r&&(_=!1);G.state=s,G.score=o,G.time=r,G.cnt++,i&&(c=!1,h=!1,_=!1);if(c&&h&&_)return;c?(h||a.fill(e.layout.hiscore_x,e.layout.hiscore_y,156,32),_||a.fill(e.layout.time_x,e.layout.time_y,120,16)):(a.reset(),a.clear());if(!h||!c){let i=100*Math.pow(t.Game.player.spec.ETC+1,2),o="       "+(m.score>=i?"#":" ")+"Next."+i;a.putchr("Exp."+G.score[1],e.layout.hiscore_x,e.layout.hiscore_y),o=o.substring(o.length-11),a.putchr(o,e.layout.score_x,e.layout.score_y),c&&m.messageview.write("** SCORE Draw ** f:"+G.cnt)}_&&c||(a.putchr("Time:"+G.time,e.layout.time_x,e.layout.time_y),c&&m.messageview.write("** Time Draw ** f:"+G.cnt));if(c)return;m.messageview.write("** UI Draw ** f:"+G.cnt),G.cnt=0,(!v||d)&&(a.putFunc(C),v||(k&&(I.create(),m.messageview.write("** Submap Create **"),k=!1),a.putFunc(I)));1!=t.Game.mode?function(){a.putFunc(B);let i=2-f;if(i<3)for(let t=0;t<2-f;t++)a.put("Mayura1",e.layout.zanki_x+32*t,e.layout.zanki_y);else a.put("Mayura1",e.layout.zanki_x,e.layout.zanki_y),a.putchr8("x"+i,e.layout.zanki_x+16,e.layout.zanki_y);v||a.put("Map",e.layout.map_x+36,e.layout.map_y+12);d&&a.put("Lamp",e.layout.map_x+12,e.layout.map_y+12);if(Boolean(m.item[20])){let t=m.item[20];if(t<=3)for(let i=0;i<t;i++)a.put("Ball1",e.layout.zanki_x+20*i+288,e.layout.zanki_y-8);else a.put("Ball1",e.layout.zanki_x+288,e.layout.zanki_y-8),a.putchr8("x"+t,e.layout.zanki_x+288+10,e.layout.zanki_y-12)}if(Boolean(m.item[35])){let t=m.item[35];if(t<=6)for(let i=0;i<t;i++)a.put("Coin1",e.layout.zanki_x+8*i+288,e.layout.zanki_y+8);else a.put("Coin1",e.layout.zanki_x+288,e.layout.zanki_y+8),a.putchr8("x"+t,e.layout.zanki_x+288+10,e.layout.zanki_y+8)}if(Boolean(m.itemstack)){let t={20:"Ball1",23:"BallB1",24:"BallS1",25:"BallL1"},i=[];for(let t in m.itemstack){let e=m.itemstack[t];i.push(e)}a.putchr8("[X]",e.layout.zanki_x+132-16,e.layout.zanki_y-16),n=i.length,n>=8&&(n=6,a.putchr8("...",e.layout.zanki_x+20*n+128,e.layout.zanki_y+8));for(let o=0;o<n;o++)0==o?a.put(t[i[i.length-1-o]],e.layout.zanki_x+20*o+132,e.layout.zanki_y):a.put(t[i[i.length-1-o]],e.layout.zanki_x+20*o+136,e.layout.zanki_y+8)}n=0,Boolean(m.item[22])&&(n=m.item[22]);n>0&&a.put("Key",e.layout.zanki_x+64,e.layout.zanki_y);let o=["Wand","Knife","Axe","Boom","Spear","Bow"];Boolean(t.Game.player.weapon)||(t.Game.player.weapon=0);Boolean(t.Game.player.level)||(t.Game.player.level=0);if(a.putchr8("[Z]",e.layout.zanki_x+96-16,e.layout.zanki_y-16),a.put(o[t.Game.player.weapon],e.layout.zanki_x+96,e.layout.zanki_y),t.Game.player.level>0){let i="+"+t.Game.player.level+(t.Game.player.level>2?" Max":"");a.putchr8(i,e.layout.zanki_x+96-16,e.layout.zanki_y+8)}a.putchr("Stage "+u.stage,e.layout.stage_x,e.layout.stage_y);let s=t.Game.player.hp>0?t.Game.player.hp:0;j.hp=s,j.mhp=t.Game.player.maxhp,j.br=t.Game.player.barrier,j.shw=t.Game.player.shieldtime,j.bbw=s,a.putFunc(j);let r="HP:"+s+"/"+t.Game.player.maxhp;t.Game.player.barrier;a.putchr8(r,e.layout.hp_x+8,e.layout.hp_y+4),T.setStatusArray([t.Game.player.base.VIT,t.Game.player.base.INT,t.Game.player.base.MND]),T.draw(a,e.layout.zanki_x+252,e.layout.zanki_y-16)}():function(){let i=2-f;if(i<3)for(let t=0;t<2-f;t++)a.put("Unyuu3",e.layout.zanki_x+32*t,e.layout.zanki_y);else a.put("Unyuu3",e.layout.zanki_x,e.layout.zanki_y),a.kprint("x"+i,e.layout.zanki_x+16,e.layout.zanki_y);v||a.put("Map",e.layout.map_x+36,e.layout.map_y+12);d&&a.put("Lamp",e.layout.map_x+12,e.layout.map_y+12);if(Boolean(m.item[20])){let t=m.item[20];a.kprint("①:"+t,e.layout.zanki_x+256,e.layout.zanki_y-12)}if(Boolean(m.itemstack)){let t={20:"①",23:"②",24:"③",25:"④"},i=[];for(let t in m.itemstack){let e=m.itemstack[t];i.push(e)}w="";for(let e=0;e<i.length;e++)w+=t[i[e]];a.kprint(w+"<-",e.layout.zanki_x+136,e.layout.zanki_y)}n=0,Boolean(m.item[22])&&(n=m.item[22]);n>0&&a.put("sKey",e.layout.zanki_x+64,e.layout.zanki_y);let o=["Wand","Knife","Axe","Boom","Spear","Bow"];Boolean(t.Game.player.weapon)||(t.Game.player.weapon=0);Boolean(t.Game.player.level)||(t.Game.player.level=0);if(a.kprint("武器",e.layout.zanki_x+96-16,e.layout.zanki_y-16),a.put(o[t.Game.player.weapon],e.layout.zanki_x+96,e.layout.zanki_y),t.Game.player.level>0){let i="+"+t.Game.player.level+(t.Game.player.level>2?" Max":"");a.kprint(i,e.layout.zanki_x+96-16,e.layout.zanki_y+8)}a.kprint("Stage "+u.stage,e.layout.stage_x,e.layout.stage_y+40);let s=t.Game.player.hp>0?t.Game.player.hp:0;j.hp=s,j.mhp=t.Game.player.maxhp,j.br=t.Game.player.barrier,a.putFunc(j);let r="HP:"+s+"/"+t.Game.player.maxhp;t.Game.player.barrier&&(r="HP:"+s+"/SHIELD");a.kprint(r,e.layout.hp_x+8,e.layout.hp_y+4)}()}(M),t.Config.debug){o=function(){let o=[];o.push("o:"+m.cnt()+"/"+m.num()+"/"+m.nonmove+"/"+m.collisioncount),o.push("f:"+u.flame+"/ "+e.gs.changestate),m.interrapt?o.push("interrapt:"+m.SIGNAL):o.push("running:"+m.SIGNAL);for(i in m.item)Boolean(m.item[i])&&o.push("item["+i+"]:"+m.item[i]);let n=0;for(i in m.total)2==i&&(n=m.total[i]);let s=1;for(i in m.obCount)2==i&&(s=m.obCount[i]);t.Game.player.spec;return o.push("wx,wy:"+Math.floor(e.gs.world_x)+","+Math.floor(e.gs.world_y)),o.push("play:"+Math.floor(e.sound.info())+"."+e.sound.running()),o.push("Living:"+m.rollcall("mayura")),o}(),t.Config.viewlog&&(o=o.concat(m.messagelog.read()));for(let t in o)e.graphics[2].putchr8(o[t],e.layout.status_x,e.layout.status_y+8*t);if(o=m.messageview.read(),t.Config.viewlog)for(let t in o)e.graphics[2].kprint(o[t],e.layout.map_x,e.layout.map_y+150+8*t)}else if(o=m.messageconsole.read(),t.Config.viewlog)for(let t in o)e.graphics[2].kprint(o[t],e.layout.map_x,e.layout.map_y+150+10*t);if(m.tutorialDisplayTime>t.System.time()){o=m.tutorialconsole.read();for(let t in o)e.graphics[2].kprint(o[t],e.layout.zanki_x,e.layout.zanki_y-80+10*t)}}v||(mapv=!0);M&&(M=!1);x=!0},this.reset_enable=!0,this.score=0;let l,c,h,m=t.obCtrl,u=t.mapsc,f=0,_=[],p=[],y=[],g=!1,v=!1,d=!1,b=0,x=!1,k=!0,S=!1,M=!1;"undefined"!=typeof OffscreenCanvas&&(c=new OffscreenCanvas(150,150),h=c.getContext("2d"),S=!0);let C={draw:function(t){t.beginPath(),t.fillStyle="rgba(0,0,0,0.3)",t.fillRect(e.layout.map_x,e.layout.map_y,150,150)}},B={draw:function(t){t.beginPath(),t.fillStyle="rgba(0,0,0,0.5)",t.fillRect(e.layout.clip_x,e.layout.clip_y,360,36)}},j={hp:0,mhp:0,br:!0,shw:0,bbw:0,exp:0,draw:function(t){let i=this.hp/this.mhp>.5?"limegreen":"yellowgreen",o=this.hp/this.mhp>.5?"white":this.hp/this.mhp>.3?"yellow":"orange";if(t.beginPath(),t.fillStyle="black",t.fillRect(e.layout.hp_x,e.layout.hp_y,102,15),t.fillStyle="red",t.fillRect(e.layout.hp_x+1,e.layout.hp_y+1,this.bbw,13),t.fillStyle=i,t.fillRect(e.layout.hp_x+1,e.layout.hp_y+1,this.hp/this.mhp*100,13),this.br){t.fillStyle="cyan",t.fillRect(e.layout.hp_x+1,e.layout.hp_y+3,this.shw,11);let i=this.shw%10*5+205;t.fillStyle="rgb(0,"+i+","+i+")",t.fillRect(e.layout.hp_x+1,e.layout.hp_y+4,this.shw-1,10)}t.strokeStyle=o,t.lineWidth=2,t.rect(e.layout.hp_x,e.layout.hp_y,102,15),t.stroke()}},I=new function(t,i){this.mcp=p;this.d=t,this.e=i,this.x=e.layout.map_x,this.y=e.layout.map_y,this.create=function(){this.d.clearRect(0,0,150,150);for(let t=0,e=this.mcp.length;t<e;t++){let e=this.mcp[t];if(e.visible){let t;t=e.lookf?["dimgray","steelblue","orange"]:["darkslategray","darkslategray","orange"],this.d.beginPath(),this.d.strokeStyle=t[e.type-10],this.d.lineWidth=1,this.d.rect(this.x+e.x/20,this.y+e.y/20,2,2),this.d.stroke()}}},this.draw=function(t){t.drawImage(this.e,this.x,this.y)}}(h,c);let T=new function(t){let e;this.setStatusArray=function(t){e=t},this.draw=function(i,o,n){let s={s:e,b:t,x:o,y:n,draw:function(t){t.beginPath();for(let e in this.s){t.fillStyle=this.b[e];for(let i=0;i<this.s[e];i++)i<7&&t.fillRect(this.x+4*i,this.y+5*e,3,4)}}};i.putFunc(s)}}(["cyan","orange","limegreen","white"]);v=!0;let G={cnt:0,state:[],score:[],time:0},P=new function(){let i=0,o=e.graphics[4];this.draw=function(){let n=t.Game.player.hp>0?t.Game.player.hp:0,s=Math.trunc(n/t.Game.player.maxhp*100);j.hp=n,j.mhp=t.Game.player.maxhp,j.br=t.Game.player.barrier,j.shw=t.Game.player.shieldtime,j.bbw=i,o.putFunc(j);let a="HP:"+n+"/"+t.Game.player.maxhp;t.Game.player.barrier,o.putchr8(a,e.layout.hp_x+8,e.layout.hp_y+4),i>s&&(i-=1),i<=s&&(i=s)}};function A(t){let e=t;this.read=function(t){if(t<=e)e=t;else{let i=Math.ceil((t-e)/5);e+=i}let o=e,n=[],s="";for(i=0;i<7;i++){let t=o%10;n[7-i]=t,o=(o-t)/10}for(i in n)s=s+""+n[i];return s}}}class GameTask_FPScount extends GameTask{constructor(t){super(t)}oldtime;newtime=Date.now();cnt=0;fps_log=[];log_cnt=0;log_max=0;interval;fps=0;step(t){this.oldtime=this.newtime,this.newtime=Date.now(),this.interval=this.newtime-this.oldtime,this.log_cnt>this.log_max&&(this.log_max=this.log_cnt),this.fps_log[this.log_cnt]=this.interval,this.log_cnt++,this.log_cnt>59&&(this.log_cnt=0);let e=0;for(let t=0;t<=this.log_max;t++)e+=this.fps_log[t];this.cnt++,this.fps=parseInt(1e3/(e/(this.log_max+1)))}draw(t){t.font["8x8white"].putchr("FPS:"+this.fps,320,0)}}class GameTask_Debug extends GameTask{constructor(t){super(t)}fontsc;init(t){t.font["6x8"].useScreen(3),this.fontsc=t.font["6x8"]}step(t){}draw(t){const e=t.screen.length;let i;t.fpsload.result();if(t.state.Config.debug){let o=[],n=t.fpsload.result();o.push("fps:"+Math.trunc(n.fps)),o.push("ave :load/intv/"),o.push("    :"+String(n.workload.ave).substring(0,4)+"/"+String(n.interval.ave).substring(0,4)+"ms"),o.push("workload :"+String(n.workload.ave/n.interval.ave*100).substring(0,5)+"%");let s=String(t.deltaTime()).substring(0,5);o.push("deltaTime:"+s+"ms"),s=String(t.time()).substring(0,10),o.push("run(ms):"+s),this.fontsc.useScreen(4);for(let t=0;t<o.length;t++)this.fontsc.putchr(o[t],320,320+8*t);o=[],o.push("sc(intv)bgcolor"),i="";for(let n=0;n<e;n++)i=" "+n+"("+t.screen[n].getInterval()+")"+t.screen[n].getBackgroundcolor()+"/"+t.screen[n].max()+"/"+t.screen[n].count(),o.push(i);for(let t=0;t<o.length;t++)this.fontsc.putchr(o[t],480,320+8*t)}}}class GameTask_Load extends GameTask{constructor(t){super(t)}scrn;fontsc;str;infoflg;infodly;init(t){this.scrn=t.screen[4],t.font["6x8"].useScreen(4),this.fontsc=t.font["6x8"],this.infoflg=!1,this.infodly=0}step(t){let e=t.keyboard.check(),i=t.mouse.check(),o=t.touchpad.check();void 0!==t.state.Config.debug&&(t.state.Config.debug=!0),t.state.Config.debug=this.infoflg;let n=!1;if((Boolean(e[32])||t.gamepad.btn_start||0==i.button)&&(e[32]||t.gamepad.btn_start||0==i.button)&&(n=!0),(Boolean(e[27])||t.gamepad.btn_back)&&(e[27]||t.gamepad.btn_back)&&(this.infoflg=!0,this.infodly=t.time()),o.pos.length>2&&(n=!0),n){let e=t.task.read("main");t.state.Config.debug=!1,e.visible=!0,e.enable=!0,this.visible=!1,this.visible=!1,t.task.del("load")}t.gamepad.check()?this.str=t.gamepad.infodraw():(this.str=[],this.str.push("[Gamepad]"),this.str.push("Not Ready."))}draw(t){const e=this.infodly;let i=t.asset.check();this.infoflg||(i=[],i.push("> Loading/Running Information."),i.push("> Input Device Status. [ESC]"),i.push(""),i.push("vvvvvvvvvvvvvvvvvvvvvv"),i.push("vvvv  GAME START  vvvv"),i.push("vvvvvvvvvvvvvvvvvvvvvv"));const o=t.asset.image.KanjiHw.ready?this.fontsc.putchr:this.scrn.print;let n=0+e/4,s=t.time()/4;for(let t in i){let e=n-s;if(e<0)o(i[t],0,8*t+8);else if(e<i[t].length){o(i[t].substring(0,i[t].length-e)+" _",0,8*t+8)}else o("_",0,8*t+8);n+=i[t].length}let a={x:0};a.y=8*i.length+16,a.w=256,a.h=8;let r=Math.floor(256*Math.cos(t.time()%3e3/3e3*6.28))+256;if(r=r>255?255:r,a.c="rgb( 0, 0,"+r+")",a.draw=function(t){t.beginPath(),t.fillStyle=this.c,t.fillRect(this.x,this.y,this.w,this.h)},this.scrn.putFunc(a),o("Push SPACE key or [START] button",0,8*i.length+16),this.infoflg){o(t.task.namelist(),0,this.scrn.ch-8);for(let t in this.str)o(this.str[t],320,8*t+8);let e=t.keyboard.state(),n=t.mouse.check_last(),s=t.touchpad.check();i="";for(let t in e)e[t]&&(i+="["+t+"]");o("[Keyboard]",320,8*this.str.length+16),i.length>0&&o("KeyCode:"+i,320,8*this.str.length+24),i="x:"+n.x+" y:"+n.y+" button:"+n.button+" wheel:"+n.wheel,o("[Mouse]",320,8*this.str.length+40),o("State:"+i,320,8*this.str.length+48);let a=0;o("[TouchPad]"+navigator.maxTouchPoints,320,8*this.str.length+64);for(let t in s.pos)o("State:["+t+"]"+s.pos[t].x+","+s.pos[t].y+","+s.pos[t].id,320,8*this.str.length+72+a),a+=8;o("[Fullscreen]"+(document.fullscreenEnabled?"Enable":"Disable"),320,this.scrn.ch-16),o(document.fullscreenElement?"Active":"NonActive",320,this.scrn.ch-8)}}}class GameTask_Device extends GameTask{constructor(t){super(t)}scrn;fontsc;toggleFullScreen=function(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()};keylock=0;init(t){this.scrn=t.screen[4],t.font["6x8"].useScreen(4),this.fontsc=t.font["6x8"]}step(t){let e=t.keyboard.state(),i=!1;Boolean(e[36])&&(i=!0);t.gamepad.check();let o=t.gamepad.btn_back;!(!i&&!o)&&(document.fullscreenElement||t.systemCanvas.requestFullscreen()),t.vgamepad.check(t.mouse,t.touchpad)}draw(t){t.vgamepad.draw(this.scrn),t.touchpad.draw(this.scrn),t.mouse.draw(this.scrn)}}function geometoryTrance(){this.worldwidth=2976,this.worldheight=2976,this.stagewidth=700,this.stageheight=460,this.viewwidth=640,this.viewheight=400,this.world_x=0,this.world_y=0;let t=this.worldwidth,e=this.worldheight,i=this.stagewidth,o=this.stageheight,n=this.viewwidth,s=this.viewheight,a=this.world_x,r=this.world_y;function l(t,e){return Math.abs(t.x+t.w/2-(e.x+e.w/2))<(t.w+e.w)/2&&Math.abs(t.y+t.h/2-(e.y+e.h/2))<(t.h+e.h)/2}function c(i,o){let n=!1,s=i.x,a=i.y;for(let r=0;r<=1;r++)for(let c=0;c<=1;c++)i.x=s+t*r,i.y=a+e*c,n=n||l(i,o);return n}this.changestate=!1,this.viewtoWorld=function(t,e){let i={};return i.x=this.world_x+t,i.y=this.world_y+e,i},this.worldtoView=function(i,o){let a={};return this.world_x>t-n?a.x=i<n?t-this.world_x+i:Math.trunc(i-this.world_x):a.x=Math.trunc(i-this.world_x),this.world_y>e-s?a.y=o<s?e-this.world_y+o:Math.trunc(o-this.world_y):a.y=Math.trunc(o-this.world_y),a.sx=0,a.sy=0,a.x+=a.sx,a.y+=a.sy,a},this.viewpos=function(i,o){i<0&&(i=t+i),o<0&&(o=e+o),i>t&&(i-=t),o>e&&(o-=e),a=Math.trunc(i),r=Math.trunc(o)},this.commit=function(){let t=!1;return this.world_x==a&&this.world_y==r||(this.world_x=a,this.world_y=r,t=!0),this.changestate=t,t},this.nowstagepos=function(){let t={};return t.ltx=this.world_x+n/2-i/2,t.lty=this.world_y+s/2-o/2,t.rtx=this.world_x+n/2+i/2,t.rty=this.world_y+s/2-o/2,t.lbx=this.world_x+n/2-i/2,t.lby=this.world_y+s/2+o/2,t.rbx=this.world_x+n/2+i/2,t.rby=this.world_y+s/2+o/2,t.x=t.ltx,t.y=t.lty,t.w=i,t.h=o,t},this.in_stage=function(t,e){let a={};a.x=t,a.y=e,a.w=1,a.h=1;let r={};return r.x=this.world_x+n/2-i/2,r.y=this.world_y+s/2-o/2,r.w=i,r.h=o,c(a,r)},this.in_view=function(t,e){let i={};i.x=t,i.y=e,i.w=1,i.h=1;let s={};return s.x=this.world_x,s.y=this.world_y,s.w=n,s.h=o,c(i,s)},this.in_view_range=function(t,e,i,o){let a={};a.x=t,a.y=e,a.w=i,a.h=o;let r={};return r.x=this.world_x,r.y=this.world_y,r.w=n,r.h=s,c(a,r)},this.in_stage_range=function(t,e,n,s){let a={};a.x=t,a.y=e,a.w=n,a.h=s;let r={};return r.x=this.world_x,r.y=this.world_y,r.w=i,r.h=o,c(a,r)},this.in_world=function(i,o){return!(i<0||i>t||o<0||o>e)},this.worldtoWorld_x=function(e){return e<0&&(e=t+e),e>t&&(e-=t),e},this.worldtoWorld_y=function(t){return t<0&&(t=e+t),t>e&&(t-=e),t}}function gObjectClass(t){this.objCtrl=t,this.x,this.y,this.vx,this.vy,this.mp,this.vector,this.visible=!1,this.center_x,this.center_y,this.hit_x,this.hit_y,this.mp_cnt_frm=0,this.mp_cnt_anm=0,this.type,this.chr,this.frame=0,this.scenario=[],this.status=0,this.hp,this.target=-1,this.crash=-1,this.id,this.name,this.score=0,this.triger=0,this.shot=0,this.alpha=255,this.display_size=1,this.weight=1,this.message=[],this.normal_draw_enable=!0,this.custom_draw_enable=!1,this.damageflag=!1,this.damage={count:0,vector:0,dist:0,no:0},this.attack=1,this.mapCollision=!1,this.mapColX=!1,this.mapColY=!1,this.alive=0,this.custom_draw=null,this.old_x=this.x,this.old_y=this.y,this.lighton=!1,this.prioritySurface=!1,this.shiftx=0,this.shifty=0,this.vecfrm,this.barthTime;this.setType=function(t){this.name="unknown",this.type=t,this.colcheck=!(5==t),this.dmgcheck=!(4==t||5==t),98!=t&&0!=t&&2!=t||(this.jump=0,this.jpvec=-5,this.spec={LV:0})}}function gObjectControl(t,e){let n,s,a=e.System.dev;delobj=0,this.score=0,this.interrapt=!1,this.SIGNAL=0;this.item=[],this.combo=[],this.obCount=[],this.combomax=[],this.total=[],this.itemstack=[],this.collisioncount=0,this.itemlv=0,this.ceilflag=!1,this.ceildelay=0,this.ceilindex=-1,this.ceilshadow="rgba(4,4,4,0.8)",this.hidan=0,this.nonmove=0,this.rollcall=function(t){let e=!1;Boolean(y[t])&&(e=y[t]);return e};const r=new function(){let t=[],e=0;this.add=i=>{t[e]=i,e++},this.sort=()=>{t.sort(((t,e)=>t.y-e.y))},this.buffer=()=>t,this.reset=()=>{t=[],e=0}};let l,c,h,m=0,u=character(),f=motionPattern(),_=scenario(this),p=[],y=[],w=[];w[0]=[0,0,2,1,1,0],w[1]=[0,0,1,0,0,0],w[2]=[2,1,2,0,1,0],w[3]=[1,0,0,0,0,0],w[4]=[1,0,1,0,0,0],w[5]=[0,0,0,0,0,0];let g=!0,v=new M(25),d=new M(26),b=new M(21);this.messagelog=v,this.messageview=d,this.messageconsole=b;this.itemTable={0:"操作説明",1:"魔法陣説明",2:"扉説明",15:"杖",16:"剣",17:"戦斧",18:"槍",19:"ﾌﾞｰﾒﾗﾝ",20:"球",21:"1UP",22:"鍵",23:"爆弾",24:"ﾊﾞﾘｱ",25:"回復",26:"ﾗﾝﾌﾟ",27:"地図",35:"ｺｲﾝ",40:"宝箱",50:"弓矢",51:"AmuletR",52:"AmuletG",53:"AmuletB",54:"ﾛｳｿｸR",55:"ﾛｳｿｸB",56:"指輪R",57:"指輪B",58:"鏡"};let x=new M(5);this.tutorialconsole=x;let k=tutorialCommentTable();this.tutTable=function(t){let i="> ";if(Boolean(k[t])&&!Boolean(S[t])){for(let e of k[t])this.tutorialconsole.write(i+e),i="  ";this.tutorialDisplayTime=e.System.time()+1e4,S[t]=!0}};this.tutorialDisplayTime=0;let S=[];function M(t=20){const e=t+1;let i=[];this.read=function(){return i},this.write=function(t){t.length>40&&(t=t.substring(0,40)),i.push(t);let o=[];for(let t in i)t>i.length-e&&o.push(i[t]);i=o},this.clear=function(){i=[]}}let C="-----",B=0;const j=98;function I(t,e){Boolean(f[e.mp].wait)&&(e.mp_cnt_frm++,e.mp_cnt_frm>f[e.mp].wait/2&&(e.mp_cnt_anm++,e.mp_cnt_frm=0,e.mp_cnt_anm>=f[e.mp].pattern.length&&(e.mp_cnt_anm=0)));let i=e.gt.worldtoView(e.x,e.y);T(t,i.x+e.shiftx,i.y+e.shifty,e.mp,e.mp_cnt_anm,e.vector,e.alpha,e.display_size)}function T(t,e,i,o,n,s,a,r){let l;Boolean(n)||(n=0),Boolean(s)||(s=0),Boolean(a)||(a=0),Boolean(r)||(r=0);try{l=f[o].pattern[n][0]}catch(t){n=0,l=f[o].pattern[n][0]}let c=f[o].pattern[n][1],h=f[o].pattern[n][2];-1==c&&-1==h&&(c=0,h=s),t.put(l,e,i,c,h,a,r)}this.reset=function(t){g=!0,n=new CLinear4TreeManager,n.init(6,0,0,3e3,3e3)||alert("!"),delobj=0,m=0,e.Game.cold&&(this.score=0,this.obCount=[],this.combomax=[],this.total=[],this.hidan=0,this.combo=[],this.item=[],this.itemstack=[],S=[],v.write("ObjCtrl Init.")),t||(this.interrapt=!1,this.SIGNAL=0,p=[],e.Config.cold=!0,v.write("ObjCtrl Reset.")),e.Config.fullpower,v.write("ObjCtrl Run."),b.clear(),x.clear()},this.move=function(r,u){l=r;let f=u.keycode;this.nonmove=0,y=[];for(let i in p){let o=p[i];o.vecfrm=60/(1e3/e.System.deltaTime()),o.vecfrm=o.vecfrm>3?3:o.vecfrm,o.alive=e.System.time()-o.barthTime,Boolean(o.name)&&(y[o.name]=!0);let s=o.gt.in_view_range(o.x-o.hit_x/2,o.y-o.hit_y/2,o.hit_x,o.hit_y);if(s||1!=o.type&&3!=o.type||(e.Config.bulletmode&&(o.status=0),o.gt.in_world(o.x,o.y)||(o.status=0)),e.Game.outviewCollision&&(s=!0),s||(this.nonmove++,5==o.type)){o.type==j&&(o.key_state=f,o.entrypadaxis=u,o.score=this.score),0!=o.move(t,o,r)?(o.colitem&&o.colitem.remove(),o.colitem=null,delete p[i],delobj++):5!=o.type&&(o.firstRunning&&o.x==o.old_x&&o.y==o.old_y||(o.gt.in_world(o.x,o.y)||1!=o.type&&3!=o.type&&(o.x=o.gt.worldtoWorld_x(o.x),o.y=o.gt.worldtoWorld_y(o.y)),o.colitem&&o.colitem.remove(),o.colitem||(o.colitem=n.createObjectForTree(),o.colitem.obj=o),n.register(o.x-o.hit_x/2,o.y-o.hit_y/2,o.x+o.hit_x/2,o.y+o.hit_y/2,o.colitem),o.crash=null,o.firstRunning=!0));for(let t=0,i=o.message.length;t<i;t++){let i=o.message[t],n=ObjCmdDecode(i,o,p,e,_);if(n.exec)if(i.cmd!=C){let t=B/5>10?10:B/5;d.write("."+"=".repeat(t)+C),n.log&&v.write("."+i.cmd),C=i.cmd,B=0}else B++}o.message=[],o.mapCollision=!1,o.mapColX=!1,o.mapColY=!1}}if(g){let t=l.mapChip();for(let e=0,i=t.length;e<i;e++){let i=t[e];if(i.c){switch(i.type){case 12:i.no="Door";break;case 13:break;case 14:i.no="Portal";break;case 16:break;default:break}i.colitem||(i.colitem=n.createObjectForTree(),i.colitem.obj=i),n.register(i.x,i.y,i.x+i.w,i.y+i.h,i.colitem)}}g=!1}let b=n.getAllCollisionList();s=b.length,this.collisioncount=s/2,e.System.time()>this.ceildelay+300&&(this.ceilflag=!1);for(let t=0,i=b.length;t<i;t+=2){let i=b[t],o=b[t+1],n=i.type==j?0:i.type,s=o.type==j?0:o.type;if(!(n>=10&&s>=10))if(n<10&&s<10){if(0==w[n][s])continue;if(!i.colcheck||!o.colcheck)continue;Math.abs(i.x-o.x)<(i.hit_x+o.hit_x)/2&&Math.abs(i.y-o.y)<(i.hit_y+o.hit_y)/2&&(i.status=2,o.status=2,i.crash=o,o.crash=i)}else{s<10&&(i=b[t+1],o=b[t]);let n=o,a=!1,l=i.mapCollision,c=i.mapColX,h=i.mapColY;if(n.c&&(Math.abs(i.x+i.vx-(n.x+n.w/2))<(i.hit_x+n.w)/2&&Math.abs(i.y+i.vy-(n.y+n.h/2))<(i.hit_y+n.h)/2&&(i.mapCollision=!0,a=!0),Math.abs(i.x+i.vx-(n.x+n.w/2))<(i.hit_x+n.w)/2&&Math.abs(i.y-(n.y+n.h/2))<(i.hit_y+n.h)/2&&(i.mapColX=!0),Math.abs(i.x-(n.x+n.w/2))<(i.hit_x+n.w)/2&&Math.abs(i.y+i.vy-(n.y+n.h/2))<(i.hit_y+n.h)/2&&(i.mapColY=!0),a&&[12,13,14,16].includes(n.type))){if(i.type==j)switch(n.type){case 12:i.doorflag=!0,i.turndoorkey?(n.no="OpDoor",i.startx=n.x+n.w/2,i.starty=n.y+n.h/2):n.no="Door";break;case 13:this.ceilflag=!0,this.ceildelay=e.System.time(),this.ceilindex=n.index;break;case 14:i.homeflag=!0,i.lighton?n.no="LPortal":n.no="Portal";break;case 16:i.portalflag=!0;break;default:break}else if(2==i.type||3==i.type)switch(n.type){case 13:r.startroom_id()==n.index&&(l=i.mapCollision,c=i.mapColX,h=i.mapColY);break;default:break}i.mapCollision=l,i.mapColX=c,i.mapColY=h}}}let x=r.cmap();for(i in p){if(o=p[i],5==o.type)continue;if(Boolean(x)){let t={},e={};t.x=o.x-o.hit_x/2,t.y=o.y-o.hit_y/2,e.x=o.x+o.hit_x/2,e.y=o.y+o.hit_y/2,t.mx=Math.floor((t.x-96)/32),t.my=Math.floor((t.y-96)/32),e.mx=Math.floor((e.x-96)/32),e.my=Math.floor((e.y-96)/32),t.mx<0||t.my<0||e.mx>x.length||e.my>x.length?o.mapCollision=!0:(Boolean(x[t.mx])&&(Boolean(x[t.mx][t.my])&&(o.mapCollision=!0),Boolean(x[t.mx][e.my])&&(o.mapCollision=!0)),Boolean(x[e.mx])&&(Boolean(x[e.mx][t.my])&&(o.mapCollision=!0),Boolean(x[e.mx][e.my])&&(o.mapCollision=!0)))}let t=o.gt.in_stage_range(o.x-o.hit_x/2,o.y-o.hit_y/2,o.hit_x,o.hit_y);if(e.Game.outviewCollision&&(t=!0),t&&o.crash){if(1==o.type||3==o.type);else{if(!0){let t=o.hp;o.type!=o.crash.type?o.damage.count<=10&&o.crash.dmgcheck&&(o.hp-=o.crash.attack):o.mapCollision=!0,o.hp>0?(o.status=1,t!=o.hp&&(o.damageflag=!0,o.crash.damageflag=!0,o.damage.vector=o.target_r(o.crash.x,o.crash.y),o.damage.dist=o.target_d(o.crash.x,o.crash.y),o.damage.no=o.crash.attack),o.crash=null):(o.type==j&&(e.Game.player.hp=o.hp),o.type)}}}}this.rollcall("mayura")||(m+=60/(1e3/e.System.deltaTime()),this.ceildelay=e.System.time()+1e3,a.sound.duration(5),m>135&&(c=this.interrapt,h=this.SIGNAL,this.interrapt=!0,this.SIGNAL=4649))},this.combo_sub=function(t){return Boolean(this.combo[t])?this.combo[t]++:this.combo[t]=1,Boolean(this.combomax[t])?this.combo[t]>this.combomax[t]&&(this.combomax[t]=this.combo[t]):this.combomax[t]=this.combo[t],Boolean(this.total[t])?this.total[t]++:this.total[t]=1,this.combo[t]},this.restart=function(){l.start(!1),m=0,this.interrapt=c,this.SIGNAL=h},this.draw=function(i,o){Boolean(o)||(o=!1),Boolean(i)||(i=t),r.reset();for(let t in p){let e=p[t];e.visible&&e.prioritySurface==o&&(e.normal_draw_enable||e.custom_draw_enable)&&a.gs.in_stage(e.x,e.y)&&r.add(e)}r.sort();let n=r.buffer();for(let t in n){let o=n[t];if(o.normal_draw_enable&&(o.draw(i,o),e.Config.debug)){let t=o.gt.worldtoView(o.x,o.y),e={};e.x=t.x-o.hit_x/2,e.y=t.y-o.hit_y/2,e.w=o.hit_x,e.h=o.hit_y,e.draw=function(t){t.beginPath(),t.strokeStyle="green",t.lineWidth=2,t.rect(this.x,this.y,this.w,this.h),t.stroke()},5!=o.type&&i.putFunc(e)}o.custom_draw_enable&&Boolean(o.custom_draw)&&o.custom_draw(i,o)}},this.drawPoint=function(e,i){let o=["skyblue","skyblue","red","orange","yellow","yellow"];o[98]="white",Boolean(e)||(e=t);let n=Date.now(),s={};s.obj=p,s.col=o,s.draw=function(t){for(let e in this.obj){let o=this.obj[e];if(o.visible){if(1==o.type||3==o.type||5==o.type)continue;if(o.type!=j&&!i)continue;o.normal_draw_enable&&(t.beginPath(),t.strokeStyle=this.col[o.type],t.lineWidth=1,t.rect(a.layout.map_x+o.x/20,a.layout.map_y+o.y/20,o.hit_x/20,o.hit_y/20),t.stroke()),o.lighton&&(t.beginPath(),t.strokeStyle=this.col[o.type],t.lineWidth=1,t.arc(a.layout.map_x+(o.x+o.hit_x/2)/20,a.layout.map_y+(o.y+o.hit_y/2)/20,n%27/9*2,0,2*Math.PI,!1),t.stroke())}}},e.putFunc(s)},this.drawShadow=function(e){Boolean(e)||(e=t);let i={};i.obj=p,i.draw=function(t){for(let e in this.obj){let i=this.obj[e];if(i.visible&&(1!=i.type&&3!=i.type&&5!=i.type&&i.gt.in_view(i.x,i.y)&&i.normal_draw_enable&&a.gs.in_stage(i.x,i.y))){let e=i.gt.worldtoView(i.x,i.y),o=i.center_x*i.display_size+i.shifty/8,n=i.center_y*i.display_size+i.shifty/8;o>0&&n>0&&(t.beginPath(),t.fillStyle="rgba(0,0,0,0.6)",t.ellipse(e.x,e.y+n,o,n/4,0,0,2*Math.PI,!0),t.fill())}}},e.putFunc(i)},this.set_s=function(i,o,n,s,r,l,c){let h=new gObjectClass(this);h.reset(),h.firstRunning=!1,h.parent=c,h.superviser=this,h.gt=a.gs,h.gameState=e.Game,h.sound=a.sound,(0==u[s].type||u[s].type==j)&&(h.item=this.item,h.itemstack=this.itemstack,h.config=e.Config);h.pick=[],h.pick_enable=!0,h.x=i,h.y=o,h.startx=i,h.starty=o,h.vector=n,h.chr=s,h.visible=!0,h.mp=u[s].mp,h.hp=u[s].hp,h.maxhp=h.hp,h.setType(u[s].type),h.center_x=u[s].center_x,h.center_y=u[s].center_y,h.hit_x=u[s].size_x,h.hit_y=u[s].size_y,Boolean(l)||(l=u[s].id);h.id=l,h.score=u[s].score,h.status=1,Boolean(r)||(r=u[s].senario[0]);h.init=_.init[r],h.move=_.move[r],h.draw=I,h.custom_draw=_.draw[r],h.attack=3,(1==h.type||3==h.type)&&(h.attack=h.hp,1==h.type&&(h.attack+=e.Game.player.spec.STR+e.Game.player.spec.DEX));h.init(t,h);let m=-1;for(let t=0,e=p.length;t<e;t++)if(!p[t]){m=t;break}-1==m?p[p.length]=h:p[m]=h;Boolean(this.obCount[h.type])?this.obCount[h.type]++:this.obCount[h.type]=1;h.barthTime=e.System.time()},this.num=function(){return p.length},this.cnt=function(){let t=0;for(let e in p)t++;return t},this.list=function(){let t=[];for(let e=0;e<p.length;e++){let i="   "+String(e);t[e]=i.substring(i.length-3)+".No.Object"}for(let e in p){let i=p[e],o=i.gt.in_view(i.x,i.y)?"v":"-",n="   "+String(e),s=n.substring(n.length-3)+":"+i.type+","+o+","+i.hp+","+i.status+","+i.mp+","+i.chr;t[e]=s}return t},this.lookObj=function(t){let e=[];if(p[t]instanceof Object){Object.entries(p[t]).forEach((function(t){let i=String(t).split(","),o=i[0];o.length<13&&(o+=" ".repeat(13),o=o.substring(0,13));let n=i[1];e.push("."+o+":"+n)})),e.push(""),e.push("Object.entries end.")}else e.push("No.Object");return e.push(""),e.push("Return [1-9] Key."),e},this.lookObjv=function(t,e,i,o){let n=!1;if(p[e]instanceof Object){let s=p[e];s.visible&&(T(t,i,o,s.mp,s.mp_cnt_anm,s.vector,s.alpha,s.display_size),n=!0)}return n},this.player_objv=function(t){let e={x:0,y:0};for(let i of p)if(i instanceof Object&&Boolean(i.type)&&i.type==j){I(t,i),e=i.gt.worldtoView(i.x,i.y);break}return e},this.lookpick=function(t,e,i,o){let n=!1;if(p[e]instanceof Object){let s=p[e];if(2==s.type&&s.pick.length>0){for(let e of s.pick)T(t,i,o,u[e].mp),i+=16;n=!0}4==s.type&&(T(t,i,o,s.mp),n=!0)}return n},this.get_item=function(t){if(Boolean(this.item[t])?this.item[t]++:this.item[t]=1,23==t||24==t||25==t){let e=t;this.itemstack.push(e)}(t>=15&&t<=19||50==t)&&e.Game.player.stack.push({ch:t,id:0}),a.sound.effect(11),this.messageconsole.write(this.itemTable[t]+".GET")},this.keyitem_view_draw=function(t){let e=376;for(let i=51;i<59;i++)Boolean(this.item[i])&&this.item[i]>0&&(t.put(f[u[i].mp].pattern[0][0],12,e),this.item[i]>1&&t.kprint("+"+(this.item[i]-1),14,e+6),e-=24);this.keyitem_enhance_check()},this.keyitem_reset=function(){for(let t=51;t<59;t++)this.item[t]=0},this.keyitem_enhance_check=function(){for(let t=51;t<59;t++)Boolean(this.item[t])||(this.item[t]=0);e.Game.player.enh.INT=this.item[51]>0?this.item[51]:0,e.Game.player.enh.MND=this.item[52]>0?this.item[52]:0,e.Game.player.enh.VIT=this.item[53]>0?this.item[53]:0,e.Game.player.enh.STR=this.item[56]>0?this.item[56]:0,e.Game.player.enh.DEX=this.item[57]>0?this.item[57]:0,this.ceilshadow=this.item[55]>0?"rgba( 0,64,64,0.2)":this.item[54]>0?"rgba(48,48, 0,0.4)":"rgba(4,4,4,0.8)",e.Game.spec_check()},this.dict_Ch_Sp=function(t){return f[u[t].mp].pattern[0][0]}}function ObjCmdDecode(t,e,i,o,n){objc=o.obCtrl,mapsc=o.mapsc,dev=o.System.dev;let s=!0,a=!0;switch(t.cmd){case"set_object":mapsc.add(e.x,e.y+e.shifty,e.vector,t.src,0,0,e),a=!1;break;case"set_object_ex":mapsc.add(t.dst.x,t.dst.y,t.dst.vector,t.src,t.dst.sce,t.dst.id,e),a=!1;break;case"get_target":let r=99999;e.target=null;for(let o in i){let n=i[o];if(n.type!=t.src)continue;let s=n.target_d(e.x,e.y);s<r&&(e.target=n,r=s)}a=!1;break;case"change_sce":e.init=n.init[t.src],e.move=n.move[t.src],e.custom_draw=n.draw[t.src],e.init(null,e),a=!1;break;case"add_score":objc.score+=t.src;break;case"get_item":if(Boolean(objc.item[t.src])?objc.item[t.src]++:objc.item[t.src]=1,t.src>14){objc.score+=e.score;let i=e.x,n=e.y,s="Get Item."+t.src;35==t.src&&(s=e.score+"pts.",dev.sound.effect(11),mapsc.add(i,n,0,20,39,s)),21==t.src&&(s="Extend!",mapsc.add(i,n,0,20,39,s)),22==t.src&&(s="GetKey!",dev.sound.effect(11),mapsc.add(i,n,0,20,39,s)),(t.src>=15&&t.src<=19||50==t.src)&&(o.Game.player.stack.push({ch:t.src,id:t.dst}),s="Weapon!",dev.sound.effect(11),mapsc.add(i,n,0,20,39,s));let a=!1;if(23!=t.src&&24!=t.src&&25!=t.src||(a=!0),a){let e=t.src;objc.itemstack.push(e)}objc.messageconsole.write(objc.itemTable[t.src]+".GET"),objc.keyitem_enhance_check()}objc.tutTable(t.src);break;case"bomb":for(let t in i)3==i[t].type&&i[t].change_sce(7);break;case"bomb2":for(let t in i){let e=i[t];if(3==e.type){if(e.type=4,e.mp=18,e.score=8,7!=e.chr){let t=[18,22,26,27,29,30];e.mp=t[Math.floor(Math.random()*t.length)]}e.change_sce(30)}}break;case"bomb3":let l=isNaN(t.src)?0:t.src;for(let t in i){e.gt.in_view_range(i[t].x-i[t].hit_x/2,i[t].y-i[t].hit_y/2,i[t].hit_x,i[t].hit_y)&&(2==i[t].type&&(i[t].hp-=10+l,i[t].hp<=0&&(i[t].status=2)),3==i[t].type&&i[t].change_sce(7))}objc.messageconsole.write("=BOMB=");break;case"bomb4":for(let e in i)i[e].chr==t.src&&(i[e].status=0,i[e].hp=0);break;case"collect":for(let t in i){let e=i[t];4==e.type&&(Boolean(e.collection_mode)||(e.collection_mode=!0,e.change_sce(30)))}break;case"collect2":for(let t in i){e.gt.in_view_range(i[t].x-i[t].hit_x/2,i[t].y-i[t].hit_y/2,i[t].hit_x,i[t].hit_y)&&4==i[t].type&&i[t].change_sce(30)}objc.messageconsole.write("=COLLECT=");break;case"collect3":for(let t in i)4==i[t].type&&e.target_d(i[t].x,i[t].y)<100&&i[t].change_sce(30);break;case"SIGNAL":objc.interrapt?(objc.interrapt=!1,objc.SIGNAL=0):(objc.interrapt=!0,objc.SIGNAL=t.src,0==t.src&&(objc.interrapt=!1));break;case"search_target_item":let c=!1,h=0,m=0;for(let e in i){let o=i[e];if(2!=o.type){if(4!=o.type);else if(o.chr==t.src){c=!0,h=o.x,m=o.y,o.lighton=!0;break}}else for(let e of o.pick)if(e==t.src&&(c=!0,h=o.x,m=o.y,o.lighton=!0),c)break}o.Game.keyon=c,o.Game.key_x=h,o.Game.key_y=m,a=!1;break;default:s=!1,a=!1;break}return{exec:s,log:a}}function sce_item_direct_homing(){this.init=function(t,e){e.vector=0,e.vset(16),e.display_size=1,e.colcheck=!0,e.jump=0,e.jpvec=-5,e.shiftx=0,e.shifty=0},this.move=function(t,e){switch(e.frame){case 1:e.get_target(98);break;case 3:e.get_target(98),e.vector=e.target_v();case 4:if(Boolean(this.target)){let t=e.target_d(e.target.x,e.target.y);t=t<15?t+1:16,e.vset(t)}case 8:e.frame=2;break;default:break}return e.mapCollision&&e.change_sce("common_vset0"),e.frame++,e.sc_move()}}function sce_item_near_homing(){this.init=function(t,e){e.vset(0),e.get_target(98)},this.move=function(t,e){if(Boolean(this.target)||e.get_target(98),Boolean(this.target)){e.target_d(e.target.x,e.target.y)<40&&(e.vector=e.target_v(),e.vset(4))}return e.sc_move()}}function sce_item_movingstop(){this.init=function(t,e){e.vset(1),e.wmapc=!1,e.colcnt=0,e.colcheck=!0,e.jump=0,e.jpvec=-5,e.shiftx=0,e.shifty=0},this.move=function(t,e){return e.frame>60&&!e.wmapc?(e.colcheck=!0,e.jump=0,e.jpvec=0,e.shiftx=0,e.shifty=0,e.change_sce("common_vset0")):e.wmapc||(e.wmapc=!0,e.jump=1,e.jpvec=-3,e.colcheck=!1),e.frame++,1==e.jump?(e.shifty=e.shifty+e.jpvec,e.jpvec=e.jpvec+.4*e.vecfrm,e.prioritySurface=!0,e.shifty>0&&(e.jump=0,e.shifty=0,e.prioritySurface=!1,e.colcheck=!0,e.wmapc=!1),e.sc_move()):(e.mapCollision&&(e.colcnt>1&&!e.wmapc?(e.wmapc=!0,e.jump=1,e.jpvec=-3,e.colcheck=!1,e.vector=Math.floor(360*Math.random()),e.vset(1)):(e.colcheck=!0,e.vset(1))),e.sc_move())}}function gameLayout(){this.score_x=460,this.score_y=16,this.hiscore_x=460,this.hiscore_y=0,this.status_x=520,this.status_y=32,this.combo_x=0,this.combo_y=32,this.itemchain_x=0,this.itemchain_y=24,this.zanki_x=160,this.zanki_y=384,this.time_x=520,this.time_y=368,this.stage_x=520,this.stage_y=352,this.map_x=0,this.map_y=0,this.hp_x=308,this.hp_y=368,this.clip_x=140,this.clip_y=364}function main_r(t){const e=640,i=400,o=new GameCore({canvasId:"Layer0",screen:[{resolution:{w:e,h:i,x:0,y:0}},{resolution:{w:e,h:i,x:0,y:0}},{resolution:{w:e,h:i,x:0,y:0}},{resolution:{w:e,h:i,x:0,y:0}},{resolution:{w:e,h:i,x:0,y:0}}]});GameAssetSetup(o),o.task.add(new GameTask_Load("load")),o.task.add(new taskMainLoop("main")),o.task.add(new GameTask_Debug("debug")),o.task.add(new GameTask_Device("device")),o.run()}gObjectClass.prototype={test:function(){return 0},reset:function(){this.status=0,this.type=5,this.visible=!1,this.mp_cnt_frm=0,this.mp_cnt_anm=0,this.scenario=[],this.normal_draw_enable=!0,this.custom_draw_enable=!1,this.damageflag=!1},init:function(t,e){e.vset(5)},draw:function(t,e){t.print(e.mp+"",e.x,e.y)},move:function(t,e){e.x+=e.vx*e.vecfrm,e.y+=e.vy*e.vecfrm;let i=0;return(e.x<0||e.x>t.cw)&&(i=1),(e.y<0||e.y>t.ch)&&(i=1),0!=i?-1:0},vset:function(t){this.vx=Math.cos(Math.PI/180*(this.vector-90))*t,this.vy=Math.sin(Math.PI/180*(this.vector-90))*t},set_object:function(t,e){let i={cmd:"set_object"};i.src=t,i.dst=e,this.message.push(i)},set_object_ex:function(t,e,i,o,n,s){let a={},r={};r.x=e,r.y=i,r.vector=o,r.sce=n,r.id=s,a.cmd="set_object_ex",a.src=t,a.dst=r,this.message.push(a)},get_target:function(t,e){let i={cmd:"get_target"};i.src=t,i.dst=e,this.message.push(i)},change_sce:function(t,e){let i={cmd:"change_sce"};this.frame=0,this.normal_draw_enable=!0,this.custom_draw_enable=!1,i.src=t,i.dst=e,this.message.push(i)},add_score:function(t,e){let i={cmd:"add_score"};i.src=t,i.dst=e,this.message.push(i)},get_item:function(t,e){let i={cmd:"get_item"};i.src=t,i.dst=e,this.message.push(i)},bomb:function(t,e){let i={cmd:"bomb"};i.src=t,i.dst=e,this.message.push(i)},bomb2:function(t,e){let i={cmd:"bomb2"};i.src=t,i.dst=e,this.message.push(i)},bomb3:function(t,e){let i={cmd:"bomb3"};i.src=t,i.dst=e,this.message.push(i)},bomb4:function(t,e){let i={cmd:"bomb4"};i.src=t,i.dst=e,this.message.push(i)},collect:function(t,e){let i={cmd:"collect"};i.src=t,i.dst=e,this.message.push(i)},collect2:function(t,e){let i={cmd:"collect2"};i.src=t,i.dst=e,this.message.push(i)},collect3:function(t,e){let i={cmd:"collect3"};i.src=t,i.dst=e,this.message.push(i)},SIGNAL:function(t,e){let i={cmd:"SIGNAL"};i.src=t,i.dst=e,this.message.push(i)},reset_combo:function(t,e){let i={cmd:"reset_combo"};i.src=t,i.dst=e,this.message.push(i)},search_target_item:function(t,e){let i={cmd:"search_target_item"};i.src=t,i.dst=e,this.message.push(i)},dict_ch_sp:function(t){return this.objCtrl.dict_Ch_Sp(t)},target_r:function(t,e){let i,o=t-this.x,n=e-this.y;return 0==o?i=n>=0?180:0:(i=Math.atan(n/o)*(180/Math.PI),o>=0&&n>=0&&(i=90+i),o>=0&&n<0&&(i=90+i),o<0&&n<0&&(i=270+i),o<0&&n>=0&&(i=270+i)),i},target_v:function(){return Boolean(this.target)?this.target_r(this.target.x,this.target.y):this.vector},target_rotate_r:function(t){if(!Boolean(this.target))return;let e=this.target_r(this.target.x,this.target.y),i=e;i>179&&(i=-360+i),w=this.vector,w>179&&(w=-360+w),e=i-w,Math.abs(e)>180&&(w=(this.vector+180)%360,w>179&&(w=-360+w),e=-1*(i-w)),Math.abs(e)<t&&(t=e),0!=e&&(this.vector=this.vector+e/Math.abs(e)*t),this.vector<0&&(this.vector=360+this.vector),this.vector>359&&(this.vector=this.vector-360)},target_d:function(t,e){let i=this.x,o=this.y;return Math.sqrt(Math.abs(t-i)*Math.abs(t-i)+Math.abs(e-o)*Math.abs(e-o))},rotate:function(t){t=(t%=360)>179?-360+t:t,this.vector=this.vector+t},Sin:function(t){return Math.sin((t-90)*(Math.PI/180))},Cos:function(t){return Math.cos((t-90)*(Math.PI/180))},sc_move:function(){let t=this.gt.in_view_range(this.x-this.hit_x/2,this.y-this.hit_y/2,this.hit_x,this.hit_y),e=0;if(2==this.status)switch(this.type){case 1:case 3:t&&this.sound.effect(12),this.change_sce("effect_vanish"),this.damageflag=!1;break;case 2:this.change_sce("effect_bomb_x"),t&&this.sound.effect(8);for(let t=0,e=Math.floor(3*Math.random())+1;t<e;t++)this.pick.push(35);let e=!1,i=0;for(let t of this.pick)35!=t&&(i+=t);if(i>0&&(e=!0),e)this.set_object_ex(40,this.x,this.y,0,"enemy_trbox");else for(let t in this.pick)this.set_object_ex(35,this.x,this.y,Math.floor(360*Math.random()),"item_movingstop");this.add_score(this.score);break;case 4:Boolean(this.crash)&&this.crash.pick_enable&&(this.change_sce(6),2==this.crash.type&&this.crash.pick.push(this.chr),98==this.crash.type&&(21!=this.chr&&22!=this.chr&&this.sound.effect(9),this.get_item(this.chr,this.id)));break;default:break}this.damageflag&&(this.damage.count=30,t&&this.set_object_ex(6,this.x,this.y,this.vector,"effect_hit"));let i=this.vector,o=this.vx,n=this.vy;if(this.damage.count>0&&(this.damage.count--,this.vector=(this.damage.vector+180)%360,this.vset(this.damage.dist/(10*this.weight)),this.damage.count<15&&this.vset(0)),0==this.status&&(e=1),1!=this.mapCollision)this.colcnt=0,this.old_x=this.x,this.old_y=this.y,this.x+=this.vx*this.vecfrm,this.y+=this.vy*this.vecfrm,this.vector=i,this.vx=o,this.vy=n;else{if(this.colcnt<=0)switch(this.x=this.old_x,this.y=this.old_y,this.type){case 1:case 3:e=1;break;default:this.mapColX&&(this.vx*=-1,this.vector=360-this.vector,this.vector<0&&(this.vector=180+(180+this.vector))),this.mapColY&&(this.vy*=-1,this.vector=180+this.vector,this.vector>360&&(this.vector=540-this.vector),this.vector=this.vector%360),this.mapColX||this.mapColY||(this.vx*=-1,this.vy*=-1,this.vector=(this.vector+180)%360);break}this.colcnt++,this.colcnt>10&&(this.vector=this.target_r(this.startx,this.starty),this.vset(1),this.x+=this.vx,this.y+=this.vy)}return 0!=e?(2==e&&this.reset_combo(this.type),-1):(this.damageflag=!1,0)}};class taskMainLoop extends GameTask{constructor(t){super(t)}state;scene;elm_dbg;elm_lamp;elm_map;init(t){this.state=new stateControl(t),this.scene=new sceneControl(this.state),t.state=this.state}pre=function(t){this.visible=!1,this.enable=!1};step=function(t){let e=this.state.System.dev.key_state.check(),i=this.state.System.dev.directionM(e);t.gamepad.check();const o={up:i.up,down:i.down,left:i.left,right:i.right,trigger:{weapon:!1,useitem:!1,jump:!1,tgtlock:!1},quit:!1,pause:!1,keycode:e};let n=!1;Boolean(e[90])&&(n=e[90]);let s=!1;Boolean(e[32])&&(s=e[32]),o.trigger.weapon=!(!n&&!s),Boolean(e[88])&&(o.trigger.useitem=e[88]),Boolean(e[67])&&(o.trigger.jump=e[67]),Boolean(e[17])&&(o.trigger.tgtlock=e[17]),Boolean(e[27])&&(o.pause=e[27]),Boolean(e[81])&&(o.quit=e[81]),this.scene.step(t,o)};draw=function(t){this.scene.draw(t)}}function mapSceControl(){let t=[];for(let e=0;e<1e3;e++)t[e]=new g;let e,i,o,n,s,a=0,r=-5;this.enable=!0,this.counter_runnning=!0,this.flame=r,this.stage=1,this.keyuse=!0;let l,c,h,m,u,f,_,p,y=[];this.chacheUseStatus=function(){let t="";for(let e in y)Boolean(y[e])&&(t+=e+".");return t},this.StageChache=function(){return y},this.cmap=function(){return _},this.startroom_id=function(){return p};for(let t=1;t<=15;t++)w(t,this.keyuse);function w(t,e){if(!Boolean(y[t])){l=t<=0?new Stage1_vsv(t):t%15==0?new Stage1_brm(t):t<=30?new Stage1(t):new Stage1_tod(t,e);let i=new v;i.mapScenario=l.scenario(),i.bgPattern=l.bgImage(t),i.mapChip=l.bgLayout(),i.initialScenario=l.initial(t),i.bgSpdata=l.bgPtn(),i.colmap=l.colmap,i.startroom_id=l.startroom_id,y[t]=i}c=y[t].mapScenario,h=y[t].bgPattern,m=y[t].mapChip,u=y[t].initialScenario,f=y[t].bgSpdata,_=y[t].colmap,p=y[t].startroom_id}function g(){this.x,this.y,this.r,this.ch,this.sce,this.parent}function v(){this.data,this.mapScenario,this.bgPattern,this.mapChip,this.initialScenario,this.bgSpdata,this.colmap,this.startroom_id}this.change=function(t){this.stage=t,e=[],a=0,w(t,this.keyuse),i=c,o=u},this.bgImage=function(){return h},this.bgPtn=function(){return f},this.mapChip=function(){return m},this.ini_sc=function(){return u},this.event=function(){return e},this.init=function(){this.stage=1,e=[],w(this.stage,this.keyuse),i=c,o=u},this.reset=function(t){this.enable=!0,this.counter_runnning=!0,n=t+80,r=-5,this.start(!1),this.start(!0)},this.counterReset=function(t){n=t,r=0;for(let t=0,e=i.length;t<e;t++){i[t].used=!1}},this.step=function(t,o){if(this.enable){this.counter_runnning&&r++,r=Math.trunc(o-n),r=r>12e4?12e4:r;for(let t=0,e=i.length;t<e;t++){let e=i[t];if(!e.used){if(e.count<=r){if(e.x<0&&e.y<0){r=0;break}this.add(e.x,e.y,e.r,e.ch,e.sc),e.used=!0}if(e.count>r)break}}for(let i=0,o=e.length;i<o;i++){let o=e[i];t.set_s(o.x,o.y,o.r,o.ch,o.sce,o.id,o.parent)}e=[],a=0,this.flame=r}},this.add=function(i,o,n,s,r,l,c){this.enable&&(ev=t[a],a++,a>=1e3&&(a=0),ev.x=i,ev.y=o,ev.r=n,ev.ch=s,ev.sce=r,ev.id=l,ev.parent=c,e[e.length]=ev)},this.start=function(t){for(let e=0,i=o.length;e<i;e++){let i=o[e];t==i.s&&this.add(i.x,i.y,i.r,i.ch,i.sc)}},this.pauseOn=function(t){s=t},this.pauseOff=function(t){n+=t-s}}function sce_message_billboard(t,e){this.init=function(i,o){o.vset(0),o.type=5,this.normal_draw_enable=!1,this.custom_draw_enable=!0,o.p_count=0,o.mes_col=0,o.mes_line=0,o.p_wait=e,o.p_endflag=!1,o.p_st=t,o.x=o.gt.world_x+1,o.y=o.gt.world_y+1},this.move=function(t,e){return e.x=e.gt.world_x+1,e.y=e.gt.world_y+1,e.p_count--,e.p_count<=0&&(e.p_endflag&&(e.status=0),e.mes_col++,e.mes_col>e.p_st[e.mes_line].length&&(e.mes_col=0,e.mes_line++,e.mes_line>e.p_st.length-1&&(e.mes_line=e.p_st.length-1,e.mes_col=e.p_st[e.mes_line].length,e.p_endflag=!0)),e.p_count=e.p_wait+(e.p_endflag?40:0)),e.sc_move()},this.draw=function(t,e){for(let i=0;i<=e.mes_line;i++)if(i<e.mes_line)t.putchr(e.p_st[i],160,50+16*i);else{let o=e.p_st[i].slice(0,e.mes_col+1);t.putchr(o,160,50+16*i)}}}function sce_message_small(t){this.init=function(t,e){e.vset(1),e.type=5,this.normal_draw_enable=!1,this.custom_draw_enable=!0,e.w_st=e.id,e.x-=8*e.w_st.length/2,e.display_size=1},this.move=function(t,e){return e.frame>50&&(e.status=0),e.frame++,e.sc_move()},this.draw=function(e,i){let o=i.gt.worldtoView(i.x,i.y);e.putchr8c(i.w_st,o.x,o.y,t,i.display_size)}}function sce_message_normal(t){this.init=function(e,i){i.vset(0),i.type=5,this.normal_draw_enable=!1,this.custom_draw_enable=!0,i.w_st=i.id,i.x-=12*i.w_st.length/2,i.wait=t,i.display_size=1},this.move=function(e,i){return i.frame>t&&(i.status=0),i.display_size=1+i.frame/60,i.frame++,i.sc_move()},this.draw=function(t,e){let i=e.gt.worldtoView(e.x,e.y);t.putchr(e.w_st,i.x,i.y,e.display_size)}}function sce_message_bosstriger(){this.init=function(t,e){e.vset(0),e.type=5,this.normal_draw_enable=!1,e.x=e.gt.world_x+1,e.y=e.gt.world_y+1},this.move=function(t,e){return e.x=e.gt.world_x+1,e.y=e.gt.world_y+1,e.SIGNAL(6055),e.status=0,e.sc_move()}}function sce_message_signal(t){this.init=function(e,i){i.name=t,i.vset(0),i.type=5,this.normal_draw_enable=!1,i.x=i.gt.world_x+1,i.y=i.gt.world_y+1},this.move=function(t,e){return e.x=e.gt.world_x+1,e.y=e.gt.world_y+1,e.status=0,e.sc_move()}}function motionPattern(){let t=[],e=0;t[e]={},t[e].wait=0,t[e].pattern=[["Space",0,0]],e=1,t[e]={},t[e].wait=18,t[e].pattern=[["Mayura1",0,0],["Mayura2",0,0],["Mayura3",0,0],["Mayura4",0,0]],e=2,t[e]={},t[e].wait=18,t[e].pattern=[["Mayura1",2,0],["Mayura2",2,0],["Mayura3",2,0],["Mayura4",2,0]],e=3,t[e]={},t[e].pattern=[["miniMay",0,0]],e=4,t[e]={},t[e].wait=18,t[e].pattern=[["Unyuu1",0,0],["Unyuu2",0,0]],e=5,t[e]={},t[e].wait=18,t[e].pattern=[["Unyuu1",2,0],["Unyuu2",2,0]],e=31,t[e]={},t[e].pattern=[["Unyuu3",0,0]],e=6,t[e]={},t[e].pattern=[["Unyuu3",2,0]],e=7,t[e]={},t[e].wait=18,t[e].pattern=[["Fire1",0,0],["Fire2",0,0]],e=12,t[e]={},t[e].wait=10,t[e].pattern=[["Down5",0,0],["Down4",0,0],["Down3",0,0],["Down2",0,0],["Down1",0,0],["Down2",0,0],["Down3",0,0],["Down4",0,0],["Down5",0,0]],e=11,t[e]={},t[e].wait=15,t[e].pattern=[["Zap1",0,0],["Zap2",0,0],["Zap3",0,0],["Zap4",0,0]],e=26,t[e]={},t[e].wait=10,t[e].pattern=[["Ball1",0,0],["Ball2",0,0],["Ball3",0,0],["Ball2",0,0]],e=27,t[e]={},t[e].pattern=[["sKey",0,0]],e=28,t[e]={},t[e].wait=10,t[e].pattern=[["BallB1",0,0],["BallB2",0,0],["BallB3",0,0],["BallB2",0,0]],e=29,t[e]={},t[e].wait=10,t[e].pattern=[["BallS1",0,0],["BallS2",0,0],["BallS3",0,0],["BallS2",0,0]],e=30,t[e]={},t[e].wait=10,t[e].pattern=[["BallL1",0,0],["BallL2",0,0],["BallL3",0,0],["BallL2",0,0]],e=32,t[e]={},t[e].wait=5,t[e].pattern=[["Coin1",0,0],["Coin2",0,0],["Coin3",0,0],["Coin4",0,0],["Coin3",2,0],["Coin2",2,0],["Coin1",2,0]],e=15,t[e]={},t[e].pattern=[["Knife",0,0]],e=16,t[e]={},t[e].pattern=[["Spear",0,0]],e=17,t[e]={},t[e].pattern=[["Boom",0,0]],e=18,t[e]={},t[e].pattern=[["Bow",0,0]],e=33,t[e]={},t[e].pattern=[["Lamp",0,0]],e=34,t[e]={},t[e].pattern=[["Map",0,0]],e=35,t[e]={},t[e].pattern=[["lance",-1,-1]],e=36,t[e]={},t[e].pattern=[["BoomR",-1,-1]],e=37,t[e]={},t[e].pattern=[["Axe",0,0]],e=38,t[e]={},t[e].pattern=[["Wand",0,0]],e=39,t[e]={},t[e].pattern=[["TrBox",0,0]],e=40,t[e]={},t[e].pattern=[["Baxe",-1,-1]],e=41,t[e]={},t[e].pattern=[["Rod",-1,-1]],e=42,t[e]={},t[e].pattern=[["Sword",-1,-1]],e=43,t[e]={},t[e].pattern=[["LBow",-1,-1]],e=44,t[e]={},t[e].pattern=[["Arrow",-1,-1]],e=45,t[e]={},t[e].wait=10,t[e].pattern=[["Cursor1",-1,-1],["Cursor2",-1,-1],["Cursor3",-1,-1],["Cursor2",-1,-1]],e=46,t[e]={},t[e].wait=10,t[e].pattern=[["Barn1",-1,-1],["Barn2",-1,-1],["Barn3",-1,-1]];let i=[{no:50,sp:"AmuletR"},{no:51,sp:"AmuletG"},{no:52,sp:"AmuletB"},{no:53,sp:"CandleR"},{no:54,sp:"CandleB"},{no:55,sp:"RingR"},{no:56,sp:"RingB"},{no:57,sp:"Mirror"}];for(let e in i)t[i[e].no]={pattern:[[i[e].sp,0,0]]};return t}function sce_player(t){let e=300;const o=20;let n={ptr:0,x:Array(40),y:Array(40)};const s=[{no:0,chr:15,name:"rod",auto:!1},{no:1,chr:16,name:"sword",auto:!0},{no:2,chr:17,name:"axe",auto:!0},{no:3,chr:19,name:"spear",auto:!0},{no:4,chr:18,name:"boom",auto:!0},{no:5,chr:50,name:"bow",auto:!0}];function a(t){Boolean(t)||(t=16);let e=0,i=0*t,o=.25*t,n=.5*t,s=.75*t;this.check=function(a){a.up&&e!=i&&(e>o&&e<s&&e!=i?e=i:(e>=s&&e<t&&e++,e<=o&&e>i&&e--)),a.right&&e!=o&&(e>n?e=o:(e<=n&&e>o&&e--,e<o&&e++)),a.down&&e!=n&&(e>s||e<o?e=n:(e>=o&&e<n&&e++,e>n&&e<=s&&e--)),a.left&&e!=s&&(e<n&&e!=i?e=s:(e>=n&&e<s&&e++,(e>s||e==i)&&(e==i&&(e=t),e--))),a.up&&a.right&&(e=.125*t),a.up&&a.left&&(e=.875*t),a.down&&a.right&&(e=.375*t),a.down&&a.left&&(e=.625*t)},this.vector=function(){return e*(360/t)},this.num=function(){return e+"."+("S:"+t+".0:"+i+".3:"+o+".6:"+n+".9:"+s)}}let r,l,c,h;function m(e){let i=e.gameState.player,o=[],n=0;this.check=function(){o.length>5&&n++;n>3&&(t.tutTable(11),n=0,o=[]);let a=!1;if(!Boolean(i.stack))return a;if(i.stack.length>0){let t=i.stack.pop();for(let n of s)t.ch==n.chr?(e.item[n.chr]>0&&e.item[n.chr]--,i.weapon==n.no?(o[n.no]=!0,"rod"==n.name?Boolean(e.item[20])?e.item[20]+=7:e.item[20]=7:(i.level++,Boolean(e.item[4])||(e.get_item(4),o[4]=!0))):i.level=t.id,i.weapon=n.no,a=!0):a=!1}return a}}let u={vx:0,vy:0,cnt:0};this.init=function(i,o){o.name="mayura",o.triger=10,o.shot=0,o.trigerSub=10,o.shotSub=0,o.autotrig=10,o.autoshot=0,o.jump=0,o.jpcount=40,o.jpvec=-8,o.shiftx=0,o.shifty=0,o.mvkeytrig=0,o.maxspeed=4,o.custom_draw_enable=!0,o.gt.viewpos(o.x-o.gt.viewwidth/2,o.y-o.gt.viewheight/2),o.old_x=o.x,o.old_y=o.y,o.hp=o.gameState.player.hp,o.maxhp=o.gameState.player.maxhp,o.barrier=o.gameState.player.barrier,o.before_hp=o.hp,o.before_weapon=o.gameState.player.weapon,o.before_wlevel=o.gameState.player.level,Boolean(o.gameState.player.stack)||(o.gameState.player.stack=[]),o.lighton=!1,o.doorflag=!1,o.turndoorkey=!1,o.homeflag=!1,o.portalflag=!1,o.warptime=o.alive,o.startx=o.x,o.starty=o.y,o.turlet=new a(180),o.repro=!1,o.w_repro=!1,o.getweapon=new m(o),t.keyitem_enhance_check(),o.spec=o.gameState.player.spec,o.spec.LV=o.gameState.player.level,o.spec.HP=o.gameState.player.maxhp,e=300+30*o.spec.VIT,l=!1,c=!1,h=Math.trunc(o.gameState.player.hp/o.gameState.player.maxhp*32),ws_charge_t=o.alive,ws_charge_c=-2,n.ptr=0,n.x.fill(o.x),n.y.fill(o.y),o.gameState.player.zanki>=Math.floor(o.gameState.nowstage/5)+2&&o.bomb4(21),o.set_object(100),o.get_item(0),o.frame=e},this.draw=function(t,i){(function(t,e){if(0!=e.itemstack.length){let i=["BallB1","BallS1","BallL1"],o=e.itemstack[e.itemstack.length-1]-23,n=e.turlet.vector();if(!(o<0||o>2)){let s=e.gt.worldtoView(e.x,e.y),a=s.x+e.shiftx,r=s.y+e.shifty;a-=16*e.Cos(n),r-=16*e.Sin(n),t.put(i[o],a,r)}}if(3!=e.gameState.player.weapon)return;let i=["Wand","Knife","Axe","BoomR","Spear","Bow"];Boolean(e.gameState.player.weapon)||(e.gameState.player.weapon=0);let o=e.gt.worldtoView(e.x,e.y),n=o.x+e.shiftx,s=o.y+e.shifty,a=e.turlet.vector();n+=16*e.Cos(a),s+=16*e.Sin(a),t.put(i[e.gameState.player.weapon],n,s)})(t,i),function(t,i){let o=!1;if(i.frame<=e){let n={},s=i.gt.worldtoView(i.x,i.y);n.x=s.x+i.shiftx,n.y=s.y+i.shifty,n.r=25+i.frame%5;let a=(e-i.frame)/e,r=Math.trunc(63*a)+192,l=Math.trunc(127*a)+128,c=Math.trunc(255*a);n.c="rgb("+r+","+l+","+c+")",n.lw=Math.trunc(i.frame)%Math.trunc(30*a),n.draw=function(t){t.beginPath(),t.strokeStyle=this.c,t.lineWidth=this.lw,t.arc(this.x,this.y,this.r,0,2*Math.PI,!1),t.stroke()},t.putFunc(n),o=!0}lbar={},lbar.hp=i.hp,lbar.mhp=i.maxhp;let s=i.gt.worldtoView(i.x,i.y);lbar.x=s.x+i.shiftx,lbar.y=s.y+i.shifty+i.hit_y+3,lbar.bbw=h;let a=Math.trunc(i.gameState.player.hp/i.gameState.player.maxhp*32);h>a&&(h-=.32);h<=a&&(h=a);lbar.cbar=o?"skyblue":lbar.hp/lbar.mhp>.5?"limegreen":"yellowgreen",lbar.cborder=lbar.hp/lbar.mhp>.5?"white":lbar.hp/lbar.mhp>.3?"yellow":"orange",lbar.draw=function(t){t.beginPath(),t.fillStyle="red",t.lineWidth=1,t.fillRect(this.x-16,this.y+3,this.bbw,2),t.stroke(),t.beginPath(),t.fillStyle=this.cbar,t.lineWidth=1,t.fillRect(this.x-16,this.y+3,this.hp/this.mhp*32,2),t.stroke(),t.beginPath(),t.strokeStyle=this.cborder,t.lineWidth=1,t.rect(this.x-17,this.y+2,34,4),t.stroke()},i.hp!=i.maxhp&&t.putFunc(lbar);for(let e=0;e<n.x.length-5;e++){let o=i.gt.worldtoView(n.x[(n.ptr+e)%n.x.length],n.y[(n.ptr+e)%n.x.length]);e>n.x.length-i.item[20]&&t.fill(o.x,o.y,2,2,"gray"),e>n.x.length-i.itemstack.length&&Boolean(i.itemstack[n.x.length-e])&&t.fill(o.x,o.y,2,2,"white")}}(t,i)},this.move=function(a,h){let m=0,f=0,_=0;for(let t in h.item)20==t&&(m=h.item[t]),21==t&&(f=h.item[t]),22==t&&(_=h.item[t]);h.frame+=h.vecfrm;let p=4+(m>40?2:m/20);h.maxspeed=p,Boolean(h.item[7])||p>4.5&&h.get_item(7),h.frame<=e&&(h.hp=h.maxhp,h.attack=10,h.gameState.player.barrier=!0,h.gameState.player.shieldtime=Math.trunc((e-h.frame)/e*100),h.lighton=!0,0!=h.gameState.player.weapon&&(h.maxspeed=p-1.5)),h.frame>e&&h.gameState.player.barrier&&(h.hp=h.before_hp,h.attack=1,h.gameState.player.hp=h.before_hp,h.gameState.player.barrier=!1,h.gameState.player.shieldtime=0,h.lighton=!1),0==h.jump&&h.vset(0);let y=0,w=h.entrypadaxis.up,g=h.entrypadaxis.down,v=h.entrypadaxis.left,d=h.entrypadaxis.right;if(v&&(h.vector=270),w&&(h.vector=0),d&&(h.vector=90),g&&(h.vector=180),w&&v&&(h.vector=315),w&&d&&(h.vector=45),g&&v&&(h.vector=225),g&&d&&(h.vector=135),w||g||v||d){h.mvkeytrig=h.mvkeytrig+h.vecfrm>30?30:h.mvkeytrig+h.vecfrm,y=h.mvkeytrig>15?h.maxspeed:1,0==h.jump&&h.vset(y);let e=!1;Boolean(h.key_state[17])&&(h.key_state[17]&&(e=!0),t.tutTable(11)),e||h.turlet.check(h.entrypadaxis)}else h.mvkeytrig-=h.vecfrm,h.mvkeytrig=h.mvkeytrig-h.vecfrm<0?0:h.mvkeytrig;h.vector>180?h.mp=2:h.mp=1;let b=!1;Boolean(h.key_state[90])&&h.key_state[90]&&(b=!0),Boolean(h.key_state[32])&&h.key_state[32]&&(b=!0);let x=!1;Boolean(h.key_state[88])&&h.key_state[88]&&(x=!0);let k=!1;Boolean(h.key_state[67])&&h.key_state[67]&&(k=!0);let S=!1;Boolean(h.key_state[72])&&h.key_state[72]&&(S=!0);let M=!1;if(Boolean(h.key_state[27])&&h.key_state[27]&&(M=!0),h.triger-=h.vecfrm,h.triger<=0&&!b&&(h.shot=0,h.triger=5),h.trigerSub-=h.vecfrm,h.trigerSub<=0&&!x&&(h.shotSub=0,h.trigerSub=5),h.autotrig-=h.vecfrm,h.autotrig<=0&&(h.autoshot=0,h.autotrig=5),b&&0==h.shot){h.shot=1,h.sound.effect(7),h.triger=15;let t=h.vector;switch(h.vector=h.turlet.vector(),h.gameState.player.weapon){case 0:h.set_object(39),(m>0||h.config.shotfree)&&(h.set_object(6),h.set_object(7),h.item[20]--,h.item[20]<0&&(h.item[20]=0),h.triger=o);default:(m>0||h.config.shotfree)&&(h.collect2(),h.item[20]--,h.item[20]<0&&(h.item[20]=0),h.triger=o);break}t=h.vector}if(x&&0==h.shotSub&&(h.shotSub=1,h.itemstack.length>0)){let t=h.itemstack.pop();if(23==t&&(h.sound.effect(13),h.bomb3(2*h.spec.INT),h.set_object_ex(6,h.x,h.y,0,47),h.item[23]--),24==t&&(h.sound.effect(10),h.gameState.player.barrier||(h.before_hp=h.hp),e=300+30*h.spec.VIT,h.frame=0,h.item[24]--),25==t){let t=3+h.spec.MND;if(h.sound.effect(10),h.frame<=e)h.before_hp+=t,h.maxhp++,h.before_hp>h.maxhp&&(h.before_hp=h.maxhp),h.gameState.player.hp=h.before_hp;else{let t=3+h.spec.MND;h.hp+=t,h.maxhp++,h.hp>h.maxhp&&(h.hp=h.maxhp),h.gameState.player.hp=h.hp}h.gameState.player.maxhp=h.maxhp,h.spec.HP=h.maxhp,h.item[25]--,h.set_object_ex(20,h.x,h.y,0,43,"+"+t)}h.trigerSub=o}if(k&&0==h.shot&&0==h.jump&&(h.shot=1,h.jump=1,h.jpcount=40,h.jpvec=-5.6-.4*h.vecfrm,h.colcheck=!1,h.triger=o),S&&0==h.shot&&(h.shot=1,t.ceilflag?h.set_object_ex(20,h.x,h.y,0,43,"Hi!"):(h.item[35]<10&&(h.item[35]+=10),h.portalflag=!0),h.triger=o,t.tutTable(12)),M&&0==h.shot&&(h.shot=1,h.SIGNAL(1),h.triger=o),1==h.jump&&(h.jpcount--,h.shifty=h.shifty+h.jpvec,h.jpvec=h.jpvec+.4*h.vecfrm,h.prioritySurface=!0,h.shifty>0&&(h.jump=0,h.shifty=0,h.prioritySurface=!1,h.colcheck=!0)),0==h.autoshot&&s[h.gameState.player.weapon].auto){h.autoshot=1;let t=4*(h.gameState.player.level>3?3:h.gameState.player.level);h.autotrig=20-t;let e=h.vector;switch(h.vector=h.turlet.vector(),h.gameState.player.weapon){case 1:h.set_object(10);break;case 2:h.set_object(38);break;case 3:h.set_object(37);break;case 4:h.set_object(36);break;case 5:h.set_object_ex(46,h.x,h.y+h.shifty,h.vector-10,"common_vset10"),h.set_object_ex(46,h.x,h.y+h.shifty,h.vector,"common_vset10"),h.set_object_ex(46,h.x,h.y+h.shifty,h.vector+10,"common_vset10"),h.set_object(47);break;default:break}h.vector=e}if(h.getweapon.check(),h.gameState.player.weapon!=h.before_weapon){let t=[15,16,17,19,18,50][h.before_weapon],e=(h.vector+18*(h.before_weapon-2)+180)%360;this.set_object_ex(t,h.x+30*h.Cos(e),h.y+30*h.Sin(e),e,38,h.before_wlevel),h.before_weapon=h.gameState.player.weapon,h.spec.LV=h.gameState.player.level,h.autotrig=5}h.before_wlevel=h.gameState.player.level,h.damageflag&&(h.frame>e?(h.set_object_ex(20,h.x,h.y,0,42,"-"+h.damage.no),h.gameState.player.hp=h.hp,h.set_object_ex(6,h.x,h.y,h.vector,"effect_hit")):h.set_object_ex(6,h.x,h.y,h.vector,"effect_hit_shield"),h.damage.count=15);let C=this.vector,B=this.vx,j=this.vy;h.damage.count>0&&(h.damage.count--,h.vector=(h.damage.vector+180)%360,h.vset(this.damage.dist/10)),h.damageflag=!1,h.warptime>h.alive&&(h.mapCollision=!1),h.mapCollision?(h.x=h.old_x,h.y=h.old_y):(h.old_x=h.x,h.old_y=h.y,h.x+=h.vx*h.vecfrm,h.y+=h.vy*h.vecfrm,h.x==h.old_x&&h.y==h.old_y||(n.x[n.ptr]=h.x,n.y[n.ptr]=h.y+h.shifty,n.ptr++,n.ptr=n.ptr%n.x.length));let I=h.gt.worldtoView(h.x,h.y),T=h.gt.world_x,G=h.gt.world_y;h.gt.viewwidth/2-(I.x-I.sx)>120&&(T=h.x-h.gt.viewwidth/2+120),h.gt.viewwidth/2-(I.x-I.sx)<-120&&(T=h.x-h.gt.viewwidth/2-120),h.gt.viewheight/2-(I.y-I.sy)>50&&(G=h.y-h.gt.viewheight/2+50),h.gt.viewheight/2-(I.y-I.sy)<-50&&(G=h.y-h.gt.viewheight/2-50),h.gt.in_view(h.x,h.y)||(h.x!=h.old_x&&(T=h.x-h.gt.viewwidth/2),h.y!=h.old_y&&(G=h.y-h.gt.viewheight/2)),h.gt.viewpos(T,G),h.vector=C,h.vx=B,h.vy=j,c||h.turndoorkey||!h.doorflag||0!=h.jump||(Boolean(h.item[2])||h.get_item(2),_>0&&(h.turndoorkey=!0,r=h.alive)),!c&&h.turndoorkey&&h.alive>r+100&&(c=!0,h.jump=1,h.jpcount=40,h.jpvec=-2.8-.2*h.vecfrm,h.colcheck=!1,h.triger=o,r=h.alive),c&&(h.vx=2*Math.sign(h.startx-h.x),h.vy=2*Math.sign(h.starty-h.y),h.alive>r+250&&h.doorflag&&0==h.jump&&(h.item[22]=0,h.gameState.player.hp=h.hp,h.SIGNAL(835))),h.doorflag=!1;let P=100*Math.pow(h.spec.ETC+1,2);if(h.score>=P&&!l&&h.homeflag&&0==h.jump?(Boolean(h.item[1])||h.get_item(1),h.sound.effect(14),r=h.alive,l=!0,h.lighton=!0):h.homeflag=!1,l&&h.alive>r+250&&(h.spec.ETC++,l=!1,h.lighton=!1,h.set_object_ex(20,h.x,h.y,0,43,"Lvup"),h.SIGNAL(1709),Boolean(h.item[5])||h.spec.ETC>2&&h.get_item(5)),h.warptime<=h.alive&&h.portalflag&&0==h.jump&&(Boolean(h.item[10])||h.get_item(10),h.item[35]>=10?(h.item[35]--,h.warptime=h.alive+1e3,h.portalflag=!1,h.jump=1,h.jpcount=60,h.jpvec=-14.6,h.colcheck=!1,h.triger=o,u.vx=h.startx-h.x,u.vy=h.starty-h.y,u.cnt=0,h.sound.effect(17),h.portalflag=!1):h.portalflag=!1),h.warptime>h.alive){h.warptime,h.alive;u.cnt%5==0&&h.item[35]--,u.cnt++;let t=60-u.cnt;t>1?(h.vx=u.vx/t,h.vy=u.vy/t):(h.vx=(h.startx-h.x)/2,h.vy=(h.starty-h.y)/2),u.vx=h.startx-h.x,u.vy=h.starty-h.y,u.vx>16&&u.vy>16&&(h.jump=1,h.colcheck=!1)}h.item[20]>=10&&!h.repro&&(h.set_object_ex(0,h.x,h.y,h.vector,"sce_friend_option_0"),h.repro=!0,Boolean(h.item[8])||h.get_item(8)),h.item[20]<10&&(h.repro=!1);let A=0;if(2==h.status){if(h.config.itemreset){let t=m>10?10:m;for(i=1;i<=t;i++)this.set_object_ex(20,h.x,h.y,Math.floor(360*Math.random()),38);let e=h.itemstack.length;for(e>10&&(e=10),i=0;i<e;i++){let t=h.itemstack.pop();this.set_object_ex(t,h.x,h.y,Math.floor(360*Math.random()),38)}_>0&&this.set_object_ex(22,h.x,h.y,Math.floor(360*Math.random()),"common_vset0");for(let t=51;t<59;t++)Boolean(h.item[t])&&h.item[t]>0&&this.set_object_ex(t,h.x,h.y,Math.floor(360*Math.random()),38)}h.display_size=1.3,h.change_sce("effect_bomb_x"),h.sound.change(5),h.sound.play(5),h.superviser.ceildelay+=1500,h.bomb4(33)}return h.alive,0==h.status&&(A=1),A}}function sce_player_start(){let t;this.init=function(e,i){i.type=98,i.vector=0,i.vset(0),t=0},this.move=function(e,i){let o=i.gt.worldtoView(i.x,i.y),n=i.gt.world_x,s=i.gt.world_y;return i.gt.viewwidth/2-(o.x-o.sx)>120&&(n=i.x-i.gt.viewwidth/2+120),i.gt.viewwidth/2-(o.x-o.sx)<-120&&(n=i.x-i.gt.viewwidth/2-120),i.gt.viewheight/2-(o.y-o.sy)>50&&(s=i.y-i.gt.viewheight/2+50),i.gt.viewheight/2-(o.y-o.sy)<-50&&(s=i.y-i.gt.viewheight/2-50),i.gt.in_view(i.x,i.y)||(i.x!=i.old_x&&(n=i.x-i.gt.viewwidth/2),i.y!=i.old_y&&(s=i.y-i.gt.viewheight/2)),i.gt.viewpos(n,s),t++,t%3==0&&(i.normal_draw_enable=!i.normal_draw_enable),i.alive>1500&&i.change_sce("player"),i.sc_move()}}function sce_pl_bullet_homing(){this.init=function(t,e){e.vector=e.vector>180?e.vector+80:e.vector-80,e.vset(16),e.get_target(2)},this.move=function(t,e){switch(e.frame){case 1:break;case 2:e.get_target(2),e.target_rotate_r(15),e.vset(16);break;case 5:e.frame=1;break;default:break}return e.frame++,e.sc_move()},this.draw=function(t,e){if(!Boolean(e.target))return;let i={};i.sx=e.x,i.sy=e.y,i.ex=e.target.x,i.ey=e.target.y,i.draw=function(t){t.beginPath(),t.moveTo(this.sx,this.sy),t.lineTo(this.ex,this.ey),t.strokeStyle="red",t.stroke()},t.putFunc(i)}}function sce_pl_bullet_homing2(){this.init=function(t,e){e.vector=e.vector>180?e.vector-5:e.vector+5,e.vset(4),e.get_target(2),e.w_cnt=0},this.move=function(t,e){switch(e.w_cnt){case 1:break;case 2:e.frame>90&&e.get_target(2),Boolean(e.target)&&e.gt.in_view(e.target.x,e.target.y)&&e.target_rotate_r(15+(e.frame<20?15:0)),e.vset(4+(e.frame>20?4:0)+(e.frame>25?8:0));break;case 4:e.w_cnt=1;break;default:break}return e.w_cnt++,e.frame++,e.sc_move()}}function sce_pl_bullet_subshot(t){this.init=function(e,i){i.vset(t),i.mp=7,i.alpha=128},this.move=function(t,e){return e.frame>12&&(e.status=0),e.frame++,e.sc_move()}}function sce_pl_bullet_laser_head(){this.init=function(t,e){e.vector=0,e.y=e.y-20,e.vset(28),e.get_target(2),e.alpha=64,e.w_cnt=0},this.move=function(t,e){switch(e.w_cnt){case 1:break;case 2:e.get_target(2),e.target_rotate_r(3),e.vset(28);break;case 4:e.w_cnt=1;break;default:break}return e.set_object_ex(23,e.x,e.y,e.vector,46),e.w_cnt++,e.frame++,e.sc_move()}}function sce_pl_bullet_laser_tail(){this.init=function(t,e){e.vset(0)},this.move=function(t,e){return e.frame>10&&(e.status=0),e.frame++,e.sc_move()}}function sce_pl_bullet_rotate_circle(){RSPEED=5,this.init=function(t,e){e.vset(0),e.x+=30*e.Cos(e.vector),e.y+=30*e.Sin(e.vector),e.rotatecount=0,e.hr=0,e.startv=e.vector,e.leftrotate=e.vector>179},this.move=function(t,e){let i=0;if(!Boolean(e.parent))return e.change_sce(7),1;e.vector=e.parent.vector,e.leftrotate=e.vector>179,e.damageflag,e.rotatecount+=e.vecfrm,e.rotatecount=e.rotatecount%(360/RSPEED),e.leftrotate?e.vector=(e.startv+(360-e.rotatecount*RSPEED))%360:e.vector=(e.startv+e.rotatecount*RSPEED)%360,e.hr=e.alive%500>250?e.hr+1:e.hr-1;let o=50+e.hr;return e.x=e.parent.x+e.Cos(e.vector)*o,e.y=e.parent.y+e.parent.shifty+e.Sin(e.vector)*o,e.vset(1),0==e.status&&(i=1),e.sc_move()}}function scenario(t){let e={},i=[],o=[],n=[];for(let t=0;t<=37;t++)i[t]=function(t,e){e.vset(5)},n[t]=function(t,e){return e.sc_move()};return w=new sce_player(t),i[1]=w.init,n[1]=w.move,o[1]=w.draw,i.player=w.init,n.player=w.move,o.player=w.draw,w=new sce_enemy_move_n(90,-90),i[2]=w.init,n[2]=w.move,i.enemy_move_n_r=w.init,n.enemy_move_n_r=w.move,w=new sce_enemy_move_n(90,-90),i[3]=w.init,n[3]=w.move,i.enemy_move_n_l=w.init,n.enemy_move_n_l=w.move,o.enemy_move_n_l=w.draw,w=new sce_common_vset(4),i[4]=w.init,n[4]=w.move,i.common_vset4=w.init,n.common_vset4=w.move,w=new sce_effect_vanish,i[6]=w.init,n[6]=w.move,i.effect_vanish=w.init,n.effect_vanish=w.move,w=new sce_effect_bomb,i[7]=w.init,n[7]=w.move,i.effect_bomb=w.init,n.effect_bomb=w.move,w=new sce_effect_bomb_x,i.effect_bomb_x=w.init,n.effect_bomb_x=w.move,o.effect_bomb_x=w.draw,w=new sce_effect_bombExp,i.effect_bombEx=w.init,n.effect_bombEx=w.move,o.effect_bombEx=w.draw,w=new sce_player_start,i[8]=w.init,n[8]=w.move,i.player_start=w.init,n.player_start=w.move,w=new sce_enemy_turn(-30),i[9]=w.init,n[9]=w.move,i.enemy_turn_r=w.init,n.enemy_turn_r=w.move,o.enemy_turn_r=w.draw,w=new sce_enemy_turn(30),i[10]=w.init,n[10]=w.move,i.enemy_turn_l=w.init,n.enemy_turn_l=w.move,w=new sce_enemy_change_s,i[11]=w.init,n[11]=w.move,i.enemy_change_s=w.init,n.enemy_change_s=w.move,w=new sce_common_vset(6),i[12]=w.init,n[12]=w.move,i.common_vset6=w.init,n.common_vset6=w.move,w=new sce_common_vset(16),i[13]=w.init,n[13]=w.move,i.common_vset16=w.init,n.common_vset16=w.move,w=new sce_en_bullet_homing,i[14]=w.init,n[14]=w.move,i.en_bullet_homing=w.init,n.en_bullet_homing=w.move,w=new sce_enemy_moveshot,i[15]=w.init,n[15]=w.move,i.enemy_moveshot_1=w.init,n.enemy_moveshot_1=w.move,o.enemy_moveshot_1=w.draw,w=new sce_friend_rotate,i[16]=w.init,n[16]=w.move,i.friend_rotate=w.init,n.friend_rotate=w.move,w=new sce_friend_start,i[17]=w.init,n[17]=w.move,i.friend_start=w.init,n.friend_start=w.move,w=new sce_en_bullet_random,i[18]=w.init,n[18]=w.move,i.en_bullet_random=w.init,n.en_bullet_random=w.move,w=new sce_enemy_randomshot,i[19]=w.init,n[19]=w.move,i.sce_enemy_randomshot=w.init,n.sce_enemy_randomshot=w.move,o.sce_enemy_randomshot=w.draw,w=new sce_pl_bullet_homing2,i[20]=w.init,n[20]=w.move,i.pl_bullet_homing=w.init,n.pl_bullet_homing=w.move,w=new sce_friend_sidearm,i[21]=w.init,n[21]=w.move,i.friend_sidearm=w.init,n.friend_sidearm=w.move,w=new sce_common_vset(0),i[22]=w.init,n[22]=w.move,i.common_vset0=w.init,n.common_vset0=w.move,w=new sce_boss_0,i[23]=w.init,n[23]=w.move,o[23]=w.draw,i.boss_0=w.init,n.boss_0=w.move,o.boss_0=w.draw,w=new sce_common_vset(2),i[24]=w.init,n[24]=w.move,i.common_vset2=w.init,n.common_vset2=w.move,w=new sce_common_vset(8),i[25]=w.init,n[25]=w.move,i.common_vset8=w.init,n.common_vset8=w.move,w=new sce_common_vset(10),i[26]=w.init,n[26]=w.move,i.common_vset10=w.init,n.common_vset10=w.move,w=new sce_effect_billboard(0),i[28]=w.init,n[28]=w.move,i.effect_billboard_v=w.init,n.effect_billboard_v=w.move,w=new sce_effect_billboard(90),i[29]=w.init,n[29]=w.move,i.effect_billboard_h=w.init,n.effect_billboard_h=w.move,w=new sce_item_direct_homing,i[30]=w.init,n[30]=w.move,i.item_direct_homing=w.init,n.item_direct_homing=w.move,w=new sce_en_bullet_accel,i[33]=w.init,n[33]=w.move,i.en_bullet_accel=w.init,n.en_bullet_accel=w.move,w=new sce_boss_1,i[34]=w.init,n[34]=w.move,o[34]=w.draw,i.boss_1=w.init,n.boss_1=w.move,o.boss_1=w.draw,w=new sce_item_near_homing,i[36]=w.init,n[36]=w.move,i.item_near_homing=w.init,n.item_near_homing=w.move,w=new sce_message_billboard(["= Welcome to BOSS ROOM ==","LAIR OF THE BOSS ENEMY!","THE BOSS IS *IN*!",""],3),i[37]=w.init,n[37]=w.move,o[37]=w.draw,i.message_billboard_wm=w.init,n.message_billboard_wm=w.move,o.message_billboard_wm=w.draw,w=new sce_item_movingstop,i[38]=w.init,n[38]=w.move,i.item_movingstop=w.init,n.item_movingstop=w.move,w=new sce_message_small(0),i[39]=w.init,n[39]=w.move,o[39]=w.draw,i.message_small_w=w.init,n.message_small_w=w.move,o.message_small_w=w.draw,w=new sce_message_small(1),i[42]=w.init,n[42]=w.move,o[42]=w.draw,i.message_small_r=w.init,n.message_small_r=w.move,o.message_small_r=w.draw,w=new sce_message_small(2),i[43]=w.init,n[43]=w.move,o[43]=w.draw,i.message_small_g=w.init,n.message_small_g=w.move,o.message_small_g=w.draw,w=new sce_message_small(3),i[44]=w.init,n[44]=w.move,o[44]=w.draw,i.message_small_b=w.init,n.message_small_b=w.move,o.message_small_b=w.draw,w=new sce_pl_bullet_subshot(8),i[40]=w.init,n[40]=w.move,i.pl_bullet_subshot_pl=w.init,n.pl_bullet_subshot_pl=w.move,w=new sce_pl_bullet_subshot(1),i[41]=w.init,n[41]=w.move,i.pl_bullet_subshot_op=w.init,n.pl_bullet_subshot_op=w.move,w=new sce_pl_bullet_subshot(0),i.pl_bullet_subshot_zero=w.init,n.pl_bullet_subshot_zero=w.move,w=new sce_pl_bullet_laser_head,i[45]=w.init,n[45]=w.move,i.pl_bullet_laser_head=w.init,n.pl_bullet_laser_head=w.move,w=new sce_pl_bullet_laser_tail,i[46]=w.init,n[46]=w.move,i.pl_bullet_laser_tail=w.init,n.pl_bullet_laser_tail=w.move,w=new sce_effect_bombcircle("rgba(255, 64, 64, 0.7)"),i[47]=w.init,n[47]=w.move,o[47]=w.draw,i.effect_bombcircle_r=w.init,n.effect_bombcircle_r=w.move,o.effect_bombcircle_r=w.draw,w=new sce_effect_bombcircle("rgba(255, 255, 255, 0.7)"),i[48]=w.init,n[48]=w.move,o[48]=w.draw,i.effect_bombcircle_w=w.init,n.effect_bombcircle_w=w.move,o.effect_bombcircle_w=w.draw,w=new sce_en_bullet_hominglaser,i[49]=w.init,n[49]=w.move,i.en_bullet_hominglaser=w.init,n.en_bullet_hominglaser=w.move,w=new sce_boss_2,i[50]=w.init,n[50]=w.move,o[50]=w.draw,i.boss_2=w.init,n.boss_2=w.move,o.boss_2=w.draw,w=new sce_en_bullet_infolaser,i[51]=w.init,n[51]=w.move,o[51]=w.draw,i.en_bullet_infolaser=w.init,n.en_bullet_infolaser=w.move,o.en_bullet_infolaser=w.draw,w=new sce_en_bullet_turn,i[52]=w.init,n[52]=w.move,i.en_bullet_turn=w.init,n.en_bullet_turn=w.move,w=new sce_message_billboard(["Event Message Test","= Operation Manual. =","= Z/(X) Attack/Collect =","= X/(B) Use Item       =","= C/(A) Jump           =","========================","= ESC/START Pause/Quit ="],0),i[53]=w.init,n[53]=w.move,o[53]=w.draw,i.message_billboard_cp=w.init,n.message_billboard_cp=w.move,o.message_billboard_cp=w.draw,w=new sce_common_signal(835),i[54]=w.init,n[54]=w.move,i.common_signal_result=w.init,n.common_signal_result=w.move,w=new sce_effect_warnning_mark,i[55]=w.init,n[55]=w.move,i.effect_warnning_mark=w.init,n.effect_warnning_mark=w.move,w=new sce_en_bullet_laser_tail,i[56]=w.init,n[56]=w.move,i.en_bullet_laser_tail=w.init,n.en_bullet_laser_tail=w.move,w=new sce_message_normal(60),i[57]=w.init,n[57]=w.move,o[57]=w.draw,i.message_normal_60=w.init,n.message_normal_60=w.move,o.message_normal_60=w.draw,w=new sce_message_bosstriger,i[58]=w.init,n[58]=w.move,i.message_bosstriger=w.init,n.message_bosstriger=w.move,w=new sce_effect_hit,i.effect_hit=w.init,n.effect_hit=w.move,w=new sce_effect_hit_shield,i.effect_hit_shield=w.init,n.effect_hit_shield=w.move,o.effect_hit_shield=w.draw,w=new sce_enemy_move_std,i.enemy_move_std=w.init,n.enemy_move_std=w.move,w=new sce_enemy_move_std2(20,240),i.enemy_move_std2=w.init,n.enemy_move_std2=w.move,o.enemy_move_std2=w.draw,w=new sce_enemy_move_gen_grow,i.enemy_move_gen_grow=w.init,n.enemy_move_gen_grow=w.move,w=new sce_enemy_generator(120,5,"enemy_move_std2",300),i.enemy_generator=w.init,n.enemy_generator=w.move,o.enemy_generator=w.draw,w=new sce_enemy_trbox,i.enemy_trbox=w.init,n.enemy_trbox=w.move,w=new sce_enemy_trbox_mimic,i.enemy_mimic=w.init,n.enemy_mimic=w.move,w=new sce_enemy_timeover,i.enemy_timeover=w.init,n.enemy_timeover=w.move,o.enemy_timeover=w.draw,w=new sce_enemy_move_std2(1,1240),i.enemy_move_vst=w.init,n.enemy_move_vst=w.move,o.enemy_move_vst=w.draw,w=new sce_enemy_generator(0,50,"enemy_move_vst",1280),i.enemy_generator_vst=w.init,n.enemy_generator_vst=w.move,o.enemy_generator_vst=w.draw,w=new sce_friend_straight,i.friend_straight=w.init,n.friend_straight=w.move,w=new sce_friend_boom,i.friend_boom=w.init,n.friend_boom=w.move,w=new sce_friend_rotate_full,i.friend_rotate_full=w.init,n.friend_rotate_full=w.move,w=new sce_friend_front,i.friend_front=w.init,n.friend_front=w.move,w=new sce_effect_informationCursor,i.effect_informationCursor=w.init,n.effect_informationCursor=w.move,o.effect_informationCursor=w.draw,w=new sce_friend_option(0),i.sce_friend_option_0=w.init,n.sce_friend_option_0=w.move,o.sce_friend_option_0=w.draw,w=new sce_friend_option(1),i.sce_friend_option_1=w.init,n.sce_friend_option_1=w.move,o.sce_friend_option_1=w.draw,w=new sce_friend_option(2),i.sce_friend_option_2=w.init,n.sce_friend_option_2=w.move,o.sce_friend_option_2=w.draw,w=new sce_friend_option(3),i.sce_friend_option_3=w.init,n.sce_friend_option_3=w.move,o.sce_friend_option_3=w.draw,w=new sce_pl_bullet_rotate_circle,i.pl_bullet_rotate_circle=w.init,n.pl_bullet_rotate_circle=w.move,w=new sce_exev_3way,i[100]=w.init,n[100]=w.move,i.exev_3way=w.init,n.exev_3way=w.move,w=new sce_exev_5way_nallow,i[102]=w.init,n[102]=w.move,i.exev_5way_nallow=w.init,n.exev_5way_nallow=w.move,w=new sce_exev_5way_normal,i[103]=w.init,n[103]=w.move,i.exev_5way_normal=w.init,n.exev_5way_normal=w.move,w=new sce_exev_5expansion,i[104]=w.init,n[104]=w.move,i.exev_5expansion=w.init,n.exev_5expansion=w.move,w=new sce_exev_3way_exp,i[104]=w.init,n[104]=w.move,i.exev_3way_exp=w.init,n.exev_3way_exp=w.move,w=new sce_message_signal("warning"),i.signal_warning=w.init,n.signal_warning=w.move,e.init=i,e.draw=o,e.move=n,e}function sceneConfig(t){let e,o=t.System.dev,n=o.graphics[3],s=o.graphics[0],a=o.graphics[2];o.key_state;this.init=function(){t.Config.reset(),t.Config.load(),f[0]=t.Config.lamp_use,f[1]=t.Config.map_use,f[2]=t.Config.itemreset,f[3]=t.Config.shotfree,f[4]=!1,f[5]=!1,f[6]=t.Config.debug,f[7]=t.Config.bulletmode,_[4]=0,_[5]=t.Config.startstage},this.reset=function(){o.graphics[0].setInterval(0),o.graphics[1].setInterval(0),o.graphics[2].setInterval(0);for(let t in x)x[t].sel=!1,x[t].lamp=!1;for(i in l=!1,c=0,cur_cnt=0,s.setBackgroundcolor("navy"),s.reset(),s.clear("navy"),_)Boolean(_[i])&&(p[i]=_[i]);for(let t=0;t<M.length;t++)0==M[t]?C[t].set(f[t]):C[t].set(_[t]);e=!0,g=0,e=10},this.step=function(i,n){r=[];let l=n.trigger.weapon,c=!1,m=!1;const v=n;e||(v.left&&(c=!0,u=10),v.right&&(m=!0,u=10),v.up&&(g--,g<3*k.length&&(g--,g--),g<0&&(g=x.length-1),e=!0,u=10,a.reset(),a.clear(),a.draw()),v.down&&(g++,g<3*k.length&&(g++,g++),g>x.length-1&&(g=0),e=!0,u=10,a.reset(),a.clear(),a.draw()),e&&o.sound.effect(9));if((l||c||m)&&!e){for(let t in x)if(x[t].click=!1,x[t].select){x[t].click=!0;let e=x[t].func();if(0!=e)return s.setBackgroundcolor("black"),e}}else for(let t in _)Boolean(_[t])&&(p[t]=_[t]);u>0&&u--;l||0!=u||(e=!1);let d=-1,b=g;g<3*k.length&&(b=3*Math.floor(g/3));for(let t in x)t==b?(x[t].select=!0,d=t):x[t].select=!1;if((c||m)&&!e&&g<3*k.length){let t=g;c&&(t+=1),m&&(t+=2),x[t].select=!0}r.push("== Configration =="),r.push("-----------------%");for(let t in C)f[t]=C[t].result(),1==M[t]&&(_[t]=f[t]);t.Config.lamp_use=f[0],t.Config.map_use=f[1],t.Config.itemreset=f[2],t.Config.shotfree=f[3],t.Config.debug=f[6],t.Config.bulletmode=f[7],Boolean(h)||(h=_[4]);h!=_[4]&&(_[4]>=0&&_[4]<18&&(o.sound.change(Math.floor(_[4])),o.sound.play(0)),h=_[4]);if(t.Config.startstage=_[5],w){t.Config.reset(),f[0]=t.Config.lamp_use,f[1]=t.Config.map_use,f[2]=t.Config.itemreset,f[3]=t.Config.shotfree,f[4]=!1,f[5]=!1,f[6]=t.Config.debug,f[7]=t.Config.bulletmode,_[4]=0,_[5]=t.Config.startstage,a.clear(),a.kprint("設定初期化しました。",100,280),Boolean(localStorage)?(localStorage.clear(),a.kprint("ローカルストレージクリア。",100,300)):a.kprint("ローカルストレージが使用できない?",100,300),a.draw();for(let t=0;t<M.length;t++)0==M[t]?C[t].set(f[t]):C[t].set(_[t]);w=!1}y&&(a.clear(),0==t.Config.save()?a.kprint("設定をセーブしました。",100,280):a.kprint("ローカルストレージが使用できない?",100,280),a.draw(),y=!1);return 0},this.draw=function(){for(let t in r)n.kprint(r[t],0,60+16*t);for(let t in x)x[t].lamp&&n.fill(x[t].x,x[t].y,x[t].w,x[t].h,"orange"),x[t].select?(x[t].lamp||n.fill(x[t].x-10,x[t].y-1,x[t].w,8,"blue"),n.kprint(x[t].title,x[t].x-4,x[t].y-1)):n.kprint(x[t].title,x[t].x,x[t].y)},this.reset_enable=!0,this.score=0,this.config=t.Config;let r,l,c,h,u=0,f=[],_=[],p=[],y=!1,w=!1,g=0;function v(){this.title="button",this.x=0,this.y=0,this.w=100,this.h=16,this.select=!1,this.click=!1,this.setup=function(t,e,i,o,n){this.title=t,this.x=e,this.y=i,this.w=o,this.h=n,this.select=!1,this.click=!1,this.lamp=!1},this.status_reset=function(){this.select=!1,this.click=!1},this.func=function(){return 0}}function d(){let t,i,o,n,s=[];this.button=s,this.setup=function(e,a,r,l,c,h,u){t=e,i=r,o=h,n=u,m=new v,m.setup(a,l,c,120,16),m.msg=r,x.push(m),s.push(m);for(let t=0;t<2;t++)m=new v,m.setup(0==t?" Enable":" Disable",l+160+80*t,c,80,16),m.msg=r+(0==t?"有効":"無効"),m.sw=0==t,m.num=e,x.push(m),s.push(m)},this.set=function(e){t=e},this.result=function(){if(s[0].select||s[1].select||s[2].select){s[1].click&&(t=!0,e=!0,s[1].click=!1),s[2].click&&(t=!1,e=!0,s[2].click=!1);let r=s[1].select||s[2].select?"-":t?"有効":"無効";a.reset(),a.clear(),a.kprint(i+r,o,n),a.draw()}return t?(s[1].lamp=!0,s[2].lamp=!1):(s[1].lamp=!1,s[2].lamp=!0),t}}function b(){let t,i,o,n,s,r=[];this.button=r,this.setup=function(e,a,l,c,h,u,f){t=e,s=a,i=l,o=u,n=f,m=new v,m.setup(a,c,h,120,16),m.msg=l,x.push(m),r.push(m);for(let t=0;t<2;t++)m=new v,m.setup(0==t?"  -1":"  +1",c+160+80*t,h,80,16),m.msg=l,m.sw=0==t?-1:1,m.num=e,x.push(m),r.push(m)},this.set=function(e){t=e,r[0].title=s+t},this.result=function(){return(r[0].select||r[1].select||r[2].select)&&(r[1].click&&(t+=r[1].sw,r[1].click=!1,e=!0,r[1].lamp=!0,r[2].lamp=!1),r[2].click&&(t+=r[2].sw,r[2].click=!1,e=!0,r[1].lamp=!1,r[2].lamp=!0),t<0&&(t=0),r[0].title=s+t,a.reset(),a.clear(),a.kprint(i+t,o,n),a.draw()),t}}let x=[],k=["LampUse.","MapUse.","ItemReset.","ShotFree.","SoundTest.","StartStage.","DebugStatus","BulletErace"],S=["面の開始からランプを所持する:","面の開始から地図を所持する:","死んだときにアイテム放出する:","弾を消費しない。:","サウンドテスト : ","開始面 : ","デバッグステータス表示:","画面外からの弾を消す:"],M=[0,0,0,0,1,1,0,0];_[5]=1;let C=[],B=108;for(let t=0;t<k.length;t++){let e;0==M[t]?(e=new d,e.setup(t,k[t],S[t],60,B+20*t,20,B+20*t+8)):(e=new b,e.setup(t,k[t],S[t],60,B+20*t,60,B+20*t+8)),C.push(e)}function v(){this.title="button",this.x=0,this.y=0,this.w=100,this.h=16,this.select=!1,this.click=!1,this.setup=function(t,e,i,o,n){this.title=t,this.x=e,this.y=i,this.w=o,this.h=n,this.select=!1,this.lamp=!1,this.click=!1},this.status_reset=function(){this.select=!1,this.click=!1},this.func=function(){return 0}}m=new v,m.setup("Save.",100,320,120,16),m.msg="Save.",m.func=function(){return y=!0,e=!0,0},x.push(m),m=new v,m.setup("Reset.",100,340,120,16),m.msg="Reset.",m.func=function(){return w=!0,e=!0,0},x.push(m),m=new v,m.setup("Exit.",100,360,120,16),m.msg="Exit.",m.jp=2,m.func=function(){return this.jp},x.push(m)}function sceneControl(t){let e,i=t.System.dev.graphics[4],o=[],n=[];n[1]=new gameScene(t),o[1]="Main",n[2]=new sceneTitle(t),o[2]="Title",n[3]=new sceneGover(t),o[3]="Gover",n[4]=new sceneConfig(t),o[4]="Config",n[5]=new sceneResult(t),o[5]="Result",n[6]=new scenePause(t),o[6]="Pause",n[7]=new sceneStatusDisp(t),o[7]="Status",n[8]=new sceneOption(t),o[8]="Option",n[9]=new sceneLvUp(t),o[9]="LvUp";for(let t in n)n[t].init();let s=2,a=s;this.step=function(o,r){if(0!=s){let t=!1;s>=10&&(s%=10,t=!0,e=i.cw/2),2==a&&1==s&&(e=i.cw/2),a=s,n[a].reset_enable&&(2==a&&function(){for(let t in n)n[t].reset_enable=!0}(),n[a].reset(t))}s=n[a].step(o,r),e=e>0?e-180/(1e3/t.System.deltaTime()):0},this.draw=function(){if(e>0&&function(t){let e=i.cw,o=i.ch,n="black";i.fill(0,0,e,o/2-t,n),i.fill(0,o/2+t,e,o/2-t,n),i.fill(0,0,e/2-t,o,n),i.fill(e/2+t,0,e/2-t,o,n)}(i.cw/2-e),n[a].draw(),t.Config.debug&&t.System.blink()){let t=o[a];bar={},bar.x=i.cw-8*t.length,bar.y=0,bar.l=8*t.length,bar.draw=function(t){t.beginPath(),t.fillStyle="black",t.lineWidth=1,t.fillRect(this.x,this.y,8*this.l,8)},i.putFunc(bar),i.putchr8(t,i.cw-8*t.length,0)}}}function sceneGover(t){let e,o=t.System.dev,n=o.graphics[3],s=o.graphics[2];o.mouse_state,o.key_state;this.init=function(){},this.reset=function(){for(let t in u)u[t].sel=!1;r=!0,l=2,c=0;let i={};i.cw=s.cw,i.ch=s.ch,i.draw=function(t){for(let e=0;e<this.ch;e+=4)t.beginPath(),t.lineWidth=1,t.moveTo(0,e),t.lineTo(this.cw,e),t.strokeStyle="black",t.stroke()},o.graphics[0].setInterval(0),o.graphics[1].setInterval(0),s.setInterval(0),s.putFunc(i),s.draw(),t.Game.cold=!0,e=!0,m=30,h=0},this.step=function(n,f){a=[];let _=f.keycode,p=f.trigger.weapon,y=f.trigger.useitem,w=f.trigger.jump;e||(Boolean(_[38])&&_[38]&&(h--,h<0&&(h=u.length-1),e=!0,m=10),_[40]&&_[40]&&(h++,h>u.length-1&&(h=0),e=!0,m=10),p=p||y||w,e&&o.sound.effect(9));if(p&&!e)for(let t in u)if(u[t].sel){let e=u[t].func();if(0!=e)return c=e,e}m>0&&m--;p||0!=m||(e=!1);if(r){let e={};e.cw=s.cw,e.ch=s.ch,e.y1=l+1,e.y2=s.ch-l-2,e.draw=function(t){t.strokeStyle="black",t.beginPath(),t.lineWidth=8,t.moveTo(0,this.y1),t.lineTo(this.cw,this.y1),t.stroke(),t.beginPath(),t.lineWidth=8,t.moveTo(0,this.y2),t.lineTo(this.cw,this.y2),t.stroke()},s.putFunc(e),s.draw(),s.reset(),l+=60/(1e3/t.System.deltaTime())*3,l>s.ch/3&&(r=!1)}for(i in u)i==h?u[i].sel=!0:u[i].sel=!1;return a.push("== Game Over =="),a.push("---------------"),0},this.draw=function(){for(let t in u){if(u[t].sel){let e={};e.x=u[t].x,e.y=u[t].y,e.w=u[t].w,e.h=u[t].h,e.c="orange",e.draw=function(t){t.beginPath(),t.fillStyle=this.c,t.fillRect(this.x,this.y,this.w,this.h)},n.putFunc(e)}n.putchr(u[t].title,u[t].x,u[t].y)}for(let t in a){let e={x:248};e.y=132+16*t,e.w=12*a[i].length,e.h=16,e.draw=function(t){t.beginPath(),t.fillStyle="navy",t.fillRect(this.x,this.y,this.w,this.h)},n.putFunc(e),n.putchr(a[t],248,132+16*t)}},this.reset_enable=!0;let a,r,l,c,h,m=0,u=[],f={};f={},f.title="End.",f.x=270,f.y=200,f.w=120,f.h=16,f.sel=!1,f.func=function(){return 2},u.push(f)}function sceneLvUp(t){let e,i,o,n,s,a,r=t.System.dev,l=r.graphics[3],c=r.graphics[2];r.key_state;function h(t){let e=t,i=[];this.setStatusArray=function(t){i=t},this.step=function(t){let i=0;for(let o in e){let n=e[o];Boolean(t[n.keynum])?(e[o].keyon=!!t[n.keynum],e[o].keyon&&i++):e[o].keyon=!1}return i},this.exec=function(){for(let t in e){let i=e[t];i.keyon&&(i.func.call(i.func.p),e[t].text[1]="GET_STAT",e[t].select=!0,a.param(i.curpos))}},this.effect=function(){for(let t in e)e[t].keyon&&e[t].h>0&&e[t].h--},this.draw=function(t,o,n){for(let s in e){let a=e[s],r={x:o+a.x,y:n+a.y,w:a.w,h:a.h};r.draw=function(t){t.beginPath(),t.fillStyle=a.select?"orange":a.keyon?"steelblue":"blue",t.fillRect(this.x,this.y,this.w,this.h),a.select||(t.strokeStyle="White",t.strokeRect(this.x,this.y,this.w,this.h))},t.putFunc(r);for(let e in a.text)t.putchr8(a.text[e],o+a.x+2,n+a.y+20+8*e);if(t.put(a.icon,o+a.x+10,n+a.y+10),Boolean(i[s]))for(let e=0;e<i[s];e++)t.fill(o+a.x+20+4*e,n+a.y+10,3,6,a.barcolor)}}}function m(){let e=0,i=[0,1,0,-1],o=[-1,0,1,0],n=[0,90,180,270];this.param=function(t){e=t},this.draw=function(s,a,r,l){for(let c in i){let h=Math.trunc(t.System.time()/100)%5;0!=(e&Math.pow(2,c))&&s.put("cursorx",a+i[c]*(l+h),r+o[c]*(l+h),0,n[c])}}}this.init=function(){a=new m},this.reset=function(){o=0,c.clear();let i={};i.cw=c.cw,i.ch=c.ch,i.draw=function(t){for(let e=0;e<this.ch;e+=4)t.beginPath(),t.lineWidth=1,t.moveTo(0,e),t.lineTo(this.cw,e),t.strokeStyle="darkblue",t.stroke()},r.graphics[0].setInterval(0),r.graphics[1].setInterval(0),c.setInterval(0),c.putFunc(i),c.draw();let l=[{keynum:38,text:["0.5s Ext.",5+.5*t.Game.player.base.VIT+"s->"+(5+.5*(t.Game.player.base.VIT+1))+"s"],icon:"BallS1",barcolor:"cyan",func:{call:function(e){t.Game.player.base.VIT++,o=e},p:1},x:-35,y:-80,w:70,h:50,keyon:!1,select:!1,curpos:1},{keynum:37,text:[" Heal+1"," "+(3+t.Game.player.base.MND)+" -> "+(3+t.Game.player.base.MND+1)],icon:"BallL1",barcolor:"limegreen",func:{call:function(e){t.Game.player.base.MND++,o=e},p:1},x:-115,y:-25,w:70,h:50,keyon:!1,select:!1,curpos:8},{keynum:39,text:["Damage+2"," "+(10+2*t.Game.player.base.INT)+"-> "+(10+2*(t.Game.player.base.INT+1))],icon:"BallB1",barcolor:"orangered",func:{call:function(e){t.Game.player.base.INT++,o=e},p:1},x:45,y:-25,w:70,h:50,keyon:!1,select:!1,curpos:2}];n=new h(l),s=!1,e=!1,a.param(11)},this.step=function(a,l){i=[];let h=l.keycode,m=!1;Boolean(h[90])&&h[90]&&(m=!0);let u=!1;Boolean(h[88])&&h[88]&&(u=!0);let f=!1;Boolean(h[67])&&h[67]&&(f=!0);let _=!1;Boolean(h[27])&&h[27]&&(_=!0);m=m||u||f;let p=l;p.up&&(h[38]=!0);p.down&&(h[40]=!0);p.left&&(h[37]=!0);p.right&&(h[39]=!0);0==n.step(h)&&(e=!0);c.draw(),c.reset(),i.push("LevelUp#"+t.Game.player.spec.ETC),i.push("= SELECT ="),n.setStatusArray([t.Game.player.base.VIT,t.Game.player.base.MND,t.Game.player.base.INT]),e&&!s&&1==n.step(h)&&(n.exec(),e=!1,s=!0);0!=o&&n.effect();if(0==n.step(h)&&0!=o)return r.graphics[0].setInterval(1),r.graphics[1].setInterval(1),c.setInterval(1),t.obCtrl.keyitem_enhance_check(),o;return 0},this.draw=function(){let e=t.obCtrl.player_objv(l);l.fill(e.x-120,e.y-100,240,200,0),t.obCtrl.player_objv(l),n.draw(l,e.x,e.y);for(let t in i)l.putchr8(i[t],e.x-35,e.y+16*t+32);a.draw(l,e.x,e.y,32)},this.reset_enable=!0}function sceneOption(t){let e=t.System.dev,i=e.graphics[3];this.init=function(){},this.reset=function(){e.graphics[0].setInterval(0),e.graphics[1].setInterval(0),e.graphics[2].setInterval(0),i.setInterval(0),a=0,l=t.Game.nowstage,n=6,s=!1},this.step=function(c,h){if(o--,o>0)return 0;let m=h.keycode,u=!1;Boolean(m[90])&&m[90]&&(u=!0);Boolean(m[32])&&m[32]&&(u=!0);let f=!1;Boolean(m[67])&&m[67]&&(f=!0);let _=!1;Boolean(m[86])&&m[86]&&(_=!0);let p=!1;Boolean(m[73])&&m[73]&&(p=!0);let y=!1;Boolean(m[69])&&m[69]&&(y=!0);let w=!1;Boolean(m[82])&&m[82]&&(w=!0);let g=!1,v=!1;for(let t in m)Boolean(m[t])&&(g=t>=48&&t<=57,v=t>=37&&t<=40);(u||f||p||y||w||_||g||v)&&(o=8);if(u)return i.reset(),i.clear(),i.draw(),s&&(e.graphics[0].setInterval(1),e.graphics[1].setInterval(1),e.graphics[2].setInterval(1)),n;if(f)for(let t=0;t<3;t++)e.graphics[t].reset(),e.graphics[t].clear(),e.graphics[t].draw();p&&(r=!r);if(v){let e=a;for(let t in m)Boolean(m[t])&&(e=e+(38==t?-1:0)+(40==t?1:0));e<0&&(e=0),a=e,e=l;for(let t in m)Boolean(m[t])&&(e=e+(37==t?-1:0)+(39==t?1:0));s=!0,n=2,e<0&&(e=0),l=e,t.mapsc.change(e)}let d="";for(let t in m)m[t]&&(d=d+"["+t+"]");i.reset(),i.clear();let b=[];b.push("INPUT KEY:"+d),b.push("=== COMMAND ==="),b.push("Z: "+(s?"RETURN TITLE":"EXIT")),b.push("C: CLEAR_SCREEN"),b.push("I: MAP_IMPORT（"+(p?"?":"未実装")+"）");for(let t in b)i.kprint(b[t],0,0+8*t);(function(){mcp=t.mapsc.mapChip();let e=["dimgray","steelblue","orange"];for(let t=0,o=mcp.length;t<o;t++){let o=mcp[t];o.visible&&i.fill(150+o.x/8,o.y/8,o.w/8-1,o.h/8-1,e[o.type-10])}})(),function(e){const o={0:"Mayura1",1:"Unyuu1",14:"Unyuu3",15:"Wand",16:"Knife",17:"Axe",18:"Spear",19:"Boom",20:"Ball1",21:"miniMay",22:"Key",23:"BallB1",24:"BallS1",25:"BallL1",26:"Lamp",27:"Map",34:"Unyuu2",35:"Coin1",40:"TrBox",50:"Bow",51:"AmuletR",52:"AmuletG",53:"AmuletB",54:"CandleR",55:"CandleB",56:"RingR",57:"RingB",58:"Mirror"};let n=t.mapsc.ini_sc();for(let t in n){let s=n[t],a=""+s.ch;Boolean(o[s.ch])&&(a=o[s.ch]);let r=t>39?540:16,l=t>39?8*(t-40):8*t+64,c="  :"+s.sc,h=.5;t==e&&(c="  :[SELECT]",h=1),i.put(a,r,l,0,0,255,h),i.kprint(c,r,l),i.put(a,150+Math.floor(s.x/8),Math.floor(s.y/8),0,0,255,h)}}(a),r&&function(){let e=t.mapsc.cmap();for(let t in e)for(let o in e[t])i.fill(162+4*t,12+4*o,3,3,e[t][o]?"blue":"darkblue")}();return i.kprint("Stage:"+t.mapsc.chacheUseStatus(),150,0),i.kprint("Stage:"+l,150,8),i.draw(),0},this.draw=function(){},this.reset_enable=!0;let o=10,n=6,s=!1,a=0,r=!1,l=t.Game.nowstage}function scenePause(t){let e=t.System.dev,i=e.graphics[3];this.init=function(){tsel=0},this.reset=function(){e.graphics[0].setInterval(0),e.graphics[1].setInterval(0),e.graphics[2].setInterval(0),s=0,i.putchr(" == PAUSE ==",270,l),i.putchr("Push <Z>key or [Space] ",220,180),i.putchr8("   Return game.",270,200),i.kprint("　　　ゲームに戻る",270,210),i.putchr("Push <Q>key /",220,220),i.putchr8(" Save and Quit.",270,240),i.kprint("セーブしてタイトルに戻る",270,250);let n={load:!0,ready:!0,data:t.Game,title:"STAT/INV"};if(n.data.stage=t.mapsc.stage,n.load){let e=t.Game.dataview2(n);for(let t in e)i.kprint(e[t],8,8*t+8)}t.obCtrl.keyitem_view_draw(i),i.draw(),o=!1,t.Game.cold=!0},this.step=function(c,h){if(n--,n>0)return 0;let m=h.keycode,u=!!h.trigger.weapon,f=!1,_=!!(h.up||h.down||h.left||h.right);for(let t in m)Boolean(m[t])&&(f=t>=48&&t<=57);if(h.quit){if(0==t.Game.save())return e.sound.volume(1),e.sound.change(9),e.sound.play(),2;alert("ローカルストレージが使えません。\n中断セーブ出来なかったので、\nゲーム継続します。"),u=!0}if(u)return e.sound.volume(1),i.fill(220,l,288,100),i.draw(),e.graphics[0].setInterval(1),e.graphics[1].setInterval(1),e.graphics[2].setInterval(1),1;if(_){let t=a;for(let e in m)Boolean(m[e])&&(t=t+(h.up?-1:0)+(h.down?1:0));t<0&&(t=0),a=t}let p=-1;if(f){for(let t in m)if(Boolean(m[t])){p=t-48;break}switch(s=0,p){case 1:t.Config.debug=!t.Config.debug;break;case 2:t.Config.lamp_use=!t.Config.lamp_use;break;case 3:t.Config.map_use=!t.Config.map_use;break;case 4:break;case 5:t.Config.bulletmode=!t.Config.bulletmode;break;case 6:t.Game.player.level=t.Game.player.level++>=3?0:t.Game.player.level;break;case 7:s=8;break;case 8:s=7;break;case 9:t.Config.viewlog=!t.Config.viewlog;break;case 0:o=!o;break;default:break}}if(f||_){if(i.reset(),i.fill(0,264,400,30),i.fill(0,240,176,88),Boolean(r[a]))for(let t in r[a])i.kprint(a+"."+t+":"+r[a][t],0,264+10*t);else i.kprint(a+".: Message Empty.",0,264);if(o){let e=[];i.fill(0,240,176,88,"navy"),i.putchr8("Input ["+p+"]",16,240),e.push("1: Debug Display  :"+(t.Config.debug?"ON":"OFF")),e.push("2: Lamp(nextStage):"+(t.Config.lamp_use?"ON":"OFF")),e.push("3: Map (nextStage):"+(t.Config.map_use?"ON":"OFF")),e.push("4: -"),e.push("5: Bullet(inRange):"+(t.Config.bulletmode?"ON":"OFF")),e.push("6: Weapon Level   :+"+t.Game.player.level),e.push("7: Map Option Menu:->"),e.push("8: Obj Status Disp:->"),e.push("9: (Debug)Log View:"+(t.Config.viewlog?"ON":"OFF")),e.push("0: Menu Display   :"+(o?"ON":"OFF"));for(let t in e)i.putchr8(e[t],0,248+8*t);let n={load:!0,ready:!0,data:t.Game,title:"STAT/INV"};if(n.load){let e=t.Game.dataview2(n);for(let t in e)i.kprint(e[t],8,8*t+8);i.draw()}}i.draw(),n=10}return s},this.draw=function(){},this.reset_enable=!0;let o=!1,n=10,s=0,a=0;const r=tutorialCommentTable(),l=160}function sceneResult(t){let e,o,n,s,a,r=t.System.dev,l=r.graphics[3],c=r.graphics[2];r.key_state;this.init=function(){},this.reset=function(){for(let t in _)_[t].sel=!1;n=!0,s=2,a=0;let e={};e.cw=c.cw,e.ch=c.ch,e.draw=function(t){for(let e=0;e<this.ch;e+=4)t.beginPath(),t.lineWidth=1,t.moveTo(0,e),t.lineTo(this.cw,e),t.strokeStyle="darkblue",t.stroke()},r.graphics[0].setInterval(0),r.graphics[1].setInterval(0),c.setInterval(0),c.putFunc(e),c.draw();let i=[{keynum:38,text:"up",icon:"Mayura1",func:p,x:240,y:200,w:120,h:50,keyon:!1},{keynum:40,text:"down",icon:"Map",func:p,x:240,y:326,w:120,h:50,keyon:!1},{keynum:37,text:"left",icon:"BallB1",func:p,x:90,y:255,w:120,h:50,keyon:!1},{keynum:39,text:"right",icon:"TrBox",func:p,x:390,y:255,w:120,h:50,keyon:!1}];for(let t in i){let e=i[t],o=Math.floor(Math.random()*w.length);e.text=w[o].text,e.icon=w[o].sp,e.func={call:y,p:w[o].ch}}h=new b(i),m=!1,u=!1,g=mapsc.stage,v=g+1,d=!1;let o=function(){let e=[];for(let i=0;i<=7;i++)e[i]=t.obCtrl.item[51+i],Boolean(e[i])?e[i]=e[i]>0:e[i]=!1;return{Amulet:{R:e[0],G:e[1],B:e[2]},Ring:{R:e[5],B:e[6]},Mirror:e[7]}}();g%15==9&&(o.Ring.R||o.Ring.B?d=!1:(mapsc.stage=6,v=mapsc.stage+1,d=!0));g%15==14&&(o.Amulet.R||o.Amulet.G||o.Amulet.B?o.Mirror?d=!1:(mapsc.stage=12,v=mapsc.stage+1,d=!0):o.Mirror?(mapsc.stage=2,v=mapsc.stage+1,d=!0):(mapsc.stage=-1,v=mapsc.stage+1,d=!0))},this.step=function(l,p){o=[];let y=p.keycode,w=!1;Boolean(y[90])&&y[90]&&(w=!0);let b=!1;Boolean(y[88])&&y[88]&&(b=!0);let x=!1;Boolean(y[67])&&y[67]&&(x=!0);let k=!1;Boolean(y[27])&&y[27]&&(k=!0);w=!!(w||b||x);let S=p;S.up&&(y[38]=!0);S.down&&(y[40]=!0);S.left&&(y[37]=!0);S.right&&(y[39]=!0);if(f++,f>30){if(!r.sound.running()){if(w&&!e)for(let t in _)if(_[t].sel){let e=_[t].func();0!=e&&(m||(h.exec(),m=!0),a=e)}u||t.Game.nowstage%15!=0||(r.sound.effect(15),t.obCtrl.keyitem_reset(),u=!0)}k&&(f=0,a=5)}w||(e=!1);r.sound.running()&&(e=!0);if(n){let e={};e.cw=c.cw,e.ch=c.ch,e.y1=s+1,e.y2=c.ch-s-2,e.draw=function(t){t.strokeStyle="black",t.beginPath(),t.lineWidth=8,t.moveTo(0,this.y1),t.lineTo(this.cw,this.y1),t.stroke(),t.beginPath(),t.lineWidth=8,t.moveTo(0,this.y2),t.lineTo(this.cw,this.y2),t.stroke()},c.putFunc(e),t.obCtrl.keyitem_view_draw(c),c.draw(),c.reset(),s+=60/(1e3/t.System.deltaTime())*3,s>c.ch/3&&(n=!1)}for(i in _)e||(_[i].sel=!0),0!=a&&(_[i].sel=!1);o.push(" == Stage -"+g+"- Clear =="),o.push(" "),g%15==0?o.push(" == CONGRATULATIONS!& =="):o.push((d?"   WARP! ":"   Goto ")+"Next Stage."+v);0!=a&&h.effect();return w||0!=h.step(y)?0:a},this.draw=function(){let e=t.obCtrl.player_objv(l);l.fill(e.x-16,e.y-16,32,32,0),t.obCtrl.player_objv(l);for(let e in _){if(_[e].sel){let i={};i.x=_[e].x,i.y=_[e].y,i.w=_[e].w,i.h=_[e].h;let o=Math.sin(Math.PI*(t.System.time()%1500/1500));i.c="rgb("+Math.trunc(255*o)+","+Math.trunc(165*o)+",0)",i.draw=function(t){t.beginPath(),t.fillStyle=this.c,t.fillRect(this.x,this.y,this.w,this.h)},l.putFunc(i)}l.putchr(_[e].title,_[e].x,_[e].y)}for(let t in o)l.putchr(o[t],170,120+16*t);h.draw(l)},this.reset_enable=!0;let h,m,u,f=0,_=[];_.push({title:"[   ok.  ]",x:240,y:280,w:120,h:16,sel:!1,func:function(){return 11}});const p=function(){},y=function(e){t.obCtrl.get_item(e)},w=[{ch:15,text:"杖",sp:"Wand"},{ch:16,text:"剣",sp:"Knife"},{ch:17,text:"斧",sp:"Axe"},{ch:18,text:"槍",sp:"Spear"},{ch:19,text:"ブーメラン",sp:"Boom"},{ch:23,text:"爆弾",sp:"BallB1"},{ch:24,text:"バリア玉",sp:"BallS1"},{ch:25,text:"回復玉",sp:"BallL1"},{ch:26,text:"ランプ",sp:"Lamp"},{ch:27,text:"地図",sp:"Map"},{ch:50,text:"弓矢",sp:"Bow"}];let g,v,d;function b(e){let i="White",o=e,n=new Array(e.length);n.fill(!1),this.step=function(t){let e=0;for(let i in o){let n=o[i];Boolean(t[n.keynum])?(o[i].keyon=!!t[n.keynum],o[i].keyon&&e++):o[i].keyon=!1}return e},this.exec=function(){for(let t in o){let e=o[t];e.keyon&&(e.func.call(e.func.p),o[t].text="GET "+e.text,n[t]=!0)}i="Navy"},this.effect=function(){for(let t in o)o[t].keyon},this.draw=function(e){for(let s in o){let a=o[s],r={x:a.x,y:a.y,w:a.w,h:a.h,c:n[s]?a.keyon?"darkorange":"Navy":a.keyon?"Blue":"Navy",draw:function(t){t.beginPath(),t.fillStyle=this.c,t.fillRect(this.x,this.y,this.w,this.h)}};e.putFunc(r);let l=Math.trunc(255*Math.sin(Math.PI*(t.System.time()%1500/1500))),c=n[s]?"rgb("+l+","+l+",0)":i;r={x:a.x,y:a.y,w:a.w,h:a.h,c:c},r.draw=function(t){t.beginPath(),t.strokeStyle=this.c,t.strokeRect(this.x,this.y,this.w,this.h)},e.putFunc(r),e.kprint(a.text,a.x+24,a.y+20),e.put(a.icon,a.x+10,a.y+10)}}}}function sceneStatusDisp(t){let e=t.System.dev,i=e.graphics[3];this.init=function(){s=0},this.reset=function(){e.graphics[0].setInterval(0),e.graphics[1].setInterval(0),e.graphics[2].setInterval(0),i.setInterval(0),ret_code=0,l(1)},this.step=function(r,c){if(n--,n>0)return 0;let h=c.keycode,m=!1;Boolean(h[90])&&h[90]&&(m=!0);Boolean(h[32])&&h[32]&&(m=!0);let u=!1;Boolean(h[67])&&h[67]&&(u=!0);let f=!1;Boolean(h[86])&&h[86]&&(f=!0);let _=!1,p=!1;for(let t in h)Boolean(h[t])&&(_=t>=48&&t<=57,p=t>=37&&t<=40);(m||u||f||_||p)&&(n=8);if(m)return i.reset(),i.clear(),i.draw(),6;if(u){for(let t=0;t<3;t++)e.graphics[t].reset(),e.graphics[t].clear(),e.graphics[t].draw();l(a,o)}f&&(o=!o,l(a,o));if(_){a=-1;for(let t in h)if(Boolean(h[t])){a=t-48;break}0==a?function(e){const o=49;let n=0;i.reset(),i.clear();let s="== ObjectNo.["+e+"] ==";i.putchr8(s,0,0);let a=t.obCtrl.lookObj(e);for(let t in a){let e=String(a[t]);if(e.includes("object")||e.includes("function")||(i.putchr8(String(a[t]).substring(0,39),320*Math.floor(n/o),n%o*8+8),n++),n>100)break}t.obCtrl.lookObjv(i,e,240,80),t.obCtrl.lookpick(i,e,320*Math.floor(n/o)+8,(n+2)%o*8+16)&&i.putchr8("pickitem/thisitem",320*Math.floor(n/o)+8,(n+1)%o*8+8);i.draw()}(s):l(a,o)}if(p){let t=s;for(let e in h)Boolean(h[e])&&(t=t+(37==e?-50:0)+(38==e?-1:0)+(39==e?50:0)+(40==e?1:0));t<0&&(t=0),s=t,l(a,o)}return 0},this.draw=function(){},this.reset_enable=!0;let o=!1,n=10,s=0,a=1,r=1;function l(e,o){e<1&&(e=1);let n=t.obCtrl.list();r=Math.floor(n.length/200)+1,e>r&&(e=r),s=200*(e-1)+s%200,s>n.length&&(s=n.length-1);let a="No:Type,view,hp,status,Mp,chr / Num:"+n.length+" PAGE:["+e+"]/"+r+":SELECT:["+s+"] ";a+=o?"Inventory":"Propaty";let l=0;i.reset(),i.clear(),i.putchr8(a,0,0);for(let a in n)if(a>=200*(e-1)){let r=n[200*(e-1)+a%200],c=160*Math.floor(l/50),h=l%50*8+8;if(o&&t.obCtrl.lookpick(i,a,c+48+8,h)&&(r=r.substring(0,6)),a!=s?i.putchr8(r,c,h):(bar={},bar.x=c,bar.y=h,bar.l=r.length,bar.draw=function(t){t.beginPath(),t.fillStyle="navy",t.lineWidth=1,t.fillRect(this.x,this.y,8*this.l,8),t.stroke(),t.beginPath(),t.strokeStyle="white",t.lineWidth=1,t.rect(this.x,this.y,8*this.l,8),t.stroke()},i.putFunc(bar),i.putchr8c(r,c,h,2)),l++,l>200)break}i.draw()}}function sceneTitle(t){let e,o=t.System.dev,n=o.graphics[3],s=o.graphics[0];o.key_state;this.init=function(){w=0},this.reset=function(){t.Config.load(),o.graphics[0].setInterval(0),o.graphics[1].setInterval(0),o.graphics[2].setInterval(0),o.graphics[3].setInterval(1),o.graphics[0].reset(),o.graphics[0].clear(),o.graphics[0].draw(),o.graphics[1].reset(),o.graphics[1].clear(),o.graphics[1].draw(),o.graphics[2].reset(),o.graphics[2].clear(),o.graphics[2].draw();for(let t in _)_[t].sel=!1;r=!1,l=0,cur_cnt=0,h=0,s.reset(),s.clear("black"),a=[],t.Config.use_audio?a.push("audio on:"+o.sound.loadCheck()):a.push("audio off:"+o.sound.loadCheck());const i=320,n=128;s.put("Mayura1",288,168),s.put("Unyuu1",288,200),s.put("Unyuu3",256,200),s.put("Key",286,232),s.putchr("Player",i,168),s.putchr("Enemy",i,200),s.putchr("Key",i,228),s.put("TitleLogo",i,n),s.kprint("土日ダンジョン　令和版",370,148);for(let t in a);s.draw(),0==t.Game.load()?(_[1].title="LoadGame",_[1].jp=11):(_[1].title="",_[1].jp=0);t.Game.cold=!0,e=!0,c=30,u=0,f={mode:0,x:0};let m=t.Game.preload();if(m.load){let e=t.Game.dataview2(m);for(let t in e)s.kprint(e[t],8,8*t+8);s.draw()}},this.step=function(n,l){s.draw(),a=[];let m=l.trigger.weapon;if(!e){const t=l;(t.up||t.down||t.left||t.right)&&(t.up&&(u--,u<0&&(u=_.length-1)),t.down&&(u++,u>_.length-1&&(u=0)),t.left&&(f.mode=0),t.right&&(f.mode=1,f.x+=2),e=!0,c=10),e&&o.sound.effect(9)}if(m&&!e)for(let e in _)if(_[e].sel){let i=_[e].func();0!=i&&(r=!0,t.Game.mode=f.mode,h=i)}c>0&&c--;m||0!=c||(e=!1);if(r)return h;for(i in _)i==u?_[i].sel=!0:_[i].sel=!1;return 0},this.draw=function(){for(let t in _)if(_[t].sel){let e={};e.x=_[t].x-6,e.y=_[t].y,e.w=_[t].w,e.h=_[t].h,e.draw=function(t){t.beginPath(),t.fillStyle="orange",t.fillRect(this.x,this.y,this.w,this.h)},n.putFunc(e),n.putchr(_[t].title,_[t].x-4,_[t].y-1)}else n.putchr(_[t].title,_[t].x-4,_[t].y-1);f.x>0?(1==f.mode?f.x<256?f.x+=6:f.x=256:f.x-=6,n.put("Unyuu3",f.x,168)):f.x=0;t.System.blink()&&n.putchr8("Press <z> key or [Space]key to",212,270)},this.reset_enable=!0;let a,r,l,c=0,h=0,u=0,f={};let _=[],p=["NewGame","LoadGame","Config"],y=[1,11,4];for(let t=0;t<p.length;t++)m={},m.title=p[t],m.x=270,m.y=260+20*t+32,m.w=120,m.h=16,m.jp=y[t],m.sel=!1,m.func=function(){return this.jp},_.push(m);let w=new Number(0)}function Screen(t,e){let i=t.screen[e];this.cw=i.cw,this.ch=i.ch;let o=["8x8white","8x8red","8x8green","8x8blue","stfont"],n=spdata();function s(i,n,s,a,r){t.font[o[a]]&&(t.font[o[a]].useScreen(e),t.font[o[a]].putchr(i,n,s,r))}this.view=i.view,this.flip=i.flip,this.setInterval=i.setInterval,this.setBackgroundcolor=i.setBackgroundcolor,this.getInterval=i.getIntarval,this.getBackgroundcolor=i.getBackgroundcolor,this.put=function(e,o,s,a,r,l,c){let h=n[e],m=t.asset.image[h.pict].img;if(Boolean(h))if(Boolean(a)||(a=0),Boolean(r)||(r=0),Boolean(l)||(l=255),Boolean(c)||(c=1),0==a&&0==r&&255==l){let t=o+-h.w/2*c,e=s+-h.h/2*c,n=h.w*c,a=h.h*c;i.putPattern(m,h,t,e,n,a)}else{h.w,h.h,h.w,h.h;let t=1,e=1;switch(a){case 0:break;case 1:t=-1;break;case 2:e=-1;break;case 3:t=-1,e=-1;break;default:break}i.buffer.spPut(m,h.x,h.y,h.w,h.h,-h.w/2*c,-h.h/2*c,h.w*c,h.h*c,e,0,0,t,o,s,l,r)}else i.buffer.fillText(e,o,s)},this.putchr=function(t,e,i,o){s(t,e,i,4,o)},this.putchr8=function(t,e,i){s(t,e,i,0)},this.putchr8c=function(t,e,i,o){s(t,e,i,o)},this.kprint=function(i,o,n){t.state.System.dev.kanji.useScreen(e),t.state.System.dev.kanji.print(i,o,n)},this.kputchr=function(i,o,n,s){t.state.System.dev.kanji.useScreen(e),t.state.System.dev.kanji.putchr(i,o,n,s)},this.putPattern=i.putPattern,this.print=i.print,this.putImage=i.putImage,this.putImage2=i.drawImgXYWH,this.putImageTransform=i.putImageTransform,this.transform=i.buffer.transform,this.putFunc=i.putFunc,this.clear=i.clear,this.fill=i.fill,this.reset=i.reset,this.reflash=i.reflash,this.draw=i.draw,this.count=i.count,this.max=i.max}function soundCntl(t){let e=!1,i=!1;this.mute=i,this.mastervolume=.5;let o=".mp3";"probably"==(new Audio).canPlayType("audio/ogg")&&(o=".ogg");let n=["00round_start","01main","02warnning","03hurry_up","04round_clear","05miss","06gameover","07swing","08bow","09select","10use","11hit","12damage","13bomb","14powup","15fanfare","16battle","17jump"],s=[];for(let e in n)s[e]=t[n[e]].sound,s[e].pos=0,s[e].addEventListener("timeupdate",(function(t){this.pos=c.currentTime/c.duration*100})),s[e].stat=!1,s[e].addEventListener("loadeddata",(function(t){this.stat=!0})),s[e].addEventListener("ended",(function(t){-1!=r&&(h(r),m(),r=-1)}));this.loadCheck=function(){let t=0;for(let e in s)s[e].stat&&t++;return e=t>=s.length,e?"Ready":o+":"+t};let a=0,r=-1,l=!1,c=new Audio;function h(t,i){e&&(c.pause(),c.currentTime=0,Boolean(n[t])&&(c=s[t],s[t].volume=this.mastervolume,s[t].muted=!1,a=t))}function m(){e&&(c.ended&&(c.currentTime=0),c.play(),r=-1)}this.change=h,this.duration=function(t){return s[t].duration},this.play=m,this.effect=function(t){if(!e)return;Boolean(n[t])&&(s[t].currentTime=0,s[t].play())},this.next=function(t,e){Boolean(n[t])&&(r=t,l=e)},this.info=function(){return s[a].pos},this.running=function(){if(e)return!s[a].ended},this.restart=function(){e&&(c.currentTime=0)},this.volume=function(t){if(e){0,t=t>this.mastervolume?this.mastervolume:t;for(let e in s)s[e].volume=t}}}function spdata(){let t=[["Mayura1",0,0,32,32],["Mayura2",32,0,32,32],["Mayura3",64,0,32,32],["Mayura4",96,0,32,32],["Unyuu1",128,0,32,32],["Unyuu2",160,0,32,32],["Unyuu3",192,0,32,32],["Fire1",0,32,16,16],["Fire2",16,32,16,16],["Down1",0,64,32,32],["Down2",32,64,32,32],["Down3",64,64,32,32],["Down4",96,64,32,32],["Down5",128,64,32,32],["Zap1",0,96,32,32],["Zap2",32,96,32,32],["Zap3",64,96,32,32],["Zap4",96,96,32,32],["Ball1",128,48,16,16],["Ball2",144,48,16,16],["Ball3",160,48,16,16],["BallB1",176,48,16,16],["BallB2",192,48,16,16],["BallB3",208,48,16,16],["BallS1",176,64,16,16],["BallS2",192,64,16,16],["BallS3",208,64,16,16],["BallL1",176,80,16,16],["BallL2",192,80,16,16],["BallL3",208,80,16,16],["Key",64,32,32,32],["sKey",48,32,16,16],["miniMay",32,32,16,16],["TrBox",96,32,32,32],["Space",224,0,32,32],["Coin1",160,96,16,16],["Coin2",176,96,16,16],["Coin3",192,96,16,16],["Coin4",208,96,16,16],["Knife",32,192,32,32],["Spear",96,192,32,32],["Boom",128,192,32,32],["Bow",160,192,32,32],["Lamp",224,0,24,24],["Map",224,24,24,24],["lance",224,48,16,48],["BoomR",224,96,16,16],["Axe",64,192,32,32],["Wand",0,192,32,32],["Sword",240,48,16,48],["Rod",240,192,16,32],["Baxe",192,112,32,16],["LBow",128,32,48,16],["Arrow",224,112,16,16],["Cursor1",176,32,16,16],["Cursor2",192,32,16,16],["Cursor3",208,32,16,16],["Barn1",0,48,16,16],["Barn2",16,48,16,16],["Barn3",32,48,16,16],["cursorx",64,128,16,16],["Dummy",112,32,15,15]],e=[];for(let i in t){let o=t[i],n={pict:"SPGraph",x:o[1],y:o[2],w:o[3],h:o[4]};e[o[0]]=n}i("_equip",16,10,24,24),i("_item",16,17,24,24),i("_icon",16,17,24,24),i("_itype",16,1,24,24),i("_irear",16,17,24,24);return e.TitleLogo={pict:"TitleLogo",x:0,y:0,w:406,h:68},e.Knife=e._equip_6,e.Axe=e._equip_24,e.Bow=e._equip_39,e.AmuletR=e._equip_118,e.AmuletG=e._equip_117,e.AmuletB=e._equip_119,e.RingR=e._equip_127,e.RingB=e._equip_126,e.CandleR=e._item_76,e.CandleB=e._item_77,e.Mirror=e._item_59,e;function i(t,i,o,n,s){let a=0;for(let r=0;r<o;r++)for(let o=0;o<i;o++){let i={pict:t,x:o*n,y:r*s,w:n,h:s};e[t+"_"+a]=i,a++}}}function bgdata(){let t=[[0,32,0,95,95],[1,128,0,95,95],[2,32,0,31,31],[3,128,0,31,31],[4,160,0,31,31],[5,192,0,31,31],[6,128,32,31,31],[7,192,32,31,31],[8,128,64,31,31],[9,160,64,31,31],[10,192,64,31,31],[11,160,32,31,31],[12,0,64,32,32],[13,0,0,32,32],[14,0,32,32,32],[15,0,96,32,32],["Door",0,0,32,32],["Portal",0,32,32,32],["StoneB",0,96,32,32],["OpDoor",32,96,32,32],["LPortal",64,96,32,32]],e=[];for(let i in t){let o=t[i],n={};n.x=o[1],n.y=o[2],n.w=o[3],n.h=o[4],e[o[0]]=n}return e}function Stage1(t){const e=96,o=96;let n;n=new Dangeon(t),n.create();n.mapdata;let s=n.ml,a=n.il,r=(n.rl,new function(t){let e=t;this.next=function(){let t=(1103515245*e+12345)%32768;return e=t,t/32767.1}}(t=Math.floor(1e6*Math.random())));this.scenario=function(){let t=[[118e3,240,240,180,"signal_warning",6],[119999,240,240,180,"enemy_timeover",33],[119999,240,2e3,180,"enemy_timeover",33],[119999,1500,1500,180,"enemy_timeover",33],[119999,2e3,240,180,"enemy_timeover",33],[119999,2e3,2e3,180,"enemy_timeover",33],[6e5,-1,-1,0,0,0]],i=[];for(let e in t){let o=t[e],n={};n.count=o[0],n.x=o[1],n.y=o[2],n.r=o[3],n.sc=o[4],n.ch=o[5],n.used=!1,i.push(n)}for(let t in i){let n=i[t],s=Math.floor(n.x/e),r=Math.floor(n.y/o),l=!0;for(let t in a)a[t].x==s&&a[t].y==r&&(l=!1);if(l){let t=Math.floor(Math.random()*a.length);n.x=a[t].x*e+48,n.y=a[t].y*o+48}}return i},this.bgImage=function(t){return"bg"+(Math.floor((t-1)%15/5)+1)},this.bgLayout=function(){let t=[],i=n.mapdata,u=[-1,0,1,-1,1,-1,0,1],f=[-1,-1,-1,0,0,1,1,1],_=[];bit_check=function(t){let e=[];for(let i in u)Math.floor(t/Math.pow(2,i))%2!=0?e[i]=!0:e[i]=!1;return e},h=[];for(let t=0;t<3*(n.mw+1);t++)h[t]=new Array(3*n.mh),h[t].fill(!0);for(let s=1;s<=n.mw-1;s++)for(let a=1;a<=n.mh-1;a++){if(i[s][a]){let i=bit_check(n.type[s][a]);for(let n in u)_=[i[n]?Number(n)+3:12,s*e+32+32*u[n],a*o+32+32*f[n],32,32,!1,1+(i[n]?0:-1),!0],t.push(_),i[n]||(h[3*s-2+u[n]][3*a-2+f[n]]=i[n])}else for(let t in u);i[s][a]&&(_=[11,s*e+32,a*o+32,32,32,!1,1,!0],t.push(_))}for(let i in s){_=[0,s[i].x*e,s[i].y*o,96,96,!1,0,!0],t.push(_);for(let t in u)h[3*s[i].x-2+u[t]][3*s[i].y-2+f[t]]=!1;h[3*s[i].x-2][3*s[i].y-2]=!1}let p,y=m(a),w=y.pos;for(let i in w){let n=(w[i].min.x-1)*e,s=(w[i].min.y-1)*o,a=(w[i].max.x-w[i].min.x+2)*e,r=(w[i].max.y-w[i].min.y+2)*o;if(_=[1,n-32,s-32,a+96+32+32,r+96+32+32,!0,3,!0],t.push(_),i==y.min)l=n+a/2+32,c=s+r/2+32,_=[14,n+a/2+32,s+r/2+32,64,64,!0,4,!0],p=t.length-1;else{let t=g(w[i]);_=[15,t.x+16,t.y+16,64,64,!0,6,!0]}t.push(_)}function g(t){let i,n=[0,1,0,1],s=[0,0,1,1],a=[],r=t.min.x+(t.max.x-t.min.x+2)/2,l=t.min.y+(t.max.y-t.min.y+2)/2;for(let t in n){let e=Math.abs(r-31*n[t]),i=Math.abs(l-31*s[t]);a[t]=Math.sqrt(e*e+i*i)}for(let t in a)a[t]==Math.min(...a)&&(i=t);return{x:(t.min.x-1)*e+n[i]*(t.max.x-t.min.x+2)*e,y:(t.min.y-1)*o+s[i]*(t.max.y-t.min.y+2)*o}}let v=Math.floor(r.next()*a.length);_=[13,a[v].x*e+16,a[v].y*o+16,64,64,!0,2,!0],t.push(_);let d=[];for(let e in t){let i=t[e],o={};o.no=i[0],o.x=i[1],o.y=i[2],o.w=i[3],o.h=i[4],o.c=i[5],o.type=i[6]+10,o.view=!1,o.visible=i[7],o.lookf=!1,o.index=-1,d.push(o)}for(let t in d)d[t].index=t;return this.startroom_id=p,this.colmap=h,d},this.initial=function(t){let i=m(a),n=[],s=[];for(let t=0;t<a.length;t++)a[t].id==i.min?s.push(t):n.push(t);s=u(s),n=u(n);let h=[];h.push([!1,l,c,0,"player",0]);let f=[20,20,20,20,23,24,25];for(let t=0;t<7;t++){let i=s[t%s.length];h.push([!1,a[i].x*e+48,a[i].y*o+48,0,"common_vset0",f[t]])}let _,p=0;if(t%5==0)_=[["common_vset0",20,20],["common_vset0",22,1],["common_vset0",21,1],["common_vset0",23,7],["common_vset0",24,7],["common_vset0",25,7],["common_vset0",26,1],["common_vset0",27,1],["common_vset0",15,1],["common_vset0",16,1],["common_vset0",17,1],["common_vset0",18,1],["common_vset0",19,1],["common_vset0",50,1],["enemy_generator",1,3],["boss_0",34,Math.floor(t/5)-1],["boss_0",14,t%15!=0?1:0],["boss_1",14,t%15==0?1:0]];else{let e=Math.floor(t/4),i=Math.floor(t/3),o=Math.floor(t/4),n=Math.floor(t/4);let s=25-e-i-o-n;s=s<5?5:s,_=[["common_vset0",20,20],["common_vset0",22,1],["common_vset0",23,Math.floor(t/4)+4],["common_vset0",24,Math.floor(t/6)+4],["common_vset0",25,4],["common_vset0",26,1],["common_vset0",27,1],["common_vset0",15,1],["common_vset0",16,1],["common_vset0",17,1],["common_vset0",18,1],["common_vset0",19,1],["common_vset0",50,1],["enemy_move_std2",1,s],["enemy_generator",1,5],["enemy_mimic",40,Math.floor(t/5)],["enemy_moveshot_1",1,e],["sce_enemy_randomshot",1,i],["enemy_turn_r",1,o],["enemy_move_n_l",1,n]]}let y=t%15;_.push(["common_vset0",[20,20,57,51,57,20,54,56,52,56,20,55,53,58,58,20][y],1]);for(let t in _){let i=_[t];for(let t=0;t<i[2];t++){let t=n[p];w=[!0,a[t].x*e+48,a[t].y*o+48,90*Math.floor(4*r.next()),i[0],i[1]],h.push(w),p++,p>=n.length&&(p=0)}}let g=[];for(let t in h){let e=h[t],i={};i.s=e[0],i.x=e[1]+4*Math.floor(24*r.next())-48,i.y=e[2]+4*Math.floor(24*r.next())-48,i.r=e[3],i.sc=e[4],i.ch=e[5],g.push(i)}let v=-1;for(let t in g){if(22==g[t].ch){v=t;break}}v<0&&alert("KEY not Found!");for(let t in g){let e=g[t];if(14==e.ch){g[v].x=e.x,g[v].y=e.y;break}}return g},this.bgPtn=function(){return bgdata()};let l,c,h=[];function m(t){let e,i,o=[],n=[];for(let e in t)if(Boolean(o[t[e].id]))o[t[e].id]++,n[t[e].id].min.x>t[e].x&&(n[t[e].id].min.x=t[e].x),n[t[e].id].min.y>t[e].y&&(n[t[e].id].min.y=t[e].y),n[t[e].id].max.x<t[e].x&&(n[t[e].id].max.x=t[e].x),n[t[e].id].max.y<t[e].y&&(n[t[e].id].max.y=t[e].y);else{o[t[e].id]=1;let i={min:{x:t[e].x,y:t[e].y},max:{x:t[e].x,y:t[e].y}};n[t[e].id]=i}for(let t in o)o[t]==Math.max(...o)&&(e=t);for(let t in o)o[t]==Math.min(...o)&&(i=t);return{rooms:o.length,max:e,min:i,pos:n}}function u(t){for(i=0;i<3e3;i++){let e=Math.floor(r.next()*t.length),i=Math.floor(r.next()*t.length),o=t[e];t[e]=t[i],t[i]=o}return t}this.colmap=h,this.startroom_id,a=function(t){let e=Array(t.length);e.fill(!1);let i=0;for(let n in t)e[n]||(t[n].id=i,e[n]=!0,o(i,t[n].x,t[n].y),i++);return t;function o(i,n,s){let a=[-1,0,1,0],r=[0,-1,0,1];for(let l in a)for(let c in t)e[c]||t[c].x==n+a[l]&&t[c].y==s+r[l]&&(t[c].id=i,e[c]=!0,o(i,n+a[l],s+r[l]))}}(a)}function Stage1_brm(){let t=96,e=96;this.scenario=function(){return[[100,0,0,0,37,0]]},this.bgImage=function(t){return"bg3"},this.bgLayout=function(){let i=[],o=[];for(let n=13;n<=17;n++)for(let s=8;s<=25;s++)o=[0,n*t,s*e,96,96,!1,0,!0],i.push(o);for(let e=13;e<=17;e++)for(let o=0;o<3;o++)i.push([11,e*t+32*o,736,32,32,!0,1,!0]),i.push([12,e*t+32*o,768,32,32,!1,0,!0]),i.push([12,e*t+32*o,800,32,32,!1,0,!0]),i.push([11,e*t+32*o,2496,32,32,!0,1,!0]);for(let t=8;t<=25;t++)for(let o=0;o<3;o++)i.push([11,1216,t*e+32*o,32,32,!0,1,!0]),i.push([11,1728,t*e+32*o,32,32,!0,1,!0]);wx=1472,wy=2432,o=[1,wx-48,wy-48,96,96,!0,3,!1],i.push(o),sid=i.length-1,o=[14,wx-32,wy-32,64,64,!0,4,!0],i.push(o),wx=15,wy=8,o=[13,96*wx+16,96*wy,64,64,!0,2,!0],i.push(o);let n=[];for(let t in i){let e=i[t],o={};o.no=e[0],o.x=e[1],o.y=e[2],o.w=e[3],o.h=e[4],o.c=e[5],o.type=e[6]+10,o.view=!1,o.visible=e[7],o.lookf=!1,n.push(o)}return n},this.initial=function(e){let i=[];i.push([!1,15,25,0,"player",0]),i.push([!0,15,12,0,"boss_1",14]),i.push([!0,15,12,0,"common_vset0",22]),i.push([!0,13,16,0,"boss_0",34]),i.push([!0,17,16,0,"boss_0",34]),i.push([!0,14,20,0,"enemy_mimic",40]),i.push([!0,16,20,0,"enemy_mimic",40]),i.push([!0,13,21,0,"enemy_mimic",40]),i.push([!0,17,21,0,"enemy_mimic",40]),i.push([!0,0,0,0,37,40]);let o=[];for(let e in i){let n=i[e],s={};s.s=n[0],s.x=n[1]*t+32,s.y=n[2]*t+32,s.r=n[3],s.sc=n[4],s.ch=n[5],o.push(s)}let n=-1;for(let t in o){if(22==o[t].ch){n=t;break}}n<0&&alert("KEY not Found!");for(let t in o){let e=o[t];if(14==e.ch){o[n].x=e.x,o[n].y=e.y;break}}return o},this.bgPtn=function(){return bgdata()}}function Stage1_tod(t,e){let o;o=new Dangeon_tod(t),o.create();let n=new function(t){let e=t;this.next=function(){let t=(1103515245*e+12345)%32768;return e=t,t/32767.1}}(t);o.map;this.scenario=function(){let t=[];for(let e=0;e<o.mw-1;e+=2)for(let i=0;i<o.mh-1;i+=2)t.push([7e3,80*e+32,80*i+32,180,"common_vset0",4]);t.push([6e5,-1,-1,0,0,0]);let e=[];for(let i in t){let o=t[i],n={};n.count=o[0],n.x=o[1],n.y=o[2],n.r=o[3],n.sc=o[4],n.ch=o[5],n.used=!1,e.push(n)}return e},this.bgImage=function(){return(new Image).src="pict/cha.png","bg3"},this.bgLayout=function(){let t=[],e=o.map,i=[],s=128,a=16,r=0,l=0;for(let n=0;n<o.mw-1;n++){l=0;let c=n%2==1?a:s;for(let h=0;h<o.mh-1;h++){let o=h%2==1?a:s;h%2==0&&n%2==0&&(i=[0,r,l,s,s,!1,0,!0],t.push(i)),h%2==1&&n%2==1?(i=[11,r,l,c,o,!0,1,!0],t.push(i)):(i="  "!=e[n][h]?[11,r,l,c,o,!0,1,!0]:[0,r,l,c,o,!1,0,!0],t.push(i)),l+=o}r+=c}i=[13,144*Math.floor(n.next()*((o.mw-1)/2)),144*Math.floor(n.next()*((o.mw-1)/2)),64,64,!0,2,!0],t.push(i),blsz=144,i=[11,0,0,10*blsz+blsz,a,!0,1,!0],t.push(i),i=[11,0,10*blsz+blsz,10*blsz+blsz,a,!0,1,!0],t.push(i),i=[11,0,0,a,10*blsz+blsz,!0,1,!0],t.push(i),i=[11,10*blsz+blsz,0,a,10*blsz+blsz,!0,1,!0],t.push(i);let c=[];for(let e in t){let i=t[e],o={};o.no=i[0],o.x=i[1],o.y=i[2],o.w=i[3],o.h=i[4],o.c=i[5],o.type=i[6]+10,o.view=!1,o.visible=i[7],o.lookf=!0,c.push(o)}return c},this.initial=function(t){let e=[],a=[],r=0;for(let t=0;t<o.mw-1;t++)for(let i=0;i<o.mh-1;i++)i%2==0&&t%2==0&&(a[r]=r,e[r]={},e[r].x=t,e[r].y=i,r++);for(i=0;i<1e3;i++){let t=Math.floor(n.next()*a.length),e=Math.floor(n.next()*a.length),i=a[t];a[t]=a[e],a[e]=i}let l=64,c=l,h=[];h.push([!1,e[a[0]].x*l+c,e[a[0]].y*l+c,0,"player",0]);let m=3+Math.floor(t/3),u=Math.floor(t/5),f=Math.floor(t/7),_=1,p=_+m;for(i=_;i<p;i++){let t=a[i];w=[!0,e[t].x*l+c,e[t].y*l+c,90*Math.floor(4*n.next()),"enemy_move_std",1],h.push(w)}for(_=p,p+=u,i=_;i<p;i++){let t=a[i];w=[!0,e[t].x*l+c,e[t].y*l+c,90*Math.floor(4*n.next()),"enemy_moveshot_1",1],h.push(w)}for(_=p,p+=f,i=_;i<p;i++){let t=a[i];w=[!0,e[t].x*l+c,e[t].y*l+c,90*Math.floor(4*n.next()),"sce_enemy_randomshot",1],h.push(w)}for(_=p,p+=5,i=_;i<p;i++){let t=a[i];w=[!0,e[t].x*l+c,e[t].y*l+c,Math.floor(360*n.next()),"common_vset0",20],h.push(w)}_=p,t%10==0&&0!=t&&(nm=a[_],w=[!0,e[nm].x*l+c,e[nm].y*l+c,Math.floor(360*n.next()),"common_vset0",21],h.push(w));s&&(_++,nm=a[_],w=[!0,e[nm].x*l+c,e[nm].y*l+c,Math.floor(360*n.next()),"common_vset0",22],h.push(w));let y=[];for(let t in h){let e=h[t],i={};i.s=e[0],i.x=e[1],i.y=e[2],i.r=e[3],i.sc=e[4],i.ch=e[5],y.push(i)}return y},this.bgPtn=function(){return bgdata()};let s=e}function Stage1_vsv(t){let e=96,o=96,n=new function(t){let e=t;this.next=function(){let t=(1103515245*e+12345)%32768;return e=t,t/32767.1}}(Math.floor(1e6*Math.random()));this.scenario=function(){let t=[[119999,240,240,180,"enemy_timeover",33],[119999,240,2e3,180,"enemy_timeover",33],[119999,1500,1500,180,"enemy_timeover",33],[119999,2e3,240,180,"enemy_timeover",33],[119999,2e3,2e3,180,"enemy_timeover",33],[6e5,-1,-1,0,0,0]],e=[];for(let i in t){let o=t[i],n={};n.count=o[0],n.x=o[1],n.y=o[2],n.r=o[3],n.sc=o[4],n.ch=o[5],n.used=!1,e.push(n)}return e},this.bgImage=function(t){return"bg1"},this.bgLayout=function(){let t=[],i=[];for(let n=0;n<=30;n++)for(let s=0;s<=30;s++)i=[0,n*e,s*o,96,96,!1,0,!0],t.push(i);for(let i=0;i<=30;i++)i%2==0?t.push([11,i*e,0,32,32,!0,1,!0]):t.push([12,i*e,0,32,32,!1,0,!0]),t.push([12,i*e+32,0,32,32,!1,0,!0]),t.push([12,i*e+64,0,32,32,!1,0,!0]),i%2==1?t.push([11,0,i*o,32,32,!0,1,!0]):t.push([12,0,i*o,32,32,!1,0,!0]),t.push([12,0,i*o+32,32,32,!1,0,!0]),t.push([12,0,i*o+64,32,32,!1,0,!0]);for(let e=0;e<=20;e++){let e=Math.floor(30*n.next())+1,o=Math.floor(30*n.next())+1;i=[11,96*e,96*o,32,32,!0,1,!0],t.push(i)}wx=Math.floor(84*n.next())+3,wy=Math.floor(84*n.next())+3,i=[13,32*wx,32*wy,64,64,!0,2,!0],t.push(i),wx=1450,wy=1450,i=[1,wx-48,wy-48,96,96,!0,3,!1],t.push(i),sid=t.length-1,i=[14,wx-32,wy-32,64,64,!0,4,!0],t.push(i);let s=[];for(let e in t){let i=t[e],o={};o.no=i[0],o.x=i[1],o.y=i[2],o.w=i[3],o.h=i[4],o.c=i[5],o.type=i[6]+10,o.view=!1,o.visible=i[7],o.lookf=!1,o.index=-1,s.push(o)}for(let t in s)s[t].index=t;return this.startroom_id=sid,s},this.initial=function(t){let s=[],a=[];for(let t=0;t<3e3;t++){let t={};t.x=Math.floor(26*n.next())+3,t.y=Math.floor(26*n.next())+3,a.push(t)}for(let t=0;t<a.length;t++)s[t]=t;for(i=0;i<3e3;i++){let t=Math.floor(n.next()*s.length),e=Math.floor(n.next()*s.length),i=s[t];s[t]=s[e],s[e]=i}let r=[];s[0];r.push([!1,1450,1450,0,"player",0]);let l,c=1;if(t%5==0)l=[["common_vset0",20,20],["common_vset0",22,1],["common_vset0",21,1],["common_vset0",23,7],["common_vset0",24,7],["common_vset0",25,7],["common_vset0",26,1],["common_vset0",27,1],["common_vset0",15,1],["common_vset0",16,1],["common_vset0",17,1],["common_vset0",18,1],["common_vset0",19,1],["common_vset0",50,1],["enemy_generator_vst",1,5],["boss_0",34,Math.floor(t/5)-1],["boss_0",14,t%15!=0?1:0],["boss_1",14,t%15==0?1:0]];else{let e=Math.floor(t/4),i=Math.floor(t/3),o=Math.floor(t/4),n=Math.floor(t/4);let s=25-e-i-o-n;s=s<5?5:s,l=[["common_vset0",20,20],["common_vset0",22,1],["common_vset0",23,Math.floor(t/4)+4],["common_vset0",24,Math.floor(t/6)+4],["common_vset0",25,4],["common_vset0",26,1],["common_vset0",27,1],["common_vset0",15,1],["common_vset0",16,1],["common_vset0",17,1],["common_vset0",18,1],["common_vset0",19,1],["common_vset0",50,1],["enemy_move_vst",1,s],["enemy_generator_vst",1,5],["enemy_mimic",40,Math.floor(t/5)],["enemy_moveshot_1",1,e],["sce_enemy_randomshot",1,i],["enemy_turn_r",1,o],["enemy_move_n_l",1,n]]}for(let t in l){let i=l[t];for(let t=0;t<i[2];t++){let t=s[c];w=[!0,a[t].x*e+48,a[t].y*o+48,90*Math.floor(4*n.next()),i[0],i[1]],r.push(w),c++,c>=a.length&&(c=0)}}let h=[];for(let t in r){let e=r[t],i={};i.s=e[0],i.x=e[1]+4*Math.floor(24*n.next())-48,i.y=e[2]+4*Math.floor(24*n.next())-48,i.r=e[3],i.sc=e[4],i.ch=e[5],h.push(i)}let m=-1;for(let t in h){if(22==h[t].ch){m=t;break}}m<0&&alert("KEY not Found!");for(let t in h){let e=h[t];if(14==e.ch){h[m].x=e.x,h[m].y=e.y;break}}return h},this.bgPtn=function(){return bgdata()}}function stateConfig(){function t(){this.lamp_use=!1,this.map_use=!1,this.itemreset=!0,this.shotfree=!1,this.startstage=1,this.use_audio=!0,this.master_volume=5,this.debug=!1,this.viewlog=!1,this.bulletmode=!1,this.keyAn=[90,88,67,81,27,0,2,1,3,9]}this.lamp_use,this.map_use,this.itemreset,this.shotfree,this.startstage,this.use_audio,this.master_volume,this.debug,this.viewlog,this.bulletmode,this.keyAn=[],t(),this.load=function(){let t=0;if(Boolean(localStorage)){let e=["lamp_use","map_use","itemreset","shotfree","debug","viewlog","bulletmode","startstage"],i=!1;for(let t=0;t<=5;t++)Boolean(localStorage.getItem(e[t]))&&(i=!0,this[e[t]]="on"==localStorage.getItem(e[t]));if(Boolean(localStorage.getItem(e[6]))&&(i=!0,this[e[6]]=parseInt(localStorage.getItem(e[6]))),Boolean(localStorage.getItem("keyassign"))){i=!0;let t=localStorage.getItem("keyassign");this.keyAn=JSON.parse(t)}t=i?0:1}else t=2;return t},this.save=function(){let t=0;if(Boolean(localStorage)){localStorage.setItem("lamp_use",this.lamp_use?"on":"off"),localStorage.setItem("map_use",this.map_use?"on":"off"),localStorage.setItem("itemreset",this.itemreset?"on":"off"),localStorage.setItem("shotfree",this.shotfree?"on":"off"),localStorage.setItem("debug",this.debug?"on":"off"),localStorage.setItem("viewlog",this.viewlog?"on":"off"),localStorage.setItem("bulletmode",this.bulletmode?"on":"off"),localStorage.setItem("startstage",new String(this.startstage));let t=JSON.stringify(this.keyAn,void 0,1);localStorage.setItem("keyassign",t)}else t=2;return t},this.reset=t}function stateControl(t){this.Config=new stateConfig(t),this.Result=new stateResult(t),this.System=new stateSystem(t),this.Game=new stateGame(t),this.obCtrl=new gObjectControl(this.System.dev.graphics[1],this),this.mapsc=new mapSceControl,this.Utility={},this.Database={}}function stateGame(){function t(){this.zanki=2,this.hp=10,this.maxhp=this.hp,this.weapon=0,this.speed=6,this.level=0,this.skill_ex=[0,0,0,0,0,0],this.skill_lv=[0,0,0,0,0,0];this.stack=[];let t=new e,i=new e,o=new e;this.spec=t,this.base=i,this.enh=o}this.item,this.itemstack,this.nowstage,this.cold;let e=function(){let t=Array(11);t.fill(0),this.STATUS=t,this.LV=0,this.HP=0,this.MP=0,this.STR=0,this.DEX=0,this.AGI=0,this.VIT=0,this.INT=0,this.MND=0,this.LAK=0,this.ETC=0},i=function(){};i.prototype={Set:function(t){this.LV=t[0],this.HP=t[1],this.MP=t[2],this.STR=t[3],this.DEX=t[4],this.AGI=t[5],this.VIT=t[6],this.INT=t[7],this.MND=t[8],this.LAK=t[9],this.ETC=t[10]},Read:function(){let t=Array(11);return t[0]=this.LV,t[1]=this.HP,t[2]=this.MP,t[3]=this.STR,t[4]=this.DEX,t[5]=this.AGI,t[6]=this.VIT,t[7]=this.INT,t[8]=this.MND,t[9]=this.LAK,t[10]=this.ETC,t},Reset:function(){let t=Array(11);t.fill(0),set(t)},Loader:function(t){this.LV=t.LV,this.HP=t.HP,this.MP=t.MP,this.STR=t.STR,this.DEX=t.DEX,this.AGI=t.AGI,this.VIT=t.VIT,this.INT=t.INT,this.MND=t.MND,this.LAK=t.LAK,this.ETC=t.ETC}},e.prototype=new i,this.player=new t,this.outviewMove=!0,this.outviewCollision=!0,this.outviewHit=!0,this.keyon=!1,this.key_x=0,this.key_y=0,this.lamp=!1,this.map=!1,this.mode=0,this.score=0,this.reset=function(){this.player=new t},this.spec_check=function(){let t=this.player.base.Read(),e=this.player.enh.Read(),i=this.player.spec.Read(),o=0;for(let n=3;n<=8;n++)i[n]=t[n]+e[n],o+=t[n];i[10]=o,this.player.spec.Set(i)},this.load=function(){if(Boolean(localStorage)){let t=!1;if(Boolean(localStorage.getItem("savedata"))){t=!0;let i=JSON.parse(localStorage.getItem("savedata"));this.item=i.item,this.itemstack=i.itemstack,this.nowstage=i.stage,this.player=i.player;let o=this.player.spec,n=this.player.base,s=this.player.enh;this.player.spec=new e,this.player.base=new e,this.player.enh=new e,this.player.spec.Loader(o),this.player.base.Loader(n),this.player.enh.Loader(s)}ret_code=t?0:1}else ret_code=2;return ret_code},this.save=function(){let t={};t.item=this.item,t.itemstack=this.itemstack,t.stage=this.nowstage,t.player=this.player;let e=JSON.stringify(t),i=0;return Boolean(localStorage)?localStorage.setItem("savedata",e):i=2,i},this.preload=function(){let t={ready:!1,load:!1,data:{}};if(Boolean(localStorage)){if(Boolean(localStorage.getItem("savedata"))){let e=JSON.parse(localStorage.getItem("savedata"));t.data=e,t.load=!0}t.ready=!0}else t.ready=!1;return t},this.dataview=function(t){let e=[];if(t.ready){if(t.load){let i=t.data,o="";for(let t in i.item)Boolean(i.item[t])&&(o=o+"["+t+"]"+i.item[t]+".");e.push("item:"+o),o="";for(let t in i.itemstack)o=o+i.itemstack[t]+",";e.push("itemstack:"+o),e.push("nowstage:"+i.stage),e.push("zanki:"+i.player.zanki),e.push("hp:"+i.player.hp),e.push("maxhp:"+i.player.maxhp),e.push("weapon:"+i.player.weapon),e.push("level:"+i.player.level),e.push("VIT:"+i.player.spec.VIT),e.push("MND:"+i.player.spec.MND),e.push("INT:"+i.player.spec.INT),e.push("ETC:"+i.player.spec.ETC),e.push("Load Ok.")}else e.push("Data Not Found.");e.push("Process end.")}return e},this.dataview2=function(t){let e=["Rod","Sword","Axe","Boom","Spear","Bow"],i=[];i[20]="①",i[23]="②",i[24]="③",i[25]="④";let o=[];if(Boolean(t.title)?o.push(t.title):o.push("[SAVEDATA]"),t.ready)if(t.load){let n=t.data,s=n.player,a="";for(let t in i)Boolean(n.item[t])&&(a=a+i[t]+":"+n.item[t]+" ");o.push("ITEM:"+a),o.push("STAGE:"+n.stage),o.push("⑦:"+s.zanki),o.push("HP :"+s.hp+" / "+s.maxhp),o.push("WEAPON :"+e[s.weapon]+" +"+s.level),o.push("STR :"+s.spec.STR+" ("+s.base.STR+"+"+s.enh.STR+")"),o.push("DEX :"+s.spec.DEX+" ("+s.base.DEX+"+"+s.enh.DEX+")"),o.push("VIT :"+s.spec.VIT+" ("+s.base.VIT+"+"+s.enh.VIT+")"),o.push("MND :"+s.spec.MND+" ("+s.base.MND+"+"+s.enh.MND+")"),o.push("INT :"+s.spec.INT+" ("+s.base.INT+"+"+s.enh.INT+")")}else o.push("NOT FOUND.");return o}}function stateResult(){this.highscore=0,this.score=0,this.combo;let t=0;this.load=function(){if(Boolean(localStorage)){let e=!1;Boolean(localStorage.getItem("highscore"))&&(e=!0,this.highscore=parseInt(localStorage.getItem("highscore"))),t=e?0:1}else t=2;return t},this.save=function(){let t=0;return Boolean(localStorage)?localStorage.setItem("highscore",new String(this.result.highscore)):t=2,t}}function stateSystem(t){this.dev=new deviceControl(t),this.deltaTime=t.deltaTime,this.time=t.time,this.blink=t.blink}function TestStage(t){const e=96,o=96;let n;n=new Dangeon(t),n.create();let s=n.ml,a=n.il,r=new function(t){let e=t;this.next=function(){let t=(1103515245*e+12345)%32768;return e=t,t/32767.1}}(t=Math.floor(1e6*Math.random()));this.scenario=function(){let t=[[6e5,-1,-1,0,0,0]],i=[];for(let e in t){let o=t[e],n={};n.count=o[0],n.x=o[1],n.y=o[2],n.r=o[3],n.sc=o[4],n.ch=o[5],n.used=!1,i.push(n)}for(let t in i){let n=i[t],s=Math.floor(n.x/e),r=Math.floor(n.y/o),l=!0;for(let t in a)a[t].x==s&&a[t].y==r&&(l=!1);if(l){let t=Math.floor(Math.random()*a.length);n.x=a[t].x*e+48,n.y=a[t].y*o+48}}return i},this.bgImage=function(t){return"bg"+(Math.floor((t-1)%15/5)+1)},this.bgLayout=function(){let t=[],i=n.mapdata,r=[-1,0,1,-1,1,-1,0,1],u=[-1,-1,-1,0,0,1,1,1],f=[];bit_check=function(t){let e=[];for(let i in r)Math.floor(t/Math.pow(2,i))%2!=0?e[i]=!0:e[i]=!1;return e},h=[];for(let t=0;t<3*(n.mw+1);t++)h[t]=new Array(3*n.mh),h[t].fill(!0);for(let s=1;s<=n.mw-1;s++)for(let a=1;a<=n.mh-1;a++){if(i[s][a]){let i=bit_check(n.type[s][a]);for(let n in r)f=[i[n]?Number(n)+3:12,s*e+32+32*r[n],a*o+32+32*u[n],32,32,!1,1+(i[n]?0:-1),!0],t.push(f),i[n]||(h[3*s-2+r[n]][3*a-2+u[n]]=i[n])}i[s][a]&&(f=[11,s*e+32,a*o+32,32,32,!1,1,!0],t.push(f))}for(let i in s){f=[0,s[i].x*e,s[i].y*o,96,96,!1,0,!0],t.push(f);for(let t in r)h[3*s[i].x-2+r[t]][3*s[i].y-2+u[t]]=!1;h[3*s[i].x-2][3*s[i].y-2]=!1}let _,p=m(a),y=p.pos;for(let i in y){let n=(y[i].min.x-1)*e,s=(y[i].min.y-1)*o,a=(y[i].max.x-y[i].min.x+2)*e,r=(y[i].max.y-y[i].min.y+2)*o;if(f=[1,n-32,s-32,a+96+32+32,r+96+32+32,!0,3,!0],t.push(f),i==p.min){l=n+a/2+32,c=s+r/2+32,f=[14,n+a/2+32,s+r/2+32,64,64,!0,4,!0],_=t.length-1,t.push(f);let e=w(y[i]);f=[13,e.x+16,e.y+16,64,64,!0,2,!0]}else{let t=w(y[i]);f=[15,t.x+16,t.y+16,64,64,!0,6,!0]}t.push(f)}function w(t){let i,n=[0,1,0,1],s=[0,0,1,1],a=[],r=t.min.x+(t.max.x-t.min.x+2)/2,l=t.min.y+(t.max.y-t.min.y+2)/2;for(let t in n){let e=Math.abs(r-31*n[t]),i=Math.abs(l-31*s[t]);a[t]=Math.sqrt(e*e+i*i)}for(let t in a)a[t]==Math.min(...a)&&(i=t);return{x:(t.min.x-1)*e+n[i]*(t.max.x-t.min.x+2)*e,y:(t.min.y-1)*o+s[i]*(t.max.y-t.min.y+2)*o}}let g=[];for(let e in t){let i=t[e],o={};o.no=i[0],o.x=i[1],o.y=i[2],o.w=i[3],o.h=i[4],o.c=i[5],o.type=i[6]+10,o.view=!1,o.visible=i[7],o.lookf=!1,o.index=-1,g.push(o)}for(let t in g)g[t].index=t;return this.startroom_id=_,this.colmap=h,g},this.initial=function(t){let i=m(a),n=[],s=[];for(let t=0;t<a.length;t++)a[t].id==i.min?s.push(t):n.push(t);s=u(s),n=u(n);let h=[];h.push([!1,l,c,0,"player",0]);let f=[20,20,20,20,23,24,25,51,52,53,54,55,56,57,58,22,26,27,16,17,18,19,50];for(let t in f){let i=s[t%s.length];h.push([!1,a[i].x*e+48,a[i].y*o+48,0,"common_vset0",f[t]])}let _=[];for(let t in h){let e=h[t],i={};i.s=e[0],i.x=e[1]+4*Math.floor(24*r.next())-48,i.y=e[2]+4*Math.floor(24*r.next())-48,i.r=e[3],i.sc=e[4],i.ch=e[5],_.push(i)}let p=-1;for(let t in _){if(22==_[t].ch){p=t;break}}p<0&&alert("KEY not Found!");return _},this.bgPtn=function(){return bgdata()};let l,c,h=[];function m(t){let e,i,o=[],n=[];for(let e in t)if(Boolean(o[t[e].id]))o[t[e].id]++,n[t[e].id].min.x>t[e].x&&(n[t[e].id].min.x=t[e].x),n[t[e].id].min.y>t[e].y&&(n[t[e].id].min.y=t[e].y),n[t[e].id].max.x<t[e].x&&(n[t[e].id].max.x=t[e].x),n[t[e].id].max.y<t[e].y&&(n[t[e].id].max.y=t[e].y);else{o[t[e].id]=1;let i={min:{x:t[e].x,y:t[e].y},max:{x:t[e].x,y:t[e].y}};n[t[e].id]=i}for(let t in o)o[t]==Math.max(...o)&&(e=t);for(let t in o)o[t]==Math.min(...o)&&(i=t);return{rooms:o.length,max:e,min:i,pos:n}}function u(t){for(i=0;i<3e3;i++){let e=Math.floor(r.next()*t.length),i=Math.floor(r.next()*t.length),o=t[e];t[e]=t[i],t[i]=o}return t}this.colmap=h,this.startroom_id,a=function(t){let e=Array(t.length);e.fill(!1);let i=0;for(let n in t)e[n]||(t[n].id=i,e[n]=!0,o(i,t[n].x,t[n].y),i++);return t;function o(i,n,s){let a=[-1,0,1,0],r=[0,-1,0,1];for(let l in a)for(let c in t)e[c]||t[c].x==n+a[l]&&t[c].y==s+r[l]&&(t[c].id=i,e[c]=!0,o(i,n+a[l],s+r[l]))}}(a)}function tutorialCommentTable(){let t=[];return t[0]=["「操作」: 移動:キーボード WASD/矢印 (GAMEPAD) ⑩レバー","Z ⑬ 攻撃/回収 X ⑫ アイテム使用 C ⑪ ジャンプ","ESC(START) メニュー/一時停止 / Home:フルスクリーン "],t[1]=["「魔法陣」：出現地点の部屋にあり、接触時レベルアップチェック","部屋には一般の敵は入れない。(時間切れ時の敵は除く)"],t[2]=["「扉」:⑥鍵があれば次のステージに行ける"],t[3]=["「TIME」:TIMEが0になるまでにステージクリアしていないと","地形に影響されずに追跡してくる敵が発生する"],t[4]=["「武器の強化」:手持ちの強さをベースに強化される","(相互加算ではなく強化された同武器を後から入手しても +1 )","強化状態は敵に拾われてしまうとリセットされる"],t[5]=["「レベルアップ」:経験値が一定以上でレベルアップし","アイテムの効果を強化できる。効果はプレイ中は継続する。"],t[6]=["「ボス」:５の倍数ステージでは、ボスが⑥鍵を持っている"],t[7]=["「スピードアップ」:①の数に応じて自機の速度が向上"],t[8]=["「オプション」:①が10個毎にオプションが1つ付く","10個以下になると消滅(最大4つ)"],t[9]=["「LOADGAME」:ステージの最初から開始される"],t[10]=["「石碑」:⑤が10枚消費して","ステージの開始位置に戻ることができる"],t[11]=["「操作」:攻撃方向の固定 (槍・弓の場合)","[Ctrl]キー (rb)ボタン(押しながら移動)"],t[12]=["「操作」:「石の中にいる！」場合の緊急脱出用","[H]キー(部屋の中では使用できません）"],t[13]=["「ボス」:ステージ10に行くには","いずれかの「アイテム:リング」が必要"],t[14]=["「大ボス」:ステージ15に行くには","いずれかの「アイテム:護符」と「アイテム:ミラー」が必要"],t[15]=["「武器:杖」:操作:Z ⑬ 攻撃＆アイテム回収 ①消費","シールド使用の移動速度ペナルティなし","装備時に同武器入手で①+7"],t[16]=["「武器:剣」:操作:Z ⑬ アイテム回収 ①消費","攻撃は自動で発生/移動方向前方に90度の扇状攻撃","装備時に同武器入手で強化(攻撃速度/範囲の向上)"],t[17]=["「武器:斧」:操作:Z ⑬ アイテム回収 ①消費","攻撃は自動で発生/自機を中心に360度の範囲攻撃","装備時に同武器入手で強化(攻撃速度/範囲の向上)"],t[18]=["「武器:槍」:操作:Z ⑬ アイテム回収 ①消費","攻撃は自動で発生/移動方向前方攻撃","装備時に同武器入手で強化(攻撃速度/範囲の向上)"],t[19]=["「武器:ブーメラン」:操作:Z ⑬ アイテム回収","攻撃は自動で発生/移動方向に遠隔攻撃","装備時に同武器入手で強化(オプションの攻撃速度)"],t[50]=["「武器:弓」:操作:Z ⑬ アイテム回収 ①消費","攻撃は自動で発生/移動方向に遠隔攻撃(自機3way)","装備時に同武器入手で強化(攻撃速度)"],t[20]=["アイテム:①」:パワーアップアイテム","取得でスピードアップ及びオプション追加","アイテム回収や攻撃で消費する"],t[21]=["「アイテム:⑦自機」:1UPアイテム。自機+1"],t[22]=["「アイテム:⑥鍵」:扉に入り次のステージへ行ける"],t[23]=["「アイテム:②爆弾」:使用で範囲内の敵に一律のダメージ","レベルアップでダメージ強化"],t[24]=["「アイテム:③シールド」:使用で一定時間内、敵の攻撃が無効","レベルアップで効果時間延長"],t[25]=["「アイテム:④ライフ」:使用で一定値のHPの回復とHP最大値+1","レベルアップで回復量増加"],t[26]=["「アイテム:⑧ランプ」:敵の位置と鍵の場所を表示","ステージ毎に入手"],t[27]=["「アイテム:⑨地図」:ステージの地図を表示","ステージ毎に入手"],t[35]=["「アイテム:⑤コイン」:ポイントアイテム。石碑利用料"],t[40]=["「アイテム:宝箱」:アイテムを持っていた敵がドロップ"],t[51]=["「アイテム:赤の護符」:爆弾ダメージ強化"],t[52]=["「アイテム:緑の護符」:HP回復量強化"],t[53]=["「アイテム:青の護符」:シールド効果時間強化"],t[54]=["「アイテム:キャンドル（赤）」:部屋が明るくなる"],t[55]=["「アイテム:キャンドル（青）」:部屋が明るくなる"],t[56]=["「アイテム:リング（赤）」:武器攻撃力強化"],t[57]=["「アイテム:リング（青）」:武器攻撃力強化"],t[58]=["「アイテム:ミラー」:ステージ15へ行く為に必須"],t}
</script>
<script type="text/javascript">
function ImageAssetSetup(game){
	const asset_path_sys = "pict/";
	const asset_path_cts = "";

	game.asset.imageLoad( "FontGraph",asset_path_cts + "pict/aschr.png" );
	game.asset.imageLoad( "SPGraph"	, asset_path_cts + "pict/cha.png" );
	game.asset.imageLoad( "bg1"		, asset_path_cts + "pict/bg1.png" );
	game.asset.imageLoad( "bg2"		, asset_path_cts + "pict/bg2.png" );
	game.asset.imageLoad( "bg3"		, asset_path_cts + "pict/bg3.png" );
	game.asset.imageLoad( "KanjiHw"	, asset_path_sys + "k12x8_jisx0201c.png" );
	game.asset.imageLoad( "KanjiFw"	, asset_path_sys + "k12x8_jisx0208c.png" );

	game.asset.imageLoad( "_equip"  ,asset_path_cts + "pict/icon-1_1.png" );
	game.asset.imageLoad( "_item"   ,asset_path_cts + "pict/icon-1_2.png" );
	game.asset.imageLoad( "_icon"   ,asset_path_cts + "pict/icon-3_1.png" );
	game.asset.imageLoad( "_itype"  ,asset_path_cts + "pict/icon-3_2.png" );
	game.asset.imageLoad( "_irare"  ,asset_path_cts + "pict/icon-3_3.png" );

	game.asset.imageLoad( "TitleLogo",asset_path_cts + "pict/TitleLogoTemp.png" );
}

function SoundAssetSetup(game){
	const asset_path_cts = "";

	game.asset.soundLoad( "00round_start", asset_path_cts + "sound/00round_start");  
	game.asset.soundLoad( "01main",		asset_path_cts +    "sound/01main" 		);
	game.asset.soundLoad( "02warnning",	asset_path_cts + 	"sound/02warnning"	);
	game.asset.soundLoad( "03hurry_up",	asset_path_cts + 	"sound/03hurry_up"	);
	game.asset.soundLoad( "04round_clear",asset_path_cts + 	"sound/04round_clear");
	game.asset.soundLoad( "05miss",		asset_path_cts + 	"sound/05miss"		);
	game.asset.soundLoad( "06gameover",	asset_path_cts + 	"sound/06gameover"	);
	game.asset.soundLoad( "07swing",	asset_path_cts + 	"sound/07swing"		);
	game.asset.soundLoad( "08bow",		asset_path_cts + 	"sound/08bow"		);
	game.asset.soundLoad( "09select",	asset_path_cts + 	"sound/09select"	);
	game.asset.soundLoad( "10use",		asset_path_cts + 	"sound/10use"		);
	game.asset.soundLoad( "11hit",		asset_path_cts + 	"sound/11hit"		);
	game.asset.soundLoad( "12damage",	asset_path_cts + 	"sound/12damage"	);
	game.asset.soundLoad( "13bomb",		asset_path_cts + 	"sound/13bomb"		);
	game.asset.soundLoad( "14powup",	asset_path_cts + 	"sound/14powup"		);
	game.asset.soundLoad( "15fanfare",	asset_path_cts + 	"sound/15fanfarre"  );
	game.asset.soundLoad( "16battle",	asset_path_cts + 	"sound/16maou_game_battle16");
	game.asset.soundLoad( "17jump",		asset_path_cts + 	"sound/17jump"		);
}
</script>
</head>
<body onLoad="main_r()">
<canvas id = "Layer0"></canvas>
</body>
</html>
